import{a1 as $,r as n,a as D,i as G,u as F,k as J,t as a,j as e,S as K,C as O,b as Q,o as U,e as P,L as A,I as X,f as Y,g as c,B as x,q as V,h as Z,V as ee,a0 as se,s as N}from"./index-tH8kGzNV.js";import{W as re}from"./wifi-off-Dwx8fKBJ.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]],M=$("timer",te);function oe(){const[d,v]=n.useState(""),[h,w]=n.useState(!1),[g,C]=n.useState(!1),[l,k]=n.useState(120),[B,o]=n.useState("connected"),[u,b]=n.useState(!1),[S,f]=n.useState(""),[q,p]=n.useState(""),[I,j]=n.useState(!1),m=D(),E=G(),{login:W}=F(),{makeRequest:y,isOnline:T}=J(),i=E.state?.mobile||localStorage.getItem("apiAuthMobile");n.useEffect(()=>{if(!i){a.error("شماره موبایل یافت نشد"),m("/api/login");return}const s=setInterval(()=>{k(r=>r<=1?(clearInterval(s),0):r-1)},1e3);return()=>clearInterval(s)},[i,m]);const R=s=>{const r=Math.floor(s/60),t=s%60;return`${r}:${t.toString().padStart(2,"0")}`},_=async s=>{if(s.preventDefault(),!d||d.length!==6){a.error("کد تایید ۶ رقمی را وارد کنید");return}w(!0),o("connecting");try{const r=await y(()=>N.verifyOtp({phone:i,code:d}));if(r.accessToken&&r.refreshToken){o("connected"),localStorage.setItem("accessToken",r.accessToken),localStorage.setItem("refreshToken",r.refreshToken);const t=await y(()=>N.getMe());if(t&&t.user){const H=t.profiles&&t.profiles.length>0&&t.profiles[0].company?.name,L=t.profiles?.[0]?.profileType==="coop_org"?"admin":"user";W({id:t.user.id,phone:t.user.phone,role:L,status:t.user.status,profiles:t.profiles}),localStorage.removeItem("apiAuthMobile"),H?(a.success("ورود موفق به سامانه"),m(L==="admin"?"/api/admin":"/api/user",{replace:!0})):(a.success("خوش آمدید! لطفاً اطلاعات پروفایل خود را تکمیل کنید"),m("/api/complete-profile",{replace:!0}))}else o("disconnected"),a.error("خطا در دریافت اطلاعات کاربر")}else o("disconnected"),a.error(r.error||"کد تایید اشتباه است")}catch(r){console.error("OTP verification error:",r),o("disconnected"),a.error("خطا در تایید کد")}finally{w(!1)}},z=async()=>{if(!(l>0||g)){if(!u){b(!0);return}if(!S||!I){a.error("لطفاً کد امنیتی را به درستی وارد کنید");return}C(!0),o("connecting");try{const s=await y(()=>N.sendOtp({phone:i,captcha:S,captchaId:q}));s.success?(o("connected"),a.success("کد تایید جدید ارسال شد"),k(120),v(""),b(!1),f(""),p(""),j(!1)):(o("disconnected"),a.error(s.error||"خطا در ارسال مجدد کد"))}catch(s){console.error("Resend OTP error:",s),o("disconnected"),a.error("خطا در ارسال مجدد کد")}finally{C(!1)}}};return i?e.jsxs("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 p-4 relative overflow-hidden",dir:"rtl",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-600/10 via-purple-600/10 to-indigo-600/10 backdrop-blur-3xl"}),e.jsx("div",{className:"absolute top-1/4 left-1/4 w-96 h-96 bg-blue-300/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/4 right-1/4 w-96 h-96 bg-purple-300/20 rounded-full blur-3xl"}),e.jsxs("div",{className:"w-full max-w-md space-y-8 relative z-10",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 bg-gradient-to-br from-green-500 to-blue-600 rounded-2xl shadow-2xl",children:e.jsx(K,{className:"w-10 h-10 text-white"})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h1",{className:"text-3xl font-bold bg-gradient-to-r from-gray-900 via-green-700 to-blue-800 bg-clip-text text-transparent",children:"تایید کد امنیتی"}),e.jsx("p",{className:"text-gray-600 font-medium",children:"کد ۶ رقمی ارسال شده به شماره"}),e.jsx("div",{className:"inline-flex items-center bg-gradient-to-r from-blue-50 to-green-50 px-4 py-2 rounded-full border border-blue-200",children:e.jsx("span",{className:"font-bold text-blue-800",children:i})})]})]}),e.jsxs(O,{className:"shadow-2xl border-0 bg-white/90 backdrop-blur-md ring-1 ring-gray-200/50",children:[e.jsx(Q,{className:"text-center pb-4",children:e.jsx("div",{className:"flex items-center justify-center gap-2 mb-2",children:e.jsx(U,{variant:"outline",className:"bg-gradient-to-r from-green-50 to-blue-50 text-green-700 border-green-200/60 px-3 py-1",children:"🔒 تایید هویت"})})}),e.jsxs(P,{className:"space-y-8 p-8",children:[e.jsxs("form",{onSubmit:_,className:"space-y-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(A,{className:"text-gray-700 font-medium text-lg",children:"کد تایید ۶ رقمی"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"لطفاً کد دریافتی را در کادرهای زیر وارد کنید"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsx(X,{value:d,onChange:v,maxLength:6,disabled:h,children:e.jsxs(Y,{className:"gap-1.5 sm:gap-2",children:[e.jsx(c,{index:0,className:"w-10 h-12 sm:w-12 sm:h-14 text-base sm:text-lg font-bold border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-100 bg-gray-50 focus:bg-white transition-all duration-200"}),e.jsx(c,{index:1,className:"w-10 h-12 sm:w-12 sm:h-14 text-base sm:text-lg font-bold border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-100 bg-gray-50 focus:bg-white transition-all duration-200"}),e.jsx(c,{index:2,className:"w-10 h-12 sm:w-12 sm:h-14 text-base sm:text-lg font-bold border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-100 bg-gray-50 focus:bg-white transition-all duration-200"}),e.jsx(c,{index:3,className:"w-10 h-12 sm:w-12 sm:h-14 text-base sm:text-lg font-bold border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-100 bg-gray-50 focus:bg-white transition-all duration-200"}),e.jsx(c,{index:4,className:"w-10 h-12 sm:w-12 sm:h-14 text-base sm:text-lg font-bold border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-100 bg-gray-50 focus:bg-white transition-all duration-200"}),e.jsx(c,{index:5,className:"w-10 h-12 sm:w-12 sm:h-14 text-base sm:text-lg font-bold border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-100 bg-gray-50 focus:bg-white transition-all duration-200"})]})})})]}),l>0&&e.jsxs("div",{className:"flex items-center justify-center gap-3 text-gray-600 bg-gray-50 rounded-xl py-3 px-4",children:[e.jsx(M,{className:"w-5 h-5 text-blue-500"}),e.jsxs("span",{className:"font-medium",children:["زمان باقی‌مانده:",e.jsx("span",{className:"text-blue-600 font-bold mx-1",children:R(l)})]})]}),e.jsx(x,{type:"submit",className:"w-full bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-700 hover:to-blue-700 text-white py-4 rounded-xl font-semibold transition-all duration-300 transform hover:scale-[1.02] hover:shadow-xl disabled:from-gray-400 disabled:to-gray-500 disabled:transform-none",disabled:h||d.length!==6||!T,children:h?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"w-5 h-5 animate-spin"}),"در حال تایید کد..."]}):e.jsxs("div",{className:"flex items-center gap-3 justify-center",children:[e.jsx("span",{children:"تایید و ورود به سامانه"}),e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"})})]})})]}),e.jsxs("div",{className:"text-center space-y-4",children:[u&&e.jsxs("div",{className:"p-6 border-2 border-dashed border-gray-200 rounded-xl bg-gradient-to-r from-gray-50 to-blue-50",children:[e.jsx(A,{className:"text-right block mb-3 text-gray-700 font-medium",children:"تایید امنیتی برای ارسال مجدد"}),e.jsx(Z,{onCaptchaChange:f,onCaptchaIdChange:p,onValidityChange:j,disabled:g})]}),e.jsx(x,{type:"button",variant:"outline",className:"w-full text-gray-700 border-gray-300 hover:bg-gradient-to-r hover:from-blue-50 hover:to-indigo-50 hover:border-blue-300 py-3 rounded-xl font-medium transition-all duration-200",disabled:l>0||g||!T||u&&!I,onClick:z,children:g?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"w-5 h-5 animate-spin text-blue-500"}),"در حال ارسال مجدد کد..."]}):l>0?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4 text-gray-500"}),"ارسال مجدد (",R(l),")"]}):u?"تایید و ارسال مجدد کد":e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),"ارسال مجدد کد"]})}),u&&e.jsx(x,{type:"button",variant:"ghost",className:"w-full text-gray-500 hover:text-gray-700 hover:bg-gray-100 py-2 rounded-lg",onClick:()=>{b(!1),f(""),p(""),j(!1)},children:"انصراف از ارسال مجدد"}),e.jsx("div",{className:"pt-4 border-t border-gray-100",children:e.jsxs(x,{type:"button",variant:"link",className:"text-gray-600 hover:text-gray-800 flex items-center gap-2 text-sm",onClick:()=>m("/api/login"),children:[e.jsx(se,{className:"w-4 h-4"}),"تغییر شماره موبایل"]})})]})]})]}),B==="disconnected"&&e.jsx(O,{className:"bg-gradient-to-r from-red-50 to-pink-50 border-red-200 shadow-lg",children:e.jsx(P,{className:"pt-6",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-red-100 rounded-full",children:e.jsx(re,{className:"w-6 h-6 text-red-600"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"font-semibold text-red-800",children:"خطا در اتصال به API"}),e.jsx("p",{className:"text-sm text-red-700 leading-relaxed",children:"لطفاً اتصال اینترنت خود را بررسی کنید و دوباره تلاش کنید"})]}),e.jsx(x,{variant:"outline",size:"sm",className:"bg-white border-red-300 text-red-700 hover:bg-red-50",onClick:()=>window.location.reload(),children:"🔄 تلاش مجدد"})]})})})]})]}):null}export{oe as default};
