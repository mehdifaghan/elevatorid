import{a1 as Z,u as q,r as a,j as e,C as p,b as f,m as w,c as N,d as v,e as y,A as C,n as b,B as d,ah as G,t as c,a as te,a5 as l,ap as D,L as i,o as j,Z as ne,V as L,Y as le,aE as g,p as $}from"./index-tH8kGzNV.js";import{S as ie,a as de,b as oe,c as me,d as xe}from"./select-B8NiX_r6.js";import{S as he}from"./separator-DLBvRYDr.js";import{s as R}from"./settings.service-IQCLWV8g.js";import{C as ue}from"./circle-x-D2gTA4o0.js";import{I as P}from"./info-BmNqUgv1.js";import{C as je}from"./check-DV_4N94Y.js";import{C as ge}from"./copy-CIVXPvX_.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]],fe=Z("settings-2",pe);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],H=Z("triangle-alert",Ne);function ve({onLockSuccess:S,onCancel:x}){const{user:h}=q(),[u,r]=a.useState(!1),k=async()=>{try{if(r(!0),await R.lockAPIConfig(h?.id))c.success("تنظیمات API با موفقیت قفل شد",{description:"منوی تنظیمات از سایدبار حذف خواهد شد"}),S?.();else throw new Error("خطا در قفل کردن تنظیمات")}catch(t){console.error("خطا در قفل کردن:",t),c.error("خطا در قفل کردن تنظیمات",{description:t instanceof Error?t.message:"لطفاً دوباره تلاش کنید"})}finally{r(!1)}};return e.jsxs(p,{className:"border-2 border-green-500/20",children:[e.jsx(f,{className:"pb-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-12 h-12 rounded-full bg-green-500/10",children:e.jsx(w,{className:"h-6 w-6 text-green-500"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx(N,{className:"text-xl",children:"قفل کردن تنظیمات API"}),e.jsx(v,{className:"mt-1",children:"بعد از قفل، منو از سایدبار حذف می‌شود"})]})]})}),e.jsxs(y,{className:"space-y-6",children:[e.jsxs(C,{className:"border-green-500/30 bg-green-500/5",children:[e.jsx(w,{className:"h-5 w-5 text-green-600"}),e.jsx(b,{className:"pr-7",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"font-medium text-green-900",children:"تنظیمات آماده قفل شدن است"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm text-green-800",children:[e.jsx("li",{children:"تنظیمات API با موفقیت تکمیل شده است"}),e.jsx("li",{children:"بعد از قفل، منوی کانفیگ از سایدبار حذف می‌شود"}),e.jsx("li",{children:"برای تغییر تنظیمات باید قفل را باز کنید"}),e.jsx("li",{children:"این عملیات قابل برگشت است"})]})]})})]}),e.jsxs("div",{className:"flex items-center gap-3 pt-4 border-t",children:[e.jsx(d,{onClick:k,disabled:u,className:"flex-1 bg-green-600 hover:bg-green-700",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-2"}),"در حال قفل کردن..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-4 w-4 ml-2"}),"قفل کردن تنظیمات"]})}),x&&e.jsx(d,{variant:"outline",onClick:x,disabled:u,children:"انصراف"})]})]})]})}function X(){const{user:S}=q(),x=te(),[h,u]=a.useState(l.getCurrentEnvironment()),[r,k]=a.useState(h.name),[t,U]=a.useState(""),[E,_]=a.useState("v1"),[T,M]=a.useState(!1),[n,m]=a.useState(null),[Y,V]=a.useState(!1),[F,A]=a.useState(!1),[O,J]=a.useState(!1),[K,B]=a.useState(!0);if(a.useEffect(()=>{(async()=>{try{if(await R.isAPIConfigLocked()){c.error("تنظیمات API قفل شده است",{description:"برای تغییر تنظیمات باید قفل را باز کنید"}),x("/admin");return}B(!1)}catch(o){console.error("خطا در بررسی دسترسی:",o),B(!1)}})()},[x]),a.useEffect(()=>l.subscribe(()=>{u(l.getCurrentEnvironment())}),[]),K)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"در حال بررسی دسترسی..."})]})});const Q=async()=>{M(!0),m(null);try{const s=await l.checkConnection();m(s),s.success?(c.success(s.message),await W()):c.error(s.message)}catch(s){const o={success:!1,message:s.message||"خطا در بررسی اتصال"};m(o),c.error(o.message)}finally{M(!1)}},W=async()=>{try{const s=l.getConfig();await R.saveAPIConfig({baseUrl:s.fullURL,userId:S?.id})&&(J(!0),c.success("تنظیمات با موفقیت در دیتابیس ذخیره شد",{description:"اکنون می‌توانید تنظیمات را قفل کنید"}))}catch(s){console.error("خطا در ذخیره تنظیمات:",s),c.error("خطا در ذخیره تنظیمات در دیتابیس")}},ee=()=>{A(!1),c.success("تنظیمات API قفل شد",{description:"منو از سایدبار حذف می‌شود..."}),setTimeout(()=>{window.location.reload()},2e3)},se=s=>{k(s),s!=="custom"&&(l.setEnvironment(s),m(null),c.success(`محیط به "${g[s].displayName}" تغییر کرد`))},ce=()=>{if(!t.trim()){c.error("لطفاً آدرس URL را وارد کنید");return}try{new URL(t)}catch{c.error("آدرس URL نامعتبر است");return}l.setCustomURL(t.trim(),E.trim()||"v1"),m(null),c.success("URL سفارشی اعمال شد")},z=()=>{l.reset(),k("production"),U(""),_("v1"),m(null),c.success("تنظیمات به حالت پیش‌فرض بازگشت")},ae=async()=>{const s=l.getConfig();try{await navigator.clipboard.writeText(s.fullURL),V(!0),c.success("URL کپی شد"),setTimeout(()=>V(!1),2e3)}catch{c.error("خطا در کپی کردن")}},re=()=>n?n.success?"default":"destructive":"secondary",I=l.getConfig();return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"flex items-center gap-2 mb-2",children:[e.jsx(D,{className:"h-6 w-6"}),"تنظیمات API"]}),e.jsx("p",{className:"text-muted-foreground",children:"مدیریت و پیکربندی اتصال به سرور API"})]}),e.jsxs(p,{children:[e.jsxs(f,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(fe,{className:"h-5 w-5"}),"پیکربندی فعلی"]}),e.jsx(v,{children:"اطلاعات اتصال فعلی به سرور API"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-xs text-muted-foreground",children:"محیط فعال"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{variant:"outline",className:"text-sm",children:h.displayName}),h.name==="production"&&e.jsxs(j,{variant:"default",className:"text-xs",children:[e.jsx(ne,{className:"h-3 w-3 ml-1"}),"تولید"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-xs text-muted-foreground",children:"وضعیت اتصال"}),e.jsx("div",{children:n?e.jsx(j,{variant:re(),className:"text-sm",children:n.success?e.jsxs(e.Fragment,{children:[e.jsx(w,{className:"h-3 w-3 ml-1"}),"متصل ",n.latency&&`(${n.latency}ms)`]}):e.jsxs(e.Fragment,{children:[e.jsx(ue,{className:"h-3 w-3 ml-1"}),"قطع شده"]})}):e.jsxs(j,{variant:"secondary",className:"text-sm",children:[e.jsx(P,{className:"h-3 w-3 ml-1"}),"نامشخص"]})})]})]}),e.jsx(he,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{className:"text-xs text-muted-foreground",children:"Base URL"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("code",{className:"flex-1 bg-muted px-3 py-2 rounded-md text-sm font-mono",children:I.baseURL}),e.jsx(d,{variant:"outline",size:"sm",onClick:ae,className:"shrink-0",children:Y?e.jsx(je,{className:"h-4 w-4"}):e.jsx(ge,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{className:"text-xs text-muted-foreground",children:"نسخه API"}),e.jsx("code",{className:"block bg-muted px-3 py-2 rounded-md text-sm font-mono",children:I.version})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(i,{className:"text-xs text-muted-foreground",children:"URL کامل"}),e.jsx("code",{className:"block bg-muted px-3 py-2 rounded-md text-sm font-mono break-all",children:I.fullURL})]})]}),e.jsx("div",{className:"flex gap-2 pt-2",children:e.jsx(d,{onClick:Q,disabled:T,className:"flex-1",children:T?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"h-4 w-4 ml-2 animate-spin"}),"در حال بررسی..."]}):e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"h-4 w-4 ml-2"}),"بررسی اتصال"]})})}),n&&!n.success&&e.jsxs(C,{variant:"destructive",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsx(b,{children:n.message})]})]})]}),e.jsxs(p,{children:[e.jsxs(f,{children:[e.jsxs(N,{className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-5 w-5"}),"انتخاب محیط"]}),e.jsx(v,{children:"انتخاب محیط سرور برای اتصال"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"محیط سرور"}),e.jsxs(ie,{value:r,onValueChange:se,children:[e.jsx(de,{children:e.jsx(oe,{})}),e.jsx(me,{children:Object.values(g).map(s=>e.jsx(xe,{value:s.name,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.displayName}),s.name==="production"&&e.jsx(j,{variant:"default",className:"text-xs",children:"توصیه شده"})]})},s.name))})]})]}),r&&r!=="custom"&&e.jsxs(C,{children:[e.jsx(P,{className:"h-4 w-4"}),e.jsxs(b,{children:[g[r].description,e.jsx("br",{}),e.jsxs("code",{className:"text-xs mt-1 block",children:[g[r].baseURL,"/",g[r].version]})]})]}),r==="custom"&&e.jsxs("div",{className:"space-y-4 pt-4 border-t",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"آدرس سرور سفارشی"}),e.jsx($,{type:"url",placeholder:"https://api.example.com",value:t,onChange:s=>U(s.target.value),dir:"ltr",className:"text-left font-mono"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"آدرس پایه سرور API را وارد کنید (بدون / در انتها)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{children:"نسخه API"}),e.jsx($,{type:"text",placeholder:"v1",value:E,onChange:s=>_(s.target.value),dir:"ltr",className:"text-left font-mono"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"نسخه API (معمولاً v1)"})]}),e.jsxs(d,{onClick:ce,disabled:!t.trim(),className:"w-full",children:[e.jsx(w,{className:"h-4 w-4 ml-2"}),"اعمال تنظیمات سفارشی"]})]})]})]}),O&&n?.success&&!F&&e.jsx("div",{className:"space-y-4",children:e.jsxs(p,{className:"border-2 border-green-500/30 bg-green-50/50",children:[e.jsxs(f,{children:[e.jsxs(N,{className:"flex items-center gap-2 text-green-700",children:[e.jsx(w,{className:"h-5 w-5"}),"تنظیمات آماده قفل شدن"]}),e.jsx(v,{children:"تنظیمات API با موفقیت تکمیل و در دیتابیس ذخیره شد"})]}),e.jsxs(y,{className:"space-y-4",children:[e.jsxs(C,{className:"border-green-500/30 bg-green-100/50",children:[e.jsx(P,{className:"h-4 w-4 text-green-600"}),e.jsx(b,{className:"text-green-800",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{children:e.jsx("strong",{children:"توجه مهم:"})}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-sm mr-4",children:[e.jsx("li",{children:'با قفل کردن تنظیمات، منوی "تنظیمات API" از سایدبار حذف خواهد شد'}),e.jsx("li",{children:"این عملیات برای افزایش امنیت سیستم انجام می‌شود"}),e.jsx("li",{children:"در صورت نیاز به تغییر، می‌توانید قفل را باز کنید"})]})]})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(d,{onClick:()=>A(!0),className:"flex-1 bg-green-600 hover:bg-green-700",children:[e.jsx(G,{className:"h-4 w-4 ml-2"}),"قفل کردن تنظیمات"]}),e.jsxs(d,{variant:"outline",onClick:z,children:[e.jsx(L,{className:"h-4 w-4 ml-2"}),"بازنشانی"]})]})]})]})}),F&&e.jsx("div",{className:"space-y-4",children:e.jsx(ve,{onLockSuccess:ee,onCancel:()=>A(!1)})}),!O&&e.jsxs(p,{children:[e.jsxs(f,{children:[e.jsx(N,{children:"عملیات"}),e.jsx(v,{children:"بازنشانی و مدیریت تنظیمات"})]}),e.jsxs(y,{children:[e.jsx("div",{className:"flex gap-2",children:e.jsxs(d,{variant:"outline",onClick:z,className:"flex-1",children:[e.jsx(L,{className:"h-4 w-4 ml-2"}),"بازنشانی به پیش‌فرض"]})}),e.jsxs(C,{className:"mt-4",children:[e.jsx(H,{className:"h-4 w-4"}),e.jsxs(b,{children:[e.jsx("strong",{children:"توجه:"})," تغییر محیط API ممکن است بر عملکرد سیستم تأثیر بگذارد. لطفاً قبل از تغییر، از صحت تنظیمات مطمئن شوید."]})]})]})]}),!1]})}const Le=Object.freeze(Object.defineProperty({__proto__:null,default:X},Symbol.toStringTag,{value:"Module"})),Pe=Object.freeze(Object.defineProperty({__proto__:null,default:X},Symbol.toStringTag,{value:"Module"}));export{Le as A,Pe as a};
