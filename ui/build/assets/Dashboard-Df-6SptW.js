import{u as Y,i as G,r as l,t as u,v as m,x as C,w as v,j as e,C as c,e as o,O as H,ag as d,B as i,T as J,b as g,c as j,d as p,o as f,W as k}from"./index-tH8kGzNV.js";import{r as x}from"./real-api-client-o-2gE2Hp.js";import{M as b}from"./message-square-Gum9_klA.js";import{R as E,A as Q,C as V,X as Z,Y as _,T as F,a as y,P as ee,b as se,c as ae}from"./AreaChart-D5HVI-Po.js";import{C as te}from"./clock-BiwlPOks.js";async function P(){return(await x.get("/user/dashboard/stats")).data}async function R(){return(await x.get("/user/dashboard/monthly")).data.monthlyData||[]}async function I(){return(await x.get("/user/dashboard/parts-categories")).data.categories||[]}async function T(){return(await x.get("/user/dashboard/activities")).data.activities||[]}async function K(){return(await x.get("/user/profile/check")).data}async function re(){const[t,w,n,N,h]=await Promise.all([P(),R(),I(),T(),K()]);return{stats:t,monthlyData:w,categories:n,activities:N,profileCheck:h}}const ne={getStats:P,getMonthlyData:R,getPartsCategories:I,getRecentActivities:T,checkProfileComplete:K,loadAll:re};function xe(){const{user:t}=Y(),n=G().pathname.startsWith("/demo"),[N,h]=l.useState(!0),[a,D]=l.useState(null),[L,A]=l.useState([]),[S,q]=l.useState([]),[M,B]=l.useState([]),[O,$]=l.useState(!1);l.useEffect(()=>{z()},[]);const z=async()=>{try{h(!0);const s=await ne.loadAll();D(s.stats),A(s.monthlyData),q(s.categories),B(s.activities.map(r=>({...r,icon:U(r.type)}))),$(!s.profileCheck.isComplete)}catch(s){console.error("Error fetching dashboard data:",s),s.response?.status===401?u.error("لطفاً مجدداً وارد شوید"):s.code==="ECONNABORTED"||s.message==="Network Error"?u.error("مشکل در اتصال به سرور. لطفاً اتصال اینترنت خود را بررسی کنید."):s.response?.status>=500?u.error("مشکلی در سرور پیش آمده است. لطفاً بعداً تلاش کنید."):u.error("خطا در بارگذاری اطلاعات داشبورد"),D({partsCount:0,transfersCount:0,elevatorsCount:0,requestsCount:0,partsChange:0,transfersChange:0,elevatorsChange:0,requestsChange:0}),A([]),q([]),B([]),$(!1)}finally{h(!1)}},U=s=>{switch(s){case"transfer":return v;case"elevator":return C;case"request":return b;case"part":return m;default:return m}},W=[{title:"قطعات در مالکیت",value:a?.partsCount?.toString()||"0",change:a?.partsChange?`+${a.partsChange}`:"0",trend:"up",icon:m,color:"text-blue-600",bgColor:"bg-blue-50"},{title:"انتقال‌های انجام شده",value:a?.transfersCount?.toString()||"0",change:a?.transfersChange?`+${a.transfersChange}`:"0",trend:"up",icon:v,color:"text-green-600",bgColor:"bg-green-50"},{title:"آسانسورهای ثبت شده",value:a?.elevatorsCount?.toString()||"0",change:a?.elevatorsChange?`+${a.elevatorsChange}`:"0",trend:"up",icon:C,color:"text-purple-600",bgColor:"bg-purple-50"},{title:"درخواست‌های باز",value:a?.requestsCount?.toString()||"0",change:a?.requestsChange?`${a.requestsChange}`:"0",trend:(a?.requestsChange||0)>=0?"up":"down",icon:b,color:"text-orange-600",bgColor:"bg-orange-50"}],X=s=>{switch(s){case"completed":return e.jsxs(f,{className:"bg-green-100 text-green-800",children:[e.jsx(k,{className:"w-3 h-3 ml-1"}),"تکمیل شده"]});case"pending":return e.jsxs(f,{className:"bg-yellow-100 text-yellow-800",children:[e.jsx(te,{className:"w-3 h-3 ml-1"}),"در انتظار"]});case"approved":return e.jsxs(f,{className:"bg-blue-100 text-blue-800",children:[e.jsx(k,{className:"w-3 h-3 ml-1"}),"تایید شده"]});default:return e.jsx(f,{variant:"secondary",children:s})}};return N?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"در حال بارگذاری داشبورد..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"داشبورد"}),e.jsxs("p",{className:"text-muted-foreground",children:["خوش آمدید ",t?.companyName||t?.username]})]}),O&&e.jsx(c,{className:"border-orange-200 bg-orange-50",children:e.jsx(o,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(H,{className:"w-5 h-5 text-orange-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-orange-800",children:"پروفایل شرکت شما نیاز به تکمیل دارد"}),e.jsx("p",{className:"text-sm text-orange-600",children:"برای استفاده کامل از خدمات، لطفاً اطلاعات شرکت خود را تکمیل کنید."})]}),e.jsx(d,{to:n?"/demo/user/profile":"/api/user/profile",children:e.jsx(i,{variant:"outline",size:"sm",className:"text-orange-600 border-orange-300",children:"تکمیل پروفایل"})})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:W.map((s,r)=>e.jsx(c,{children:e.jsx(o,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:s.title}),e.jsx("p",{className:"text-2xl font-bold",children:s.value}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(J,{className:`h-4 w-4 ${s.trend==="up"?"text-green-600":"text-red-600"}`}),e.jsx("span",{className:`text-sm ${s.trend==="up"?"text-green-600":"text-red-600"}`,children:s.change}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"این ماه"})]})]}),e.jsx("div",{className:`p-3 rounded-lg ${s.bgColor}`,children:e.jsx(s.icon,{className:`h-6 w-6 ${s.color}`})})]})})},r))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(c,{children:[e.jsxs(g,{children:[e.jsx(j,{children:"روند ماهانه فعالیت‌ها"}),e.jsx(p,{children:"تعداد قطعات، انتقال‌ها و آسانسورها در ۶ ماه اخیر"})]}),e.jsx(o,{children:e.jsx("div",{className:"h-80",children:e.jsx(E,{width:"100%",height:"100%",children:e.jsxs(Q,{data:L,children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(Z,{dataKey:"month"}),e.jsx(_,{}),e.jsx(F,{}),e.jsx(y,{type:"monotone",dataKey:"parts",stackId:"1",stroke:"#0088FE",fill:"#0088FE",name:"قطعات"}),e.jsx(y,{type:"monotone",dataKey:"transfers",stackId:"1",stroke:"#00C49F",fill:"#00C49F",name:"انتقال‌ها"}),e.jsx(y,{type:"monotone",dataKey:"elevators",stackId:"1",stroke:"#FFBB28",fill:"#FFBB28",name:"آسانسورها"})]})})})})]}),e.jsxs(c,{children:[e.jsxs(g,{children:[e.jsx(j,{children:"توزیع انواع قطعات"}),e.jsx(p,{children:"درصد انواع قطعات در مالکیت شما"})]}),e.jsx(o,{children:e.jsx("div",{className:"h-80",children:e.jsx(E,{width:"100%",height:"100%",children:e.jsxs(ee,{children:[e.jsx(se,{data:S,cx:"50%",cy:"50%",outerRadius:80,fill:"#8884d8",dataKey:"value",label:({name:s,percent:r})=>`${s} ${(r*100).toFixed(0)}%`,children:S.map((s,r)=>e.jsx(ae,{fill:s.color},`cell-${r}`))}),e.jsx(F,{})]})})})})]})]}),e.jsxs(c,{children:[e.jsx(g,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(j,{children:"فعالیت‌های اخیر"}),e.jsx(p,{children:"آخرین تغییرات و فعالیت‌های شما"})]}),e.jsx(i,{variant:"outline",size:"sm",children:"مشاهده همه"})]})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-4",children:M.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-50",children:e.jsx(s.icon,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.title}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.description})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[X(s.status),e.jsx("span",{className:"text-sm text-muted-foreground",children:s.time})]})]},s.id))})})]}),e.jsxs(c,{children:[e.jsxs(g,{children:[e.jsx(j,{children:"اقدامات سریع"}),e.jsx(p,{children:"دسترسی سریع به عملیات پرکاربرد"})]}),e.jsx(o,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(d,{to:n?"/demo/user/products":"/api/user/products",children:e.jsxs(i,{variant:"outline",className:"h-24 flex-col gap-2 w-full",children:[e.jsx(m,{className:"w-6 h-6"}),"ثبت قطعه جدید"]})}),e.jsx(d,{to:n?"/demo/user/transfers":"/api/user/transfers",children:e.jsxs(i,{variant:"outline",className:"h-24 flex-col gap-2 w-full",children:[e.jsx(v,{className:"w-6 h-6"}),"انتقال قطعه"]})}),e.jsx(d,{to:n?"/demo/user/elevators":"/api/user/elevators",children:e.jsxs(i,{variant:"outline",className:"h-24 flex-col gap-2 w-full",children:[e.jsx(C,{className:"w-6 h-6"}),"ثبت آسانسور"]})}),e.jsx(d,{to:n?"/demo/user/requests":"/api/user/requests",children:e.jsxs(i,{variant:"outline",className:"h-24 flex-col gap-2 w-full",children:[e.jsx(b,{className:"w-6 h-6"}),"ثبت درخواست"]})})]})})]})]})}export{xe as default};
