import{r as j,t as f,j as e,B as n,C as l,e as r,v as F,w as S,x as E,T as U,b as i,c as d,X as I,d as x}from"./index-tH8kGzNV.js";import{S as B,a as L,b as T,c as K,d as t}from"./select-B8NiX_r6.js";import{r as A}from"./real-api-client-o-2gE2Hp.js";import{D as u}from"./download-BGqk_jGh.js";import{F as X}from"./funnel-CKnlbCCZ.js";import{R as N,A as O,C as v,X as y,Y as w,T as g,a as C,P as Y,b as q,c as G,B as H}from"./AreaChart-D5HVI-Po.js";import{L as W,a as z,B as J}from"./BarChart-DzxdONkP.js";import{F as P}from"./file-text-DbNNqFYp.js";import"./index-BdQq_4o_.js";import"./Combination-Dzecd94B.js";import"./index-BuiImgyP.js";import"./check-DV_4N94Y.js";function de(){const[V,b]=j.useState(!0),[o,_]=j.useState("last_month"),[m,$]=j.useState("overview"),[a,k]=j.useState(null);j.useEffect(()=>{D()},[o,m]);const D=async()=>{try{b(!0);const s=await A.get("/user/reports",{params:{dateRange:o,reportType:m}});k(s.data)}catch(s){console.error("Error fetching reports data:",s),f.error("خطا در بارگذاری اطلاعات گزارش‌ها"),k({monthlyData:[],partsCategoryData:[],transferValueData:[],elevatorStatusData:[],summary:{totalParts:0,totalTransfers:0,totalElevators:0,totalValue:0}})}finally{b(!1)}},p=async s=>{try{const c=await A.get("/user/reports/export",{params:{format:s,dateRange:o,reportType:m},responseType:"blob"}),R=window.URL.createObjectURL(new Blob([c.data])),h=document.createElement("a");h.href=R,h.setAttribute("download",`report-${o}.${s}`),document.body.appendChild(h),h.click(),h.remove(),window.URL.revokeObjectURL(R),f.success(`گزارش ${s.toUpperCase()} با موفقیت دانلود شد`)}catch(c){console.error("Error exporting report:",c),f.error(`خطا در دانلود گزارش ${s.toUpperCase()}`)}};return V?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"در حال بارگذاری گزارش‌ها..."})]})}):a?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"گزارش‌ها و تحلیل‌ها"}),e.jsx("p",{className:"text-muted-foreground",children:"مشاهده آمار و گزارش‌های تفصیلی"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{variant:"outline",onClick:()=>p("pdf"),className:"gap-2",children:[e.jsx(u,{className:"w-4 h-4"}),"PDF"]}),e.jsxs(n,{variant:"outline",onClick:()=>p("excel"),className:"gap-2",children:[e.jsx(u,{className:"w-4 h-4"}),"Excel"]})]})]}),e.jsx(l,{children:e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(X,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm font-medium",children:"فیلترها:"})]}),e.jsxs(B,{value:m,onValueChange:$,children:[e.jsx(L,{className:"w-full md:w-48",children:e.jsx(T,{placeholder:"نوع گزارش"})}),e.jsxs(K,{children:[e.jsx(t,{value:"overview",children:"خلاصه کلی"}),e.jsx(t,{value:"parts",children:"گزارش قطعات"}),e.jsx(t,{value:"transfers",children:"گزارش انتقالات"}),e.jsx(t,{value:"elevators",children:"گزارش آسانسورها"}),e.jsx(t,{value:"financial",children:"گزارش مالی"})]})]}),e.jsxs(B,{value:o,onValueChange:_,children:[e.jsx(L,{className:"w-full md:w-48",children:e.jsx(T,{placeholder:"بازه زمانی"})}),e.jsxs(K,{children:[e.jsx(t,{value:"last_week",children:"هفته گذشته"}),e.jsx(t,{value:"last_month",children:"ماه گذشته"}),e.jsx(t,{value:"last_3_months",children:"سه ماه گذشته"}),e.jsx(t,{value:"last_6_months",children:"شش ماه گذشته"}),e.jsx(t,{value:"last_year",children:"سال گذشته"})]})]})]})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(l,{children:e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(F,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"کل قطعات"}),e.jsx("p",{className:"text-xl font-bold",children:a.summary.totalParts})]})]})})}),e.jsx(l,{children:e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(S,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"کل انتقالات"}),e.jsx("p",{className:"text-xl font-bold",children:a.summary.totalTransfers})]})]})})}),e.jsx(l,{children:e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(E,{className:"w-5 h-5 text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"کل آسانسورها"}),e.jsx("p",{className:"text-xl font-bold",children:a.summary.totalElevators})]})]})})}),e.jsx(l,{children:e.jsx(r,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(U,{className:"w-5 h-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"ارزش کل (ریال)"}),e.jsx("p",{className:"text-xl font-bold",children:a.summary.totalValue.toLocaleString()})]})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"w-5 h-5"}),"فعالیت ماهانه"]}),e.jsx(x,{children:"روند فعالیت‌ها در ماه‌های اخیر"})]}),e.jsx(r,{children:e.jsx("div",{className:"h-80",children:e.jsx(N,{width:"100%",height:"100%",children:e.jsxs(O,{data:a.monthlyData,children:[e.jsx(v,{strokeDasharray:"3 3"}),e.jsx(y,{dataKey:"month"}),e.jsx(w,{}),e.jsx(g,{}),e.jsx(C,{type:"monotone",dataKey:"parts",stackId:"1",stroke:"#0088FE",fill:"#0088FE",name:"قطعات"}),e.jsx(C,{type:"monotone",dataKey:"transfers",stackId:"1",stroke:"#00C49F",fill:"#00C49F",name:"انتقالات"}),e.jsx(C,{type:"monotone",dataKey:"elevators",stackId:"1",stroke:"#FFBB28",fill:"#FFBB28",name:"آسانسورها"})]})})})})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"}),"توزیع دسته‌بندی قطعات"]}),e.jsx(x,{children:"درصد هر دسته از کل قطعات"})]}),e.jsx(r,{children:e.jsx("div",{className:"h-80",children:e.jsx(N,{width:"100%",height:"100%",children:e.jsxs(Y,{children:[e.jsx(q,{data:a.partsCategoryData,cx:"50%",cy:"50%",outerRadius:80,fill:"#8884d8",dataKey:"value",label:({name:s,percent:c})=>`${s} ${(c*100).toFixed(0)}%`,children:a.partsCategoryData.map((s,c)=>e.jsx(G,{fill:s.color},`cell-${c}`))}),e.jsx(g,{})]})})})})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5"}),"روند ارزش انتقالات"]}),e.jsx(x,{children:"تغییرات ارزش انتقالات در طول زمان"})]}),e.jsx(r,{children:e.jsx("div",{className:"h-80",children:e.jsx(N,{width:"100%",height:"100%",children:e.jsxs(W,{data:a.transferValueData,children:[e.jsx(v,{strokeDasharray:"3 3"}),e.jsx(y,{dataKey:"date"}),e.jsx(w,{}),e.jsx(g,{formatter:s=>`${s.toLocaleString()} ریال`}),e.jsx(z,{type:"monotone",dataKey:"value",stroke:"#8884d8",strokeWidth:2,name:"ارزش"})]})})})})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),"وضعیت آسانسورها"]}),e.jsx(x,{children:"توزیع آسانسورها بر اساس وضعیت"})]}),e.jsx(r,{children:e.jsx("div",{className:"h-80",children:e.jsx(N,{width:"100%",height:"100%",children:e.jsxs(J,{data:a.elevatorStatusData,children:[e.jsx(v,{strokeDasharray:"3 3"}),e.jsx(y,{dataKey:"status"}),e.jsx(w,{}),e.jsx(g,{}),e.jsx(H,{dataKey:"count",fill:"#8884d8"})]})})})})]})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsxs(d,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5"}),"جدول تفصیلی انتقالات"]}),e.jsx(x,{children:"آخرین انتقالات با جزئیات"})]}),e.jsx(r,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-right p-2",children:"تاریخ"}),e.jsx("th",{className:"text-right p-2",children:"دریافتی"}),e.jsx("th",{className:"text-right p-2",children:"ارسالی"}),e.jsx("th",{className:"text-right p-2",children:"ارزش (ریال)"})]})}),e.jsx("tbody",{children:a.transferValueData.map((s,c)=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"p-2",children:s.date}),e.jsx("td",{className:"p-2 text-green-600",children:s.incoming}),e.jsx("td",{className:"p-2 text-blue-600",children:s.outgoing}),e.jsx("td",{className:"p-2 font-medium",children:s.value.toLocaleString()})]},c))})]})})})]}),e.jsxs(l,{children:[e.jsxs(i,{children:[e.jsx(d,{children:"عملیات گزارش"}),e.jsx(x,{children:"دانلود و اشتراک‌گذاری گزارش‌ها"})]}),e.jsx(r,{children:e.jsxs("div",{className:"flex flex-wrap gap-3",children:[e.jsxs(n,{onClick:()=>p("pdf"),className:"gap-2",children:[e.jsx(u,{className:"w-4 h-4"}),"دانلود PDF"]}),e.jsxs(n,{variant:"outline",onClick:()=>p("excel"),className:"gap-2",children:[e.jsx(u,{className:"w-4 h-4"}),"دانلود Excel"]}),e.jsxs(n,{variant:"outline",onClick:()=>window.print(),className:"gap-2",children:[e.jsx(P,{className:"w-4 h-4"}),"چاپ گزارش"]})]})})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-muted-foreground",children:"خطا در بارگذاری اطلاعات گزارش"}),e.jsx(n,{onClick:()=>D(),className:"mt-4",variant:"outline",children:"تلاش مجدد"})]})}export{de as default};
