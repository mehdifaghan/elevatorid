import{r as i,t as N,j as e,B as f,C as h,e as m,b as ae,c as re,d as le,p as G,V as ie,O as ne,W as ce,o as y,G as de,Q as oe,L as b,q as xe}from"./index-tH8kGzNV.js";import{T as he,a as me,b as V,c as p,d as pe,e as j}from"./table-DC3MYrD8.js";import{D as B,b as O,c as $,d as H,e as z}from"./dialog-DAjwwShP.js";import{D as je,a as ue,b as ge,c as Ne}from"./dropdown-menu-BKfQT_JD.js";import{S as w,a as C,b as S,c as R,d as t}from"./select-B8NiX_r6.js";import{T as fe}from"./textarea-1hTYB3HE.js";import{r as A}from"./real-api-client-o-2gE2Hp.js";import{P as ve}from"./plus-A2-5MgKF.js";import{S as be}from"./search-8LTSveb2.js";import{C as ye}from"./circle-x-D2gTA4o0.js";import{C as we}from"./clock-BiwlPOks.js";import{M as P}from"./message-square-Gum9_klA.js";import{E as Ce}from"./ellipsis-J_HkHiqq.js";import"./index-DGGMjIYi.js";import"./Combination-Dzecd94B.js";import"./x-B6dSK8zO.js";import"./chevron-right-B97jr1RJ.js";import"./check-DV_4N94Y.js";import"./index-BdQq_4o_.js";import"./index-BuiImgyP.js";function We(){const[a,d]=i.useState([]),[c,o]=i.useState(!0),[x,v]=i.useState(""),[u,n]=i.useState("all"),[l,Q]=i.useState("all"),[D,E]=i.useState(null),[I,T]=i.useState(!1),[L,k]=i.useState(!1),[g,M]=i.useState({total:0,pending:0,approved:0,rejected:0,inReview:0}),U={pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800",in_review:"bg-blue-100 text-blue-800"},W={pending:"در انتظار",approved:"تایید شده",rejected:"رد شده",in_review:"در حال بررسی"},X={pending:we,approved:ce,rejected:ye,in_review:ne},J={profile_update:"به‌روزرسانی پروفایل",part_change:"تغییر قطعه",complaint:"شکایت",support:"پشتیبانی"},K={low:"text-gray-600",medium:"text-blue-600",high:"text-orange-600",urgent:"text-red-600"},Y={low:"کم",medium:"متوسط",high:"بالا",urgent:"فوری"};i.useEffect(()=>{_()},[]);const _=async()=>{try{o(!0);const r=(await A.get("/user/requests")).data.requests||[];d(r),M(Z(r))}catch(s){console.error("Error fetching requests:",s),N.error("خطا در بارگذاری اطلاعات درخواست‌ها"),d([]),M({total:0,pending:0,approved:0,rejected:0,inReview:0})}finally{o(!1)}},Z=s=>({total:s.length,pending:s.filter(r=>r.status==="pending").length,approved:s.filter(r=>r.status==="approved").length,rejected:s.filter(r=>r.status==="rejected").length,inReview:s.filter(r=>r.status==="in_review").length}),F=a.filter(s=>{const r=s.title.toLowerCase().includes(x.toLowerCase())||s.description.toLowerCase().includes(x.toLowerCase()),se=u==="all"||s.status===u,te=l==="all"||s.type===l;return r&&se&&te}),q=async()=>{k(!0),await _(),k(!1),N.success("درخواست‌ها با موفقیت به‌روزرسانی شد")},ee=async s=>{try{(await A.post("/user/requests",s)).data&&(await _(),N.success("درخواست جدید با موفقیت ثبت شد"))}catch(r){console.error("Error creating request:",r),N.error("خطا در ثبت درخواست جدید")}};return c?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"در حال بارگذاری درخواست‌ها..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"درخواست‌ها و شکایات"}),e.jsx("p",{className:"text-muted-foreground",children:"مدیریت درخواست‌ها و پیگیری وضعیت"})]}),e.jsxs(f,{onClick:()=>T(!0),className:"bg-black hover:bg-gray-800 text-white",children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"درخواست جدید"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[e.jsx(h,{className:"border-l-4 border-l-blue-500",children:e.jsx(m,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-blue-600",children:g.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"کل درخواست‌ها"})]})})}),e.jsx(h,{className:"border-l-4 border-l-yellow-500",children:e.jsx(m,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-yellow-600",children:g.pending}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"در انتظار"})]})})}),e.jsx(h,{className:"border-l-4 border-l-green-500",children:e.jsx(m,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-green-600",children:g.approved}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"تایید شده"})]})})}),e.jsx(h,{className:"border-l-4 border-l-red-500",children:e.jsx(m,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-red-600",children:g.rejected}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"رد شده"})]})})}),e.jsx(h,{className:"border-l-4 border-l-indigo-500",children:e.jsx(m,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-indigo-600",children:g.inReview}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"در حال بررسی"})]})})})]}),e.jsxs(h,{children:[e.jsxs(ae,{children:[e.jsx(re,{children:"لیست درخواست‌ها"}),e.jsx(le,{children:"مشاهده و مدیریت درخواست‌ها و شکایات ارسالی"})]}),e.jsxs(m,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(be,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(G,{placeholder:"جستجو در درخواست‌ها...",value:x,onChange:s=>v(s.target.value),className:"pr-10"})]}),e.jsxs(f,{variant:"outline",size:"sm",onClick:q,disabled:L,className:"gap-2 shrink-0",children:[e.jsx(ie,{className:`h-4 w-4 ${L?"animate-spin":""}`}),L?"در حال بارگذاری...":"تازه‌سازی"]}),e.jsxs(w,{value:u,onValueChange:n,children:[e.jsx(C,{className:"w-full md:w-40",children:e.jsx(S,{placeholder:"وضعیت"})}),e.jsxs(R,{children:[e.jsx(t,{value:"all",children:"همه وضعیت‌ها"}),e.jsx(t,{value:"pending",children:"در انتظار"}),e.jsx(t,{value:"approved",children:"تایید شده"}),e.jsx(t,{value:"rejected",children:"رد شده"}),e.jsx(t,{value:"in_review",children:"در حال بررسی"})]})]}),e.jsxs(w,{value:l,onValueChange:Q,children:[e.jsx(C,{className:"w-full md:w-40",children:e.jsx(S,{placeholder:"نوع"})}),e.jsxs(R,{children:[e.jsx(t,{value:"all",children:"همه انواع"}),e.jsx(t,{value:"profile_update",children:"به‌روزرسانی پروفایل"}),e.jsx(t,{value:"part_change",children:"تغییر قطعه"}),e.jsx(t,{value:"complaint",children:"شکایت"}),e.jsx(t,{value:"support",children:"پشتیبانی"})]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(he,{children:[e.jsx(me,{children:e.jsxs(V,{children:[e.jsx(p,{children:"عنوان درخواست"}),e.jsx(p,{children:"نوع"}),e.jsx(p,{children:"اولویت"}),e.jsx(p,{children:"تاریخ ثبت"}),e.jsx(p,{children:"وضعیت"}),e.jsx(p,{children:"عملیات"})]})}),e.jsx(pe,{children:F.map(s=>{const r=X[s.status];return e.jsxs(V,{children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.title}),e.jsx("div",{className:"text-sm text-muted-foreground max-w-md truncate",children:s.description})]})]})}),e.jsx(j,{children:e.jsx(y,{variant:"outline",children:J[s.type]})}),e.jsx(j,{children:e.jsx("span",{className:`font-medium ${K[s.priority]}`,children:Y[s.priority]})}),e.jsx(j,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-gray-500"}),s.submitDate]})}),e.jsx(j,{children:e.jsxs(y,{variant:"secondary",className:`${U[s.status]} flex items-center gap-1 w-fit`,children:[e.jsx(r,{className:"w-3 h-3"}),W[s.status]]})}),e.jsx(j,{children:e.jsxs(je,{children:[e.jsx(ue,{asChild:!0,children:e.jsx(f,{variant:"ghost",size:"sm",children:e.jsx(Ce,{className:"w-4 h-4"})})}),e.jsx(ge,{align:"end",dir:"rtl",children:e.jsxs(Ne,{onClick:()=>E(s),children:[e.jsx(oe,{className:"w-4 h-4 mr-2"}),"مشاهده جزئیات"]})})]})})]},s.id)})})]})}),F.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(P,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"درخواستی یافت نشد"})]})]})]}),D&&e.jsx(B,{open:!!D,onOpenChange:()=>E(null),children:e.jsxs(O,{className:"max-w-2xl",dir:"rtl",children:[e.jsxs($,{className:"text-right",children:[e.jsx(H,{className:"text-right",children:"جزئیات درخواست"}),e.jsx(z,{className:"text-right",children:"مشاهده اطلاعات کامل درخواست و پاسخ ادمین"})]}),e.jsx(Se,{request:D})]})}),I&&e.jsx(B,{open:I,onOpenChange:T,children:e.jsxs(O,{className:"max-w-2xl",dir:"rtl",children:[e.jsxs($,{className:"text-right",children:[e.jsx(H,{className:"text-right",children:"ثبت درخواست جدید"}),e.jsx(z,{className:"text-right",children:"اطلاعات درخواست جدید را وارد کنید"})]}),e.jsx(Re,{onSubmit:ee,onClose:()=>T(!1)})]})})]})}function Se({request:a}){const d=statusIcons[a.status];return e.jsx("div",{className:"space-y-6",dir:"rtl",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold",children:a.title}),e.jsx(y,{variant:"outline",className:"mt-1",children:typeLabels[a.type]})]}),e.jsxs(y,{variant:"secondary",className:`${statusColors[a.status]} flex items-center gap-1`,children:[e.jsx(d,{className:"w-3 h-3"}),statusLabels[a.status]]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"تاریخ ثبت:"}),e.jsx("p",{className:"font-medium",children:a.submitDate})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"اولویت:"}),e.jsx("p",{className:`font-medium ${priorityColors[a.priority]}`,children:priorityLabels[a.priority]})]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"شرح درخواست:"}),e.jsx("p",{className:"mt-1 p-3 bg-gray-50 rounded-lg text-sm",children:a.description})]}),a.adminResponse&&e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-medium",children:"پاسخ ادمین:"}),a.responseDate&&e.jsx("span",{className:"text-sm text-muted-foreground",children:a.responseDate})]}),e.jsx("p",{className:"p-3 bg-blue-50 rounded-lg text-sm",children:a.adminResponse})]})]})})}function Re({onSubmit:a,onClose:d}){const[c,o]=i.useState({type:"",title:"",description:"",priority:"medium"}),[x,v]=i.useState(!1),u=async n=>{if(n.preventDefault(),!c.type||!c.title||!c.description){N.error("لطفاً تمام فیلدهای ضروری را پر کنید");return}try{v(!0),await a(c),d()}catch(l){console.error("Error submitting request:",l)}finally{v(!1)}};return e.jsxs("form",{onSubmit:u,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"نوع درخواست *"}),e.jsxs(w,{value:c.type,onValueChange:n=>o(l=>({...l,type:n})),children:[e.jsx(C,{children:e.jsx(S,{placeholder:"نوع درخواست را انتخاب کنید"})}),e.jsxs(R,{children:[e.jsx(t,{value:"profile_update",children:"به‌روزرسانی پروفایل"}),e.jsx(t,{value:"part_change",children:"تغییر قطعه"}),e.jsx(t,{value:"complaint",children:"شکایت"}),e.jsx(t,{value:"support",children:"پشتیبانی"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"عنوان درخواست *"}),e.jsx(G,{value:c.title,onChange:n=>o(l=>({...l,title:n.target.value})),placeholder:"عنوان مختصر درخواست",className:"text-right"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"اولویت"}),e.jsxs(w,{value:c.priority,onValueChange:n=>o(l=>({...l,priority:n})),children:[e.jsx(C,{children:e.jsx(S,{})}),e.jsxs(R,{children:[e.jsx(t,{value:"low",children:"کم"}),e.jsx(t,{value:"medium",children:"متوسط"}),e.jsx(t,{value:"high",children:"بالا"}),e.jsx(t,{value:"urgent",children:"فوری"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{children:"شرح درخواست *"}),e.jsx(fe,{value:c.description,onChange:n=>o(l=>({...l,description:n.target.value})),placeholder:"شرح کامل درخواست خود را بنویسید...",className:"min-h-24 text-right",dir:"rtl"})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(f,{type:"button",variant:"outline",onClick:d,children:"انصراف"}),e.jsx(f,{type:"submit",disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx(xe,{className:"w-4 h-4 ml-2 animate-spin"}),"در حال ثبت..."]}):"ثبت درخواست"})]})]})}export{We as default};
