import{r as x,t as n,j as e,C as o,e as m,T as J,b as K,p as X,B as w,V as Y,O as Z,W as B,v as $,U as v,G as O,o as D,q as ee,Q as se,w as ae}from"./index-tH8kGzNV.js";import{T as te,a as le,b as _,c as j,d as re,e as i}from"./table-DC3MYrD8.js";import{D as ce,b as ne,c as ie,d as de,e as oe}from"./dialog-DAjwwShP.js";import{S as me,a as xe,b as he,c as je,d as y}from"./select-B8NiX_r6.js";import{S as r}from"./skeleton-vzO12S3j.js";import{r as b}from"./real-api-client-o-2gE2Hp.js";import{T as pe}from"./trending-down-HaRH2stY.js";import{S as Ne}from"./search-8LTSveb2.js";import{C as ue}from"./clock-BiwlPOks.js";import"./index-DGGMjIYi.js";import"./Combination-Dzecd94B.js";import"./x-B6dSK8zO.js";import"./index-BdQq_4o_.js";import"./index-BuiImgyP.js";import"./check-DV_4N94Y.js";const z={pending:"bg-yellow-100 text-yellow-800",completed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"},H={pending:"در انتظار",completed:"تکمیل شده",cancelled:"لغو شده"},q={pending:ue,completed:B,cancelled:Z};function Ge(){const[c,u]=x.useState([]),[d,g]=x.useState({total:0,pending:0,completed:0,cancelled:0,thisMonth:0,lastMonth:0,monthlyGrowth:0}),[h,T]=x.useState(""),[N,A]=x.useState("all"),[S,E]=x.useState(null),[C,I]=x.useState(!1),[L,k]=x.useState(!0),[p,R]=x.useState(!0),[f,G]=x.useState(!1);x.useEffect(()=>{M(),V()},[]);const V=async()=>{try{R(!0);const s=await b.get("/admin/transfers/stats"),a=s.stats||s,t={total:a.total||0,pending:a.pending||0,completed:a.completed||0,cancelled:a.cancelled||0,thisMonth:a.this_month||a.thisMonth||0,lastMonth:a.last_month||a.lastMonth||0,monthlyGrowth:a.monthly_growth||a.monthlyGrowth||0};g(t)}catch(s){if(console.error("Error fetching transfer stats:",s),s&&typeof s=="object"&&"isNetworkError"in s){const a=s;a.isNetworkError?n.error("عدم دسترسی به سرور برای دریافت آمار انتقال‌ها"):a.isAuthError?n.error("خطای احراز هویت در دریافت آمار"):n.error("خطا در بارگذاری آمار انتقال‌ها")}else n.error("خطا در بارگذاری آمار انتقال‌ها");g({total:0,pending:0,completed:0,cancelled:0,thisMonth:0,lastMonth:0,monthlyGrowth:0})}finally{R(!1)}},M=async()=>{try{k(!0);const s=await b.get("/admin/transfers"),a=s.transfers||s.data||s||[],t=Array.isArray(a)?a.map(l=>({id:l.id?.toString()||l._id?.toString(),partId:l.part_id?.toString()||l.partId?.toString(),partName:l.part_name||l.partName||"نامشخص",partSerial:l.part_serial||l.partSerial||"نامشخص",fromCompanyId:l.from_company_id?.toString()||l.fromCompanyId?.toString(),fromCompanyName:l.from_company_name||l.fromCompanyName||"نامشخص",toCompanyId:l.to_company_id?.toString()||l.toCompanyId?.toString(),toCompanyName:l.to_company_name||l.toCompanyName||"نامشخص",transferDate:l.transfer_date||l.transferDate||new Date().toLocaleDateString("fa-IR"),status:l.status||"pending",reason:l.reason||"نامشخص",notes:l.notes,documents:l.documents||[],createdAt:l.created_at||l.createdAt||new Date().toLocaleDateString("fa-IR"),updatedAt:l.updated_at||l.updatedAt})):[];u(t)}catch(s){if(console.error("Error fetching transfers:",s),u([]),s&&typeof s=="object"&&"isNetworkError"in s){const a=s;a.isNetworkError?n.error("عدم دسترسی به سرور برای دریافت انتقال‌ها"):a.isAuthError?n.error("خطای احراز هویت در دریافت انتقال‌ها"):n.error("خطا در بارگذاری انتقال‌ها")}else n.error("خطا در بارگذاری انتقال‌ها")}finally{k(!1)}},U=c.filter(s=>{const a=s.partName.toLowerCase().includes(h.toLowerCase())||s.partSerial.toLowerCase().includes(h.toLowerCase())||s.fromCompanyName.toLowerCase().includes(h.toLowerCase())||s.toCompanyName.toLowerCase().includes(h.toLowerCase()),t=N==="all"||s.status===N;return a&&t}),F=async s=>{try{G(!0);const a=await b.get(`/admin/transfers/${s}`),t=a.transfer||a,l={id:t.id?.toString()||t._id?.toString(),partId:t.part_id?.toString()||t.partId?.toString(),partName:t.part_name||t.partName||"نامشخص",partSerial:t.part_serial||t.partSerial||"نامشخص",fromCompanyId:t.from_company_id?.toString()||t.fromCompanyId?.toString(),fromCompanyName:t.from_company_name||t.fromCompanyName||"نامشخص",toCompanyId:t.to_company_id?.toString()||t.toCompanyId?.toString(),toCompanyName:t.to_company_name||t.toCompanyName||"نامشخص",transferDate:t.transfer_date||t.transferDate||new Date().toLocaleDateString("fa-IR"),status:t.status||"pending",reason:t.reason||"نامشخص",notes:t.notes,documents:t.documents||[],createdAt:t.created_at||t.createdAt||new Date().toLocaleDateString("fa-IR"),updatedAt:t.updated_at||t.updatedAt};E(l)}catch(a){if(console.error("Error fetching transfer details:",a),a&&typeof a=="object"&&"isNetworkError"in a){const t=a;t.isNetworkError?n.error("عدم دسترسی به سرور برای دریافت جزئیات انتقال"):t.isAuthError?n.error("خطای احراز هویت در دریافت جزئیات"):n.error("خطا در بارگذاری جزئیات انتقال")}else n.error("خطا در بارگذاری جزئیات انتقال")}finally{G(!1)}},P=async()=>{I(!0);try{await Promise.all([M(),V()]),n.success("داده‌ها با موفقیت به‌روزرسانی شد")}catch{n.error("خطا در به‌روزرسانی داده‌ها")}finally{I(!1)}},Q=async s=>{await F(s)},W=async()=>{try{const s=await b.get("/admin/transfers/export/csv",{responseType:"blob"}),a=new Blob([s],{type:"text/csv;charset=utf-8;"}),t=window.URL.createObjectURL(a),l=document.createElement("a");l.href=t,l.download=`transfers-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(t),n.success("فایل CSV با موفقیت صادر شد")}catch(s){if(console.error("Error exporting CSV:",s),s&&typeof s=="object"&&"isNetworkError"in s){const a=s;a.isNetworkError?n.error("عدم دسترسی به سرور برای صادرات فایل"):a.isAuthError?n.error("خطای احراز هویت در صادرات"):n.error("خطا در صادرات فایل CSV")}else n.error("خطا در صادرات فایل CSV")}};return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"انتقال‌های قطعات"}),e.jsx("p",{className:"text-muted-foreground",children:"تاریخچه تمامی انتقال‌های انجام شده"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[e.jsx(o,{className:"border-l-4 border-l-blue-500",children:e.jsx(m,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[p?e.jsx(r,{className:"h-6 w-12 mx-auto mb-1"}):e.jsx("p",{className:"text-xl font-bold text-blue-600",children:d.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"کل انتقال‌ها"})]})})}),e.jsx(o,{className:"border-l-4 border-l-yellow-500",children:e.jsx(m,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[p?e.jsx(r,{className:"h-6 w-12 mx-auto mb-1"}):e.jsx("p",{className:"text-xl font-bold text-yellow-600",children:d.pending}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"در انتظار"})]})})}),e.jsx(o,{className:"border-l-4 border-l-green-500",children:e.jsx(m,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[p?e.jsx(r,{className:"h-6 w-12 mx-auto mb-1"}):e.jsx("p",{className:"text-xl font-bold text-green-600",children:d.completed}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"تکمیل شده"})]})})}),e.jsx(o,{className:"border-l-4 border-l-red-500",children:e.jsx(m,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[p?e.jsx(r,{className:"h-6 w-12 mx-auto mb-1"}):e.jsx("p",{className:"text-xl font-bold text-red-600",children:d.cancelled}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"لغو شده"})]})})}),e.jsx(o,{className:"border-l-4 border-l-purple-500",children:e.jsx(m,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[p?e.jsx(r,{className:"h-6 w-12 mx-auto mb-1"}):e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("p",{className:"text-xl font-bold text-purple-600",children:d.thisMonth}),d.monthlyGrowth!==0&&(d.monthlyGrowth>0?e.jsx(J,{className:"w-4 h-4 text-green-500"}):e.jsx(pe,{className:"w-4 h-4 text-red-500"}))]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"این ماه"}),!p&&d.monthlyGrowth!==0&&e.jsxs("p",{className:`text-xs ${d.monthlyGrowth>0?"text-green-600":"text-red-600"}`,children:[d.monthlyGrowth>0?"+":"",Math.round(d.monthlyGrowth),"%"]})]})})})]}),e.jsxs(o,{children:[e.jsx(K,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(Ne,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(X,{placeholder:"جستجو بر اساس قطعه یا شرکت...",value:h,onChange:s=>T(s.target.value),className:"pr-10",style:{textAlign:"right",direction:"rtl"}})]}),e.jsxs(w,{variant:"outline",size:"sm",onClick:P,disabled:C,className:"gap-2 shrink-0",children:[e.jsx(Y,{className:`h-4 w-4 ${C?"animate-spin":""}`}),C?"در حال بارگذاری...":"تازه‌سازی"]}),e.jsxs(me,{value:N,onValueChange:A,children:[e.jsx(xe,{className:"w-32",children:e.jsx(he,{placeholder:"وضعیت"})}),e.jsxs(je,{children:[e.jsx(y,{value:"all",children:"همه"}),e.jsx(y,{value:"pending",children:"در انتظار"}),e.jsx(y,{value:"completed",children:"تکمیل شده"}),e.jsx(y,{value:"cancelled",children:"لغو شده"})]})]})]}),e.jsx("div",{className:"flex gap-2",children:e.jsx(w,{variant:"outline",size:"sm",onClick:W,children:"خروجی CSV"})})]})}),e.jsxs(m,{children:[e.jsx("div",{className:"rounded-lg border",children:e.jsxs(te,{children:[e.jsx(le,{children:e.jsxs(_,{children:[e.jsx(j,{className:"text-right",children:"قطعه"}),e.jsx(j,{className:"text-right",children:"از شرکت"}),e.jsx(j,{className:"text-right",children:"به شرکت"}),e.jsx(j,{className:"text-right",children:"تاریخ انتقال"}),e.jsx(j,{className:"text-right",children:"دلیل"}),e.jsx(j,{className:"text-right",children:"وضعیت"}),e.jsx(j,{className:"text-right",children:"عملیات"})]})}),e.jsx(re,{children:L?[...Array(5)].map((s,a)=>e.jsxs(_,{children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsx(r,{className:"h-4 w-24 mb-1"}),e.jsx(r,{className:"h-3 w-16"})]})]})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:"w-4 h-4"}),e.jsx(r,{className:"h-4 w-20"})]})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:"w-4 h-4"}),e.jsx(r,{className:"h-4 w-20"})]})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:"w-4 h-4"}),e.jsx(r,{className:"h-4 w-16"})]})}),e.jsx(i,{children:e.jsx(r,{className:"h-4 w-24"})}),e.jsx(i,{children:e.jsx(r,{className:"h-6 w-16"})}),e.jsx(i,{children:e.jsx(r,{className:"h-8 w-24"})})]},a)):U.map(s=>{const a=q[s.status];return e.jsxs(_,{children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx($,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.partName}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.partSerial})]})]})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-4 h-4 text-gray-500"}),s.fromCompanyName]})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(v,{className:"w-4 h-4 text-gray-500"}),s.toCompanyName]})}),e.jsx(i,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4 text-gray-500"}),s.transferDate]})}),e.jsx(i,{className:"max-w-xs truncate",children:s.reason}),e.jsx(i,{children:e.jsxs(D,{variant:"secondary",className:`${z[s.status]} flex items-center gap-1 w-fit`,children:[e.jsx(a,{className:"w-3 h-3"}),H[s.status]]})}),e.jsx(i,{children:e.jsxs(w,{variant:"outline",size:"sm",onClick:()=>Q(s.id),disabled:f,className:"gap-2",children:[f?e.jsx(ee,{className:"w-4 h-4 animate-spin"}):e.jsx(se,{className:"w-4 h-4"}),f?"در حال بارگذاری...":"مشاهده جزئیات"]})})]},s.id)})})]})}),!L&&U.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ae,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"انتقالی یافت نشد"}),e.jsx("p",{className:"text-muted-foreground",children:h||N!=="all"?"نتیجه‌ای برای فیلترهای اعمال شده یافت نشد":"هنوز هیچ انتقالی انجام نشده است"}),(h||N!=="all")&&e.jsx(w,{variant:"outline",size:"sm",onClick:()=>{T(""),A("all")},className:"mt-4",children:"پاک کردن فیلترها"})]})]})]}),S&&e.jsx(ce,{open:!!S,onOpenChange:()=>E(null),children:e.jsxs(ne,{className:"max-w-3xl max-h-[90vh]",style:{direction:"rtl",textAlign:"right"},children:[e.jsxs(ie,{style:{textAlign:"right"},children:[e.jsx(de,{style:{textAlign:"right"},children:"جزئیات انتقال"}),e.jsx(oe,{style:{textAlign:"right"},children:"اطلاعات کامل انتقال قطعه"})]}),e.jsx("div",{className:"max-h-[calc(90vh-8rem)] overflow-auto",children:f?e.jsx(ge,{}):e.jsx(fe,{transfer:S})})]})})]})}function ge(){return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{className:"h-5 w-24 mb-2"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{className:"h-4 w-full"}),e.jsx(r,{className:"h-4 w-3/4"})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"h-5 w-24 mb-2"}),e.jsx(r,{className:"h-6 w-24"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(r,{className:"h-5 w-24 mb-2"}),e.jsx(r,{className:"h-4 w-32"})]}),e.jsxs("div",{children:[e.jsx(r,{className:"h-5 w-24 mb-2"}),e.jsx(r,{className:"h-4 w-32"})]})]}),e.jsxs("div",{children:[e.jsx(r,{className:"h-5 w-24 mb-2"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(r,{className:"h-4 w-full"}),e.jsx(r,{className:"h-4 w-full"}),e.jsx(r,{className:"h-4 w-2/3"})]})]})]})}function fe({transfer:c}){const u=q[c.status];return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(o,{children:e.jsxs(m,{className:"p-4",children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center gap-2",children:[e.jsx($,{className:"w-5 h-5 text-blue-600"}),"اطلاعات قطعه"]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"نام قطعه:"}),e.jsx("span",{className:"font-medium",children:c.partName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"شماره سریال:"}),e.jsx("span",{className:"font-medium",children:c.partSerial})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"شناسه قطعه:"}),e.jsx("span",{className:"font-medium",children:c.partId})]})]})]})}),e.jsx(o,{children:e.jsxs(m,{className:"p-4",children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5 text-green-600"}),"وضعیت انتقال"]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(D,{variant:"secondary",className:`${z[c.status]} flex items-center gap-2 w-fit text-sm`,children:[e.jsx(u,{className:"w-4 h-4"}),H[c.status]]}),e.jsxs("div",{className:"text-sm space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"تاریخ ایجاد:"}),e.jsx("span",{className:"font-medium",children:c.createdAt})]}),c.updatedAt&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"آخرین بروزرسانی:"}),e.jsx("span",{className:"font-medium",children:c.updatedAt})]})]})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(o,{children:e.jsxs(m,{className:"p-4",children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5 text-orange-600"}),"شرکت فرستنده"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"نام شرکت:"}),e.jsx("span",{className:"font-medium",children:c.fromCompanyName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"شناسه:"}),e.jsx("span",{className:"font-medium",children:c.fromCompanyId})]})]})]})}),e.jsx(o,{children:e.jsxs(m,{className:"p-4",children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center gap-2",children:[e.jsx(v,{className:"w-5 h-5 text-purple-600"}),"شرکت گیرنده"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"نام شرکت:"}),e.jsx("span",{className:"font-medium",children:c.toCompanyName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"شناسه:"}),e.jsx("span",{className:"font-medium",children:c.toCompanyId})]})]})]})})]}),e.jsx(o,{children:e.jsxs(m,{className:"p-4",children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5 text-gray-600"}),"جزئیات انتقال"]}),e.jsxs("div",{className:"space-y-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"تاریخ انتقال:"}),e.jsx("span",{className:"font-medium",children:c.transferDate})]}),e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("span",{className:"text-muted-foreground",children:"دلیل انتقال:"}),e.jsx("span",{className:"font-medium text-left max-w-xs",children:c.reason})]}),c.notes&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx("span",{className:"text-muted-foreground block mb-2",children:"یادداشت:"}),e.jsx("p",{className:"text-sm bg-gray-50 p-3 rounded-lg",children:c.notes})]}),c.documents&&c.documents.length>0&&e.jsxs("div",{className:"pt-2 border-t",children:[e.jsx("span",{className:"text-muted-foreground block mb-2",children:"مدارک ضمیمه:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.documents.map((d,g)=>e.jsxs(D,{variant:"outline",className:"text-xs",children:["📎 ",d]},g))})]})]})]})})]})}export{Ge as default};
