import{u as se,r as x,t,j as e,z as ae,D as re,E as A,F as S,C as w,b as C,c as P,d as k,B as b,e as F,o as te,S as M,U as E,L as i,p as d,P as U,G as le,x as q,M as ie}from"./index-tH8kGzNV.js";import{T as ce,a as de,b as T,c as v,d as oe,e as N}from"./table-DC3MYrD8.js";import{A as ne,a as me,b as xe}from"./avatar-MaNl8m6v.js";import{r as y}from"./real-api-client-o-2gE2Hp.js";import{P as he}from"./ProvinceAndCitySelector-ByNK_lw_.js";import{X as H}from"./x-B6dSK8zO.js";import{S as $}from"./square-pen-BV4EFpYT.js";import{M as ue}from"./mail-B9fXdK0_.js";import{S as G}from"./save-DxawmBER.js";import{A as V}from"./activity-DbHfuyK_.js";import"./popover-B3pW-y7H.js";import"./Combination-Dzecd94B.js";import"./index-DGGMjIYi.js";import"./dialog-DAjwwShP.js";import"./search-8LTSveb2.js";import"./utils-BvTIn9cQ.js";import"./iran-provinces-cities-ClUeFN4S.js";function Te(){const{user:g}=se(),[h,L]=x.useState(!1),[c,B]=x.useState(!1),[D,R]=x.useState([]),[n,u]=x.useState(!1),[X,z]=x.useState(!0),[f,Z]=x.useState(null),[r,m]=x.useState({managerName:"",email:"",mobile:"",currentPassword:"",newPassword:"",confirmPassword:""}),[l,o]=x.useState({companyName:"",companyCode:"",phone:"",address:"",provinceId:0,cityId:0,postalCode:"",nationalCode:"",economicCode:"",registrationNumber:"",website:"",description:""});x.useEffect(()=>{I(),J()},[]);const I=async()=>{try{z(!0);const s=await y.get("/user/profile");s.data&&(Z(s.data),m(a=>({...a,managerName:s.data.managerName||"",email:s.data.email||"",mobile:s.data.mobile||""})),o(a=>({...a,companyName:s.data.companyName||"",companyCode:s.data.companyCode||"",phone:s.data.phone||"",address:s.data.address||"",provinceId:s.data.provinceId||0,cityId:s.data.cityId||0,postalCode:s.data.postalCode||"",nationalCode:s.data.nationalCode||"",economicCode:s.data.economicCode||"",registrationNumber:s.data.registrationNumber||"",website:s.data.website||"",description:s.data.description||""})))}catch(s){console.error("Error fetching profile:",s),t.error("خطا در بارگذاری اطلاعات پروفایل"),g&&m(a=>({...a,managerName:g.username||"",email:g.email||"",mobile:g.mobile||""}))}finally{z(!1)}},J=async()=>{try{u(!0);const s=await y.get("/user/activity-logs");s.data&&R(s.data.logs||s.data||[])}catch(s){console.error("Error fetching activity logs:",s),R([])}finally{u(!1)}},K=async()=>{if(!r.managerName||!r.email||!r.mobile){t.error("لطفاً تمام فیلدهای ضروری را پر کنید");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.email)){t.error("لطفاً ایمیل معتبر وارد کنید");return}if(!/^09[0-9]{9}$/.test(r.mobile)){t.error("لطفاً شماره موبایل معتبر وارد کنید (09xxxxxxxxx)");return}try{u(!0);const p=await y.put("/user/profile/basic",{managerName:r.managerName,email:r.email,mobile:r.mobile});t.success("اطلاعات پایه با موفقیت به‌روزرسانی شد"),L(!1),await I()}catch(p){console.error("Error updating basic info:",p),p.response?.data?.message?t.error(p.response.data.message):p.response?.status===400?t.error("اطلاعات ارسالی نامعتبر است"):p.response?.status===409?t.error("ایمیل یا شماره موبایل قبلاً استفاده شده است"):t.error("خطا در به‌روزرسانی اطلاعات پایه")}finally{u(!1)}},O=async()=>{if(!l.companyName||!l.nationalCode||!l.address){t.error("لطفاً فیلدهای ضروری را پر کنید");return}if(!l.provinceId||!l.cityId){t.error("لطفاً استان و شهر را انتخاب کنید");return}try{u(!0);const s=await y.put("/user/profile/company",l);t.success("اطلاعات شرکت با موفقیت به‌روزرسانی شد"),B(!1),await I()}catch(s){console.error("Error updating company info:",s),s.response?.data?.message?t.error(s.response.data.message):s.response?.status===400?t.error("اطلاعات ارسالی نامعتبر است"):s.response?.status===409?t.error("کد ملی یا شماره ثبت قبلاً استفاده شده است"):t.error("خطا در به‌روزرسانی اطلاعات شرکت")}finally{u(!1)}},Q=async()=>{if(!r.currentPassword||!r.newPassword||!r.confirmPassword){t.error("لطفاً تمام فیلدهای رمز عبور را پر کنید");return}if(r.newPassword!==r.confirmPassword){t.error("رمز عبور جدید و تایید آن یکسان نیستند");return}if(r.newPassword.length<8){t.error("رمز عبور باید حداقل ۸ کاراکتر باشد");return}const s=/[A-Z]/.test(r.newPassword),a=/[a-z]/.test(r.newPassword),p=/\d/.test(r.newPassword);if(!s||!a||!p){t.error("رمز عبور باید شامل حروف بزرگ، کوچک و عدد باشد");return}try{u(!0);const j=await y.post("/user/change-password",{currentPassword:r.currentPassword,newPassword:r.newPassword});t.success("رمز عبور با موفقیت تغییر کرد"),m(ee=>({...ee,currentPassword:"",newPassword:"",confirmPassword:""}))}catch(j){console.error("Error changing password:",j),j.response?.data?.message?t.error(j.response.data.message):j.response?.status===400?t.error("رمز عبور فعلی اشتباه است"):j.response?.status===422?t.error("رمز عبور جدید معتبر نیست"):t.error("خطا در تغییر رمز عبور")}finally{u(!1)}},W=s=>{o(a=>({...a,provinceId:s.provinceId||0,cityId:s.cityId||0}))},Y=s=>{switch(s){case"ورود به سیستم":case"خروج از سیستم":return e.jsx(E,{className:"w-4 h-4"});case"ثبت آسانسور":case"ویرایش آسانسور":return e.jsx(q,{className:"w-4 h-4"});case"تغییر تنظیمات":return e.jsx(V,{className:"w-4 h-4"});default:return e.jsx(V,{className:"w-4 h-4"})}},_=s=>{switch(s){case"ورود به سیستم":return"text-green-600";case"خروج از سیستم":return"text-red-600";case"ثبت آسانسور":case"ویرایش آسانسور":return"text-blue-600";case"تغییر تنظیمات":return"text-orange-600";default:return"text-gray-600"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"پروفایل شرکت"}),e.jsx("p",{className:"text-muted-foreground",children:"مدیریت اطلاعات شرکت و حساب کاربری"})]}),e.jsxs(ae,{defaultValue:"basic",className:"space-y-6",children:[e.jsxs(re,{className:"grid w-full grid-cols-3",children:[e.jsx(A,{value:"activity",children:"فعالیت‌های اخیر"}),e.jsx(A,{value:"company",children:"اطلاعات شرکت"}),e.jsx(A,{value:"basic",children:"اطلاعات پایه"})]}),e.jsxs(S,{value:"basic",className:"space-y-6",children:[e.jsxs(w,{children:[e.jsx(C,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-right order-2",children:[e.jsx(P,{children:"اطلاعات شخصی"}),e.jsx(k,{children:"مدیریت اطلاعات پایه حساب کاربری"})]}),e.jsxs(b,{variant:h?"outline":"default",onClick:()=>L(!h),className:"order-1",disabled:n,children:[h?e.jsx(H,{className:"w-4 h-4 ml-1"}):e.jsx($,{className:"w-4 h-4 ml-1"}),h?"انصراف":"ویرایش"]})]})}),e.jsxs(F,{className:"space-y-6",children:[X?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center space-y-3",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"در حال بارگذاری اطلاعات..."})]})}):e.jsxs("div",{className:"flex items-center gap-6 flex-row-reverse",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("h3",{className:"text-lg font-semibold",children:f?.managerName||g?.username}),e.jsx("p",{className:"text-muted-foreground",children:"مدیر شرکت"}),e.jsxs(te,{variant:"outline",className:"mt-1 flex-row-reverse",children:[f?.isActive?"فعال":"غیرفعال",e.jsx(M,{className:"w-3 h-3 ml-1"})]})]}),e.jsxs(ne,{className:"w-20 h-20",children:[e.jsx(me,{children:e.jsx(E,{className:"w-10 h-10"})}),e.jsx(xe,{className:"text-lg",children:(f?.managerName||g?.username)?.charAt(0).toUpperCase()||"M"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"managerName",className:"text-right block",children:"نام مدیر شرکت"}),e.jsxs("div",{className:"relative",children:[e.jsx(E,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(d,{id:"managerName",value:r.managerName,onChange:s=>m(a=>({...a,managerName:s.target.value})),disabled:!h,className:"pr-10 text-right"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"email",className:"text-right block",children:"ایمیل"}),e.jsxs("div",{className:"relative",children:[e.jsx(ue,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(d,{id:"email",type:"email",value:r.email,onChange:s=>m(a=>({...a,email:s.target.value})),disabled:!h,className:"pr-10 text-left",dir:"ltr"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"mobile",className:"text-right block",children:"شماره موبایل"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(d,{id:"mobile",type:"tel",value:r.mobile,onChange:s=>m(a=>({...a,mobile:s.target.value})),disabled:!h,className:"pr-10 text-left",dir:"ltr"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-right block",children:"تاریخ عضویت"}),e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(d,{value:f?.createdAt?new Date(f.createdAt).toLocaleDateString("fa-IR"):"۱۴۰۲/۰۵/۱۵",disabled:!0,className:"pr-10 bg-muted text-right"})]})]})]}),h&&e.jsx("div",{className:"flex justify-end",children:e.jsx(b,{onClick:K,disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-1"}),"در حال ذخیره..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-4 h-4 ml-1"}),"ذخیره تغییرات"]})})})]})]}),e.jsxs(w,{children:[e.jsxs(C,{className:"text-right",children:[e.jsx(P,{children:"تغییر رمز عبور"}),e.jsx(k,{children:"برای امنیت بیشتر، رمز عبور خود را تغییر دهید"})]}),e.jsxs(F,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"currentPassword",className:"text-right block",children:"رمز عبور فعلی"}),e.jsx(d,{id:"currentPassword",type:"password",value:r.currentPassword,onChange:s=>m(a=>({...a,currentPassword:s.target.value})),className:"text-left",dir:"ltr"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"newPassword",className:"text-right block",children:"رمز عبور جدید"}),e.jsx(d,{id:"newPassword",type:"password",value:r.newPassword,onChange:s=>m(a=>({...a,newPassword:s.target.value})),className:"text-left",dir:"ltr"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"confirmPassword",className:"text-right block",children:"تایید رمز عبور جدید"}),e.jsx(d,{id:"confirmPassword",type:"password",value:r.confirmPassword,onChange:s=>m(a=>({...a,confirmPassword:s.target.value})),className:"text-left",dir:"ltr"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(b,{onClick:Q,disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-1"}),"در حال تغییر..."]}):e.jsxs(e.Fragment,{children:[e.jsx(M,{className:"w-4 h-4 ml-1"}),"تغییر رمز عبور"]})})})]})]})]}),e.jsx(S,{value:"company",className:"space-y-6",children:e.jsxs(w,{children:[e.jsx(C,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-right order-2",children:[e.jsx(P,{children:"اطلاعات شرکت"}),e.jsx(k,{children:"مدیریت اطلاعات شرکت و آدرس"})]}),e.jsxs(b,{variant:c?"outline":"default",onClick:()=>B(!c),className:"order-1",disabled:n,children:[c?e.jsx(H,{className:"w-4 h-4 ml-1"}):e.jsx($,{className:"w-4 h-4 ml-1"}),c?"انصراف":"ویرایش"]})]})}),e.jsxs(F,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"companyName",className:"text-right block",children:"نام شرکت *"}),e.jsxs("div",{className:"relative",children:[e.jsx(q,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(d,{id:"companyName",value:l.companyName,onChange:s=>o(a=>({...a,companyName:s.target.value})),disabled:!c,className:"pr-10 text-right",placeholder:"نام شرکت را وارد کنید"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"companyCode",className:"text-right block",children:"کد پروفایل"}),e.jsx(d,{id:"companyCode",value:l.companyCode,onChange:s=>o(a=>({...a,companyCode:s.target.value})),disabled:!c,className:"text-left",dir:"ltr",placeholder:"کد پروفایل شرکت"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"phone",className:"text-right block",children:"تلفن ثابت"}),e.jsxs("div",{className:"relative",children:[e.jsx(U,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(d,{id:"phone",type:"tel",value:l.phone,onChange:s=>o(a=>({...a,phone:s.target.value})),disabled:!c,className:"pr-10 text-left",dir:"ltr",placeholder:"021-12345678"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"nationalCode",className:"text-right block",children:"کد ملی شرکت *"}),e.jsx(d,{id:"nationalCode",value:l.nationalCode,onChange:s=>o(a=>({...a,nationalCode:s.target.value})),disabled:!c,className:"text-left",dir:"ltr",placeholder:"1234567890"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"economicCode",className:"text-right block",children:"شناسه صنفی"}),e.jsx(d,{id:"economicCode",value:l.economicCode,onChange:s=>o(a=>({...a,economicCode:s.target.value})),disabled:!c,className:"text-left",dir:"ltr",placeholder:"شناسه صنفی شرکت"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"registrationNumber",className:"text-right block",children:"شماره ثبت"}),e.jsx(d,{id:"registrationNumber",value:l.registrationNumber,onChange:s=>o(a=>({...a,registrationNumber:s.target.value})),disabled:!c,className:"text-left",dir:"ltr",placeholder:"شماره ثبت شرکت"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"website",className:"text-right block",children:"وب‌سایت"}),e.jsx(d,{id:"website",type:"url",value:l.website,onChange:s=>o(a=>({...a,website:s.target.value})),disabled:!c,className:"text-left",dir:"ltr",placeholder:"https://example.com"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"postalCode",className:"text-right block",children:"کد پستی"}),e.jsx(d,{id:"postalCode",value:l.postalCode,onChange:s=>o(a=>({...a,postalCode:s.target.value})),disabled:!c,className:"text-left",dir:"ltr",placeholder:"1234567890"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-right block",children:"استان و شهر *"}),e.jsx(he,{value:{provinceId:l.provinceId,cityId:l.cityId},onChange:W,disabled:!c,required:!0,showSearch:!0,placeholder:{province:"استان را انتخاب کنید",city:"شهر را انتخاب کنید"},layout:"horizontal"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"address",className:"text-right block",children:"آدرس کامل *"}),e.jsxs("div",{className:"relative",children:[e.jsx(ie,{className:"absolute right-3 top-3 text-muted-foreground w-4 h-4"}),e.jsx("textarea",{id:"address",value:l.address,onChange:s=>o(a=>({...a,address:s.target.value})),disabled:!c,className:"w-full pr-10 pl-3 py-2 border border-input bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 rounded-md resize-none text-right",rows:3,placeholder:"آدرس کامل شرکت را وارد کنید",dir:"rtl"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"description",className:"text-right block",children:"توضیحات"}),e.jsx("textarea",{id:"description",value:l.description,onChange:s=>o(a=>({...a,description:s.target.value})),disabled:!c,className:"w-full px-3 py-2 border border-input bg-background text-sm ring-offset-background placeholder:text-muted-foreground focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 rounded-md resize-none text-right",rows:3,placeholder:"توضیحات اضافی در مورد شرکت",dir:"rtl"})]}),c&&e.jsx("div",{className:"flex justify-end",children:e.jsx(b,{onClick:O,disabled:n,children:n?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white ml-1"}),"در حال ذخیره..."]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-4 h-4 ml-1"}),"ذخیره تغییرات"]})})})]})]})}),e.jsx(S,{value:"activity",children:e.jsxs(w,{children:[e.jsxs(C,{className:"text-right",children:[e.jsx(P,{children:"فعالیت‌های اخیر"}),e.jsx(k,{children:"لیست آخرین فعالیت‌های انجام شده در سیستم"})]}),e.jsx(F,{children:n?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"در حال بارگذاری فعالیت‌ها..."})]})}):e.jsx("div",{className:"rounded-lg border",children:e.jsxs(ce,{children:[e.jsx(de,{children:e.jsxs(T,{children:[e.jsx(v,{className:"text-right",children:"فعالیت"}),e.jsx(v,{className:"text-right",children:"جزئیات"}),e.jsx(v,{className:"text-right",children:"زمان"}),e.jsx(v,{className:"text-right",children:"IP"}),e.jsx(v,{className:"text-right",children:"مرورگر"})]})}),e.jsx(oe,{children:D.length===0?e.jsx(T,{children:e.jsx(N,{colSpan:5,className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"هیچ فعالیتی یافت نشد"})})}):D.map(s=>e.jsxs(T,{children:[e.jsx(N,{className:"text-right",children:e.jsxs("div",{className:"flex items-center gap-2 flex-row-reverse",children:[e.jsx("span",{className:"font-medium",children:s.action}),e.jsx("div",{className:`p-1 rounded ${_(s.action)}`,children:Y(s.action)})]})}),e.jsx(N,{className:"max-w-md text-right",children:e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.details})}),e.jsx(N,{className:"text-sm text-right",children:s.timestamp}),e.jsx(N,{className:"text-sm font-mono text-left",dir:"ltr",children:s.ip}),e.jsx(N,{className:"text-sm text-right",children:s.userAgent})]},s.id))})]})})})]})})]})]})}export{Te as default};
