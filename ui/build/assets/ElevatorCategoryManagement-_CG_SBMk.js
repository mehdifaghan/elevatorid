import{r as l,t as i,j as e,C as v,e as k,x as f,B as h,L as y,p as T,o as O}from"./index-tH8kGzNV.js";import{D as P,a as V,b as z,c as H,d as G,e as J}from"./dialog-DAjwwShP.js";import{S as K,a as Q,b as U,c as W,d as N}from"./select-B8NiX_r6.js";import{S as L}from"./switch-DOMxWR7b.js";import{T as X}from"./textarea-1hTYB3HE.js";import{S as x}from"./skeleton-vzO12S3j.js";import{D as Y,a as Z,b as ee,c as w}from"./dropdown-menu-BKfQT_JD.js";import{r as se}from"./real-api-client-o-2gE2Hp.js";import{P as te}from"./plus-A2-5MgKF.js";import{T as _}from"./trash-2-BwVZTJjK.js";import{S as ie}from"./search-8LTSveb2.js";import{E as re}from"./ellipsis-J_HkHiqq.js";import{S as ae}from"./square-pen-BV4EFpYT.js";import"./index-DGGMjIYi.js";import"./Combination-Dzecd94B.js";import"./x-B6dSK8zO.js";import"./index-BdQq_4o_.js";import"./index-BuiImgyP.js";import"./check-DV_4N94Y.js";import"./chevron-right-B97jr1RJ.js";function ke({triggerDialog:A,onStatsChange:le,apiError:ne,isApiAvailable:ce}){const[C,b]=l.useState([]),[q,S]=l.useState(!0),[p,F]=l.useState(""),[d,R]=l.useState("all"),[c,m]=l.useState({name:"",description:"",isActive:!0}),[n,g]=l.useState(null),[$,o]=l.useState(!1);l.useEffect(()=>{j()},[]),l.useEffect(()=>{A&&(u(),g(null),o(!0))},[A]);const j=async()=>{try{S(!0);const s=await se.get("/admin/elevator-types"),t=s.elevator_types||s.elevatorTypes||s.data||s||[],a=Array.isArray(t)?t.map(r=>({id:r.id?.toString()||r._id?.toString(),name:r.name||r.title,description:r.description||"",isActive:r.is_active!==void 0?r.is_active:r.isActive!==void 0?r.isActive:!0,createdAt:r.created_at||r.createdAt||new Date().toLocaleDateString("fa-IR")})):[];b(a)}catch(s){if(console.error("Error fetching elevator types:",s),b([]),s&&typeof s=="object"&&"isNetworkError"in s){const t=s;t.isNetworkError?i.error("عدم دسترسی به سرور برای دریافت انواع آسانسور"):t.isAuthError?i.error("خطای احراز هویت در دریافت انواع آسانسور"):i.error("خطا در بارگذاری انواع آسانسور")}else i.error("خطا در بارگذاری انواع آسانسور")}finally{S(!1)}},u=()=>{m({name:"",description:"",isActive:!0})},M=async s=>{if(s.preventDefault(),!c.name.trim()){i.error("نام نوع آسانسور الزامی است");return}const t={name:c.name.trim(),description:c.description.trim(),is_active:c.isActive};try{n?(await apiRequest.put(`/admin/elevator-types/${n.id}`,t),i.success("نوع آسانسور بروزرسانی شد")):(await apiRequest.post("/admin/elevator-types",t),i.success("نوع آسانسور جدید ایجاد شد")),o(!1),u(),g(null),j()}catch(a){console.error("Error saving elevator type:",a),i.error(n?"خطا در بروزرسانی نوع آسانسور":"خطا در ایجاد نوع آسانسور")}},B=s=>{g(s),m({name:s.name,description:s.description,isActive:s.isActive}),o(!0)},D=async s=>{if(window.confirm(`آیا از حذف نوع آسانسور "${s.name}" اطمینان دارید؟`))try{await apiRequest.delete(`/admin/elevator-types/${s.id}`),i.success("نوع آسانسور حذف شد"),j()}catch(t){console.error("Error deleting elevator type:",t),i.error("خطا در حذف نوع آسانسور")}},I=async s=>{const t=C.find(a=>a.id===s);if(t)try{await apiRequest.put(`/admin/elevator-types/${s}`,{is_active:!t.isActive}),i.success(`نوع آسانسور "${t.name}" ${t.isActive?"غیرفعال":"فعال"} شد`),j()}catch(a){console.error("Error toggling elevator type status:",a),i.error("خطا در تغییر وضعیت نوع آسانسور")}},E=C.filter(s=>{const t=s.name.toLowerCase().includes(p.toLowerCase())||s.description.toLowerCase().includes(p.toLowerCase()),a=d==="all"||d==="active"&&s.isActive||d==="inactive"&&!s.isActive;return t&&a});return q?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(x,{className:"h-8 w-48"}),e.jsx(x,{className:"h-10 w-40"})]}),e.jsx("div",{className:"space-y-4",children:[...Array(5)].map((s,t)=>e.jsx(v,{children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(x,{className:"h-5 w-32"}),e.jsx(x,{className:"h-4 w-64"})]}),e.jsx(x,{className:"h-8 w-16"})]})})},t))})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5 text-gray-900"}),e.jsx("h3",{className:"text-lg text-gray-900",children:"مدیریت انواع آسانسور"})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(P,{open:$,onOpenChange:o,children:[e.jsx(V,{asChild:!0,children:e.jsxs(h,{onClick:()=>{u(),g(null)},className:"flex items-center gap-2 bg-gray-900 hover:bg-gray-800 text-white",children:[e.jsx(te,{className:"w-4 h-4"}),"نوع آسانسور جدید"]})}),e.jsxs(z,{className:"max-w-md",style:{direction:"rtl",textAlign:"right"},children:[e.jsxs(H,{style:{textAlign:"right"},children:[e.jsx(G,{style:{textAlign:"right"},children:n?"ویرایش نوع آسانسور":"تعریف نوع آسانسور جدید"}),e.jsx(J,{style:{textAlign:"right"},children:n?"اطلاعات نوع آسانسور را ویرایش کنید":"نوع آسانسور جدید تعریف کنید"})]}),e.jsxs("form",{onSubmit:M,className:"space-y-4",style:{direction:"rtl"},children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"name",style:{textAlign:"right",display:"block"},children:"نام نوع آسانسور *"}),e.jsx(T,{id:"name",value:c.name,onChange:s=>m(t=>({...t,name:s.target.value})),placeholder:"مثال: آسانسور هیدرولیک",required:!0,style:{textAlign:"right",direction:"rtl"}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"description",style:{textAlign:"right",display:"block"},children:"توضیحات"}),e.jsx(X,{id:"description",value:c.description,onChange:s=>m(t=>({...t,description:s.target.value})),placeholder:"توضیحات مربوط به این نوع آسانسور...",rows:3,style:{textAlign:"right",direction:"rtl"}})]}),e.jsxs("div",{className:"flex items-center gap-2 justify-end",children:[e.jsx(y,{htmlFor:"isActive",style:{textAlign:"right"},children:"فعال"}),e.jsx(L,{id:"isActive",checked:c.isActive,onCheckedChange:s=>m(t=>({...t,isActive:s}))})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[n&&e.jsxs(h,{type:"button",variant:"destructive",onClick:()=>{D(n),o(!1)},className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),"حذف"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>o(!1),children:"انصراف"}),e.jsx(h,{type:"submit",className:"bg-gray-900 hover:bg-gray-800 text-white",children:n?"بروزرسانی":"ایجاد"})]})]})]})]})]})})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(ie,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(T,{placeholder:"جستجو در انواع آسانسور...",value:p,onChange:s=>F(s.target.value),className:"pr-10",style:{textAlign:"right",direction:"rtl"}})]}),e.jsxs(K,{value:d,onValueChange:s=>R(s),children:[e.jsx(Q,{className:"w-40",style:{textAlign:"right",direction:"rtl"},children:e.jsx(U,{placeholder:"فیلتر وضعیت"})}),e.jsxs(W,{style:{direction:"rtl"},children:[e.jsx(N,{value:"all",children:"همه"}),e.jsx(N,{value:"active",children:"فعال"}),e.jsx(N,{value:"inactive",children:"غیرفعال"})]})]})]}),e.jsx("div",{className:"space-y-4",children:E.length>0?E.map(s=>e.jsx(v,{className:"border border-gray-200 bg-white hover:shadow-sm transition-shadow",children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(f,{className:"w-8 h-8 text-gray-700"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:s.description}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(O,{variant:s.isActive?"default":"secondary",className:"text-xs",children:s.isActive?"فعال":"غیرفعال"}),e.jsxs("span",{className:"text-xs text-gray-500",children:["ایجاد شده: ",s.createdAt]})]})]})]}),e.jsxs(Y,{children:[e.jsx(Z,{asChild:!0,children:e.jsx(h,{variant:"ghost",size:"sm",children:e.jsx(re,{className:"w-4 h-4"})})}),e.jsxs(ee,{align:"end",style:{direction:"rtl"},children:[e.jsxs(w,{onClick:()=>B(s),children:[e.jsx(ae,{className:"w-4 h-4 ml-2"}),"ویرایش"]}),e.jsxs(w,{onClick:()=>I(s.id),className:s.isActive?"text-orange-600":"text-green-600",children:[e.jsx(L,{className:"w-4 h-4 ml-2"}),s.isActive?"غیرفعال کردن":"فعال کردن"]}),e.jsxs(w,{onClick:()=>D(s),className:"text-red-600",children:[e.jsx(_,{className:"w-4 h-4 ml-2"}),"حذف"]})]})]})]})})},s.id)):e.jsxs(v,{className:"p-8 text-center border border-gray-200 bg-white",children:[e.jsx(f,{className:"w-12 h-12 mx-auto text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg text-gray-900 mb-2",children:"هیچ نوع آسانسوری یافت نشد"}),e.jsx("p",{className:"text-gray-600",children:p||d!=="all"?"نتیجه‌ای برای فیلترهای انتخاب شده یافت نشد":"ابتدا انواع آسانسور را تعریف کنید"})]})})]})}export{ke as default};
