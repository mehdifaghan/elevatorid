import{r as m,t as n,j as e,B as p,q as de,V as oe,C as g,e as j,T as Pe,p as y,b as G,c as z,v as B,d as _e,L as o,o as se,U as Fe,Q as Me,R as Oe,w as fe,z as Le,D as Re,E as Y,F as Z}from"./index-tH8kGzNV.js";import{D as me,a as qe,b as xe,c as he,d as ue,e as ge}from"./dialog-DAjwwShP.js";import{S as je}from"./scroll-area-VRfuIe_R.js";import{D as $e,a as Qe,b as Ue,c as E,d as ee}from"./dropdown-menu-BKfQT_JD.js";import{S as P,a as _,b as F,c as M,d as u}from"./select-B8NiX_r6.js";import{S as Ge}from"./switch-DOMxWR7b.js";import{S as U}from"./skeleton-vzO12S3j.js";import{A as ze,a as Ve,b as Be,c as He,d as Je,e as Ke,f as We,g as Xe}from"./alert-dialog-DO3MSb5m.js";import{Q as Ye}from"./QRCodeGenerator-DzqPO6-F.js";import{A as Ze}from"./AdvancedTable-BFnDxHqp.js";import{PersianDatePicker as es}from"./PersianDatePicker-1MwY2jFT.js";import{r as C}from"./real-api-client-o-2gE2Hp.js";import{S as ss,a as Ne}from"./SellModal-B1TPinsx.js";import{P as ts}from"./plus-A2-5MgKF.js";import{T as rs}from"./trending-down-HaRH2stY.js";import{S as as}from"./search-8LTSveb2.js";import{E as ls}from"./ellipsis-J_HkHiqq.js";import{F as ye}from"./file-text-DbNNqFYp.js";import{S as is}from"./square-pen-BV4EFpYT.js";import{T as ns}from"./trash-2-BwVZTJjK.js";import{C as cs}from"./clock-BiwlPOks.js";import{D as ds}from"./download-BGqk_jGh.js";import{E as os}from"./external-link-CZQZ0Gf9.js";import"./index-DGGMjIYi.js";import"./Combination-Dzecd94B.js";import"./x-B6dSK8zO.js";import"./index-BdQq_4o_.js";import"./chevron-right-B97jr1RJ.js";import"./check-DV_4N94Y.js";import"./index-BuiImgyP.js";import"./copy-CIVXPvX_.js";import"./table-DC3MYrD8.js";import"./popover-B3pW-y7H.js";import"./utils-BvTIn9cQ.js";const be={available:"bg-green-100 text-green-800",sold:"bg-blue-100 text-blue-800",installed:"bg-purple-100 text-purple-800",maintenance:"bg-yellow-100 text-yellow-800"},ve={available:"موجود",sold:"فروخته شده",installed:"نصب شده",maintenance:"در تعمیر"};function Js(){const[c,f]=m.useState([]),[i,h]=m.useState([]),[N,H]=m.useState({total:0,available:0,installed:0,maintenance:0,sold:0,thisMonth:0,lastMonth:0,monthlyGrowth:0}),[S,O]=m.useState(null),[w,A]=m.useState(!1),[L,R]=m.useState(!1),[D,K]=m.useState(!1),[b,T]=m.useState(null),[te,W]=m.useState(null),[q,$]=m.useState(null),[k,s]=m.useState(!1),[r,d]=m.useState(!0),[v,Q]=m.useState(!0),[re,ae]=m.useState(!1),[I,le]=m.useState(""),[V,ie]=m.useState("all");m.useEffect(()=>{ne(),ce(),J()},[]);const J=async()=>{try{Q(!0);const t=await C.get("/admin/parts/stats"),a=t.stats||t,x={total:a.total||0,available:a.available||0,installed:a.installed||0,maintenance:a.maintenance||0,sold:a.sold||0,thisMonth:a.this_month||a.thisMonth||0,lastMonth:a.last_month||a.lastMonth||0,monthlyGrowth:a.monthly_growth||a.monthlyGrowth||0};H(x)}catch(t){if(console.error("Error fetching part stats:",t),t&&typeof t=="object"&&"isNetworkError"in t){const a=t;a.isNetworkError?n.error("عدم دسترسی به سرور برای دریافت آمار قطعات"):a.isAuthError?n.error("خطای احراز هویت در دریافت آمار"):n.error("خطا در بارگذاری آمار قطعات")}else n.error("خطا در بارگذاری آمار قطعات");H({total:0,available:0,installed:0,maintenance:0,sold:0,thisMonth:0,lastMonth:0,monthlyGrowth:0})}finally{Q(!1)}},ne=async()=>{try{d(!0);const t=await C.get("/admin/parts"),a=t.parts||t.data||t||[],x=Array.isArray(a)?a.map(l=>({id:l.id?.toString()||l._id?.toString(),partUid:l.part_uid||l.partUid||l.uid||"نامشخص",title:l.title||l.name||"نامشخص",barcode:l.barcode||"",categoryId:l.category_id?.toString()||l.categoryId?.toString()||"",categoryName:l.category_name||l.categoryName||l.category?.title||"نامشخص",manufacturerCountry:l.manufacturer_country||l.manufacturerCountry||"نامشخص",originCountry:l.origin_country||l.originCountry||"نامشخص",registrantCompanyId:l.registrant_company_id?.toString()||l.registrantCompanyId?.toString()||"",registrantCompanyName:l.registrant_company_name||l.registrantCompanyName||"نامشخص",currentOwner:{type:l.current_owner?.type||l.currentOwner?.type||"company",companyId:l.current_owner?.company_id?.toString()||l.currentOwner?.companyId?.toString(),elevatorId:l.current_owner?.elevator_id?.toString()||l.currentOwner?.elevatorId?.toString(),companyName:l.current_owner?.company_name||l.currentOwner?.companyName||"نامشخص",elevatorName:l.current_owner?.elevator_name||l.currentOwner?.elevatorName},status:l.status||"available",createdAt:l.created_at||l.createdAt||new Date().toLocaleDateString("fa-IR"),updatedAt:l.updated_at||l.updatedAt,features:l.features||[],qrCode:l.qr_code||l.qrCode})):[];f(x)}catch(t){if(console.error("Error fetching parts:",t),f([]),t&&typeof t=="object"&&"isNetworkError"in t){const a=t;a.isNetworkError?n.error("عدم دسترسی به سرور برای دریافت قطعات"):a.isAuthError?n.error("خطای احراز هویت در دریافت قطعات"):n.error("خطا در بارگذاری قطعات")}else n.error("خطا در بارگذاری قطعات")}finally{d(!1)}},ce=async()=>{try{const t=await C.get("/admin/categories/parts"),a=t.categories||t.data||t||[],x=Array.isArray(a)?a.map(l=>({id:l.id?.toString()||l._id?.toString(),name:l.title||l.name,parentId:l.parent_id?.toString()||l.parentId?.toString(),children:l.children||[],technicalSpecs:l.technical_specs||l.technicalSpecs||[]})):[];h(x)}catch(t){console.error("Error fetching categories:",t),h([]),t&&typeof t=="object"&&"isNetworkError"in t&&(t.isNetworkError||n.error("خطا در بارگذاری دسته‌بندی‌ها"))}},we=async t=>{try{await C.delete(`/admin/parts/${t.id}`),f(a=>a.filter(x=>x.id!==t.id)),$(null),n.success(`${t.title} حذف شد`),J()}catch(a){if(console.error("Error deleting part:",a),a&&typeof a=="object"&&"isNetworkError"in a){const x=a;x.isNetworkError?n.error("عدم دسترسی به سرور برای حذف قطعه"):x.isAuthError?n.error("خطای احراز هویت"):n.error("خطا در حذف قطعه")}else n.error("خطا در حذف قطعه")}},Ce=async t=>{try{if(!b)return;await C.post(`/admin/parts/${b.id}/sell`,t),f(a=>a.map(x=>x.id===b.id?{...x,status:"sold",currentOwner:{type:"company",companyId:t.buyerCompanyId}}:x)),R(!1),T(null),n.success(`${b.title} با موفقیت فروخته شد`),J()}catch(a){console.error("Error selling part:",a),n.error("خطا در فروش قطعه")}},Se=async t=>{try{const a=await C.post(`/admin/parts/${t.id}/qr`);a.qrCode&&(f(x=>x.map(l=>l.id===t.id?{...l,qrCode:a.qrCode}:l)),n.success("کد QR با موفقیت تولید شد"))}catch(a){console.error("Error generating QR code:",a),n.error("خطا در تولید کد QR")}},De=async t=>{try{const a=await C.post(`/admin/parts/${t.id}/pdf`);a.downloadUrl&&(window.open(a.downloadUrl,"_blank"),n.success("شناسنامه PDF با موفقیت تولید شد"))}catch(a){console.error("Error generating PDF:",a),n.error("خطا در تولید شناسنامه PDF")}},X=async()=>{s(!0);try{await Promise.all([ne(),ce(),J()]),n.success("داده‌ها با موفقیت به‌روزرسانی شد")}catch{n.error("خطا در به‌روزرسانی داده‌ها")}finally{s(!1)}},Ae=c.filter(t=>{const a=t.title.toLowerCase().includes(I.toLowerCase())||t.partUid.toLowerCase().includes(I.toLowerCase())||t.barcode.toLowerCase().includes(I.toLowerCase())||t.categoryName&&t.categoryName.toLowerCase().includes(I.toLowerCase()),x=V==="all"||t.status===V;return a&&x}),Te=(t,a)=>{let x=null;for(const l of i)if(l.children&&l.children.find(Ee=>Ee.id===t)){x=l;break}return x?`${x.name} / ${a}`:a||"نامشخص"},ke=()=>e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[...Array(5)].map((t,a)=>e.jsx(g,{className:"border-l-4 border-l-gray-300",children:e.jsx(j,{className:"p-3",children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx(U,{className:"h-6 w-12 mx-auto"}),e.jsx(U,{className:"h-3 w-16 mx-auto"})]})})},a))}),Ie=[{key:"title",label:"نام قطعه",sortable:!0,render:(t,a)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["UID: ",a.partUid]})]})]})},{key:"barcode",label:"بارکد",sortable:!0,render:(t,a)=>e.jsx("div",{className:"font-mono text-sm",children:t||"بدون بارکد"})},{key:"categoryName",label:"دسته‌بندی",filterable:!0,render:(t,a)=>e.jsx(se,{variant:"outline",className:"text-xs",children:Te(a.categoryId,t)})},{key:"manufacturerCountry",label:"کشور سازنده",sortable:!0,render:t=>e.jsx("div",{className:"text-sm",children:t})},{key:"currentOwner",label:"مالک فعلی",sortable:!0,render:(t,a)=>e.jsx("div",{className:"text-sm",children:t.type==="company"?e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Fe,{className:"w-3 h-3"}),t.companyName||a.registrantCompanyName||"نامشخص"]})}):e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(B,{className:"w-3 h-3"}),t.elevatorName||"آسانسور نامشخص"]})})})},{key:"status",label:"وضعیت",filterable:!0,sortable:!0,render:t=>e.jsx(se,{variant:"secondary",className:be[t],children:ve[t]})},{key:"createdAt",label:"تاریخ ثبت",sortable:!0,render:t=>e.jsx("div",{className:"text-sm",children:t})},{key:"actions",label:"عملیات",render:(t,a)=>e.jsxs($e,{children:[e.jsx(Qe,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"sm",children:e.jsx(ls,{className:"w-4 h-4"})})}),e.jsxs(Ue,{align:"end",style:{direction:"rtl"},children:[e.jsxs(E,{onClick:()=>O(a),style:{textAlign:"right",justifyContent:"flex-end"},children:[e.jsx(Me,{className:"w-4 h-4 mr-2"}),"شناسنامه قطعه"]}),e.jsxs(E,{onClick:()=>De(a),style:{textAlign:"right",justifyContent:"flex-end"},children:[e.jsx(ye,{className:"w-4 h-4 mr-2"}),"دانلود شناسنامه PDF"]}),e.jsx(ee,{}),e.jsxs(E,{onClick:()=>Se(a),style:{textAlign:"right",justifyContent:"flex-end"},children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"تولید QR Code"]}),e.jsx(ee,{}),a.status==="available"&&e.jsxs(e.Fragment,{children:[e.jsxs(E,{onClick:()=>{T(a),R(!0)},style:{textAlign:"right",justifyContent:"flex-end"},children:[e.jsx(Ne,{className:"w-4 h-4 mr-2"}),"فروش قطعه"]}),e.jsxs(E,{onClick:()=>{W(a),K(!0)},style:{textAlign:"right",justifyContent:"flex-end"},children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"انتقال قطعه"]}),e.jsx(ee,{})]}),e.jsxs(E,{style:{textAlign:"right",justifyContent:"flex-end"},children:[e.jsx(is,{className:"w-4 h-4 mr-2"}),"ویرایش"]}),e.jsxs(E,{onClick:()=>$(a),className:"text-destructive focus:text-destructive",style:{textAlign:"right",justifyContent:"flex-end"},children:[e.jsx(ns,{className:"w-4 h-4 mr-2"}),"حذف"]})]})]})}];return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"مدیریت قطعات"}),e.jsx("p",{className:"text-muted-foreground",children:"لیست و مدیریت تمامی قطعات سیستم"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{variant:"outline",onClick:X,disabled:k,children:[k?e.jsx(de,{className:"w-4 h-4 ml-2 animate-spin"}):e.jsx(oe,{className:"w-4 h-4 ml-2"}),"به‌روزرسانی"]}),e.jsxs(me,{open:w,onOpenChange:A,children:[e.jsx(qe,{asChild:!0,children:e.jsxs(p,{children:[e.jsx(ts,{className:"w-4 h-4 ml-2"}),"ثبت قطعه جدید"]})}),e.jsxs(xe,{className:"max-w-4xl max-h-[90vh]",style:{direction:"rtl",textAlign:"right"},children:[e.jsxs(he,{style:{textAlign:"right"},children:[e.jsx(ue,{style:{textAlign:"right"},children:"ثبت قطعه جدید"}),e.jsx(ge,{style:{textAlign:"right"},children:"اطلاعات قطعه جدید را وارد کنید"})]}),e.jsx(je,{className:"max-h-[calc(90vh-8rem)] overflow-auto",style:{direction:"rtl"},children:e.jsx(ms,{categories:i,onClose:()=>A(!1)})})]})]})]})]}),v?e.jsx(ke,{}):e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[e.jsx(g,{className:"border-l-4 border-l-blue-500",children:e.jsx(j,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-blue-600",children:N.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"کل قطعات"})]})})}),e.jsx(g,{className:"border-l-4 border-l-green-500",children:e.jsx(j,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-green-600",children:N.available}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"در انبار"})]})})}),e.jsx(g,{className:"border-l-4 border-l-purple-500",children:e.jsx(j,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-purple-600",children:N.installed}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"نصب شده"})]})})}),e.jsx(g,{className:"border-l-4 border-l-orange-500",children:e.jsx(j,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-orange-600",children:N.maintenance}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"در تعمیر"})]})})}),e.jsx(g,{className:"border-l-4 border-l-indigo-500",children:e.jsx(j,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("p",{className:"text-lg font-bold text-indigo-600",children:N.thisMonth}),N.monthlyGrowth>0?e.jsx(Pe,{className:"w-3 h-3 text-green-500"}):N.monthlyGrowth<0?e.jsx(rs,{className:"w-3 h-3 text-red-500"}):null]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"این ماه"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(as,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(y,{placeholder:"جستجو در قطعات (نام، UID، بارکد)...",value:I,onChange:t=>le(t.target.value),className:"pr-10"})]})}),e.jsxs(P,{value:V,onValueChange:ie,children:[e.jsx(_,{className:"w-full sm:w-48",children:e.jsx(F,{placeholder:"فیلتر وضعیت"})}),e.jsxs(M,{children:[e.jsx(u,{value:"all",children:"همه وضعیت‌ها"}),e.jsx(u,{value:"available",children:"موجود"}),e.jsx(u,{value:"installed",children:"نصب شده"}),e.jsx(u,{value:"maintenance",children:"در تعمیر"}),e.jsx(u,{value:"sold",children:"فروخته شده"})]})]})]}),e.jsxs(g,{children:[e.jsxs(G,{children:[e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-5 h-5"}),"لیست قطعات"]}),e.jsx(_e,{children:r?e.jsx("span",{children:"در حال بارگذاری..."}):c.length>0?e.jsxs(e.Fragment,{children:["مجموعاً ",c.length," قطعه یافت شد"]}):e.jsx(e.Fragment,{children:"هیچ قطعه‌ای یافت نشد"})})]}),e.jsx(j,{children:r?e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"rounded-md border",children:e.jsx("div",{className:"overflow-hidden",children:[...Array(5)].map((t,a)=>e.jsxs("div",{className:"flex items-center space-x-4 space-x-reverse p-4 border-b last:border-b-0",children:[e.jsx(U,{className:"h-12 w-12 rounded-lg"}),e.jsxs("div",{className:"space-y-2 flex-1",children:[e.jsx(U,{className:"h-4 w-[250px]"}),e.jsx(U,{className:"h-4 w-[200px]"})]}),e.jsx(U,{className:"h-8 w-20"})]},a))})})}):c.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(B,{className:"w-8 h-8 text-gray-400"})}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:"text-lg font-medium text-muted-foreground",children:"قطعه‌ای یافت نشد"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md",children:I||V!=="all"?"هیچ قطعه‌ای با این فیلترها موجود نیست. لطفاً جستجوی خود را تغییر دهید.":"هنوز قطعه‌ای ثبت نشده است. پس از ثبت قطعات جدید، آنها در اینجا نمایش داده خواهند شد."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(p,{onClick:X,variant:"outline",disabled:k,children:[k?e.jsx(de,{className:"w-4 h-4 ml-2 animate-spin"}):e.jsx(oe,{className:"w-4 h-4 ml-2"}),"تلاش مجدد"]}),(I||V!=="all")&&e.jsx(p,{onClick:()=>{le(""),ie("all")},variant:"ghost",children:"پاک کردن فیلترها"})]})]}):e.jsx(Ze,{data:Ae,columns:Ie,searchable:!1,filterable:!1,exportable:!0,pagination:!0,pageSize:15,emptyMessage:"قطعه‌ای یافت نشد",onRowClick:t=>O(t),onRefresh:X,refreshing:k})})]}),S&&e.jsx(me,{open:!!S,onOpenChange:()=>O(null),children:e.jsxs(xe,{className:"max-w-5xl max-h-[90vh]",style:{direction:"rtl",textAlign:"right"},children:[e.jsxs(he,{style:{textAlign:"right"},children:[e.jsxs(ue,{style:{textAlign:"right"},children:["شناسنامه قطعه: ",S.title]}),e.jsx(ge,{style:{textAlign:"right"},children:"مشاهده اطلاعات کامل و مشخصات فنی قطعه"})]}),e.jsx(je,{className:"max-h-[calc(90vh-8rem)] overflow-auto",style:{direction:"rtl"},children:e.jsx(xs,{part:S})})]})}),b&&e.jsx(ss,{isOpen:L,onClose:()=>{R(!1),T(null)},onSell:Ce,part:{id:b.id,name:b.title,model:"",serialNumber:b.partUid,price:0}}),q&&e.jsx(ze,{open:!!q,onOpenChange:()=>$(null),children:e.jsxs(Ve,{style:{direction:"rtl",textAlign:"right"},children:[e.jsxs(Be,{style:{textAlign:"right"},children:[e.jsx(He,{style:{textAlign:"right"},children:"تأیید حذف قطعه"}),e.jsxs(Je,{style:{textAlign:"right"},children:['آیا از حذف قطعه "',q.title,'" اطمینان دارید؟ این عمل قابل بازگشت نیست.']})]}),e.jsxs(Ke,{className:"flex-row-reverse",children:[e.jsx(We,{onClick:()=>$(null),children:"انصراف"}),e.jsx(Xe,{onClick:()=>we(q),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"حذف"})]})]})})]})}const pe=["ایران","آلمان","ایتالیا","ترکیه","چین","کره جنوبی","ژاپن","فنلاند","سوئد","سوئیس"];function ms({categories:c,onClose:f}){const[i,h]=m.useState({name:"",model:"",serialNumber:"",categoryId:"",manufacturer:"",brand:"",price:"",productType:"manufactured",manufacturerCountry:"ایران",originCountry:"",productionDate:"",specifications:{}}),[N,H]=m.useState(!1),[S,O]=m.useState(1),[w,A]=m.useState([""]),[L,R]=m.useState(null),D=m.useMemo(()=>{if(!i.categoryId)return null;const s=c.find(r=>r.id===i.categoryId);if(s)return s;for(const r of c)if(r.children){const d=r.children.find(v=>v.id===i.categoryId);if(d)return d}return null},[i.categoryId,c]),K=async s=>{if(s.preventDefault(),i.productType==="imported"&&!L){n.error("برای قطعات وارداتی، بارگذاری برگه سبز ترخیص کالا الزامی است");return}try{if(N){if(w.filter(Q=>!Q.trim()).length>0){n.error("لطفاً تمام شماره‌های سریال را وارد کنید");return}if(new Set(w).size!==w.length){n.error("شماره‌های سریال نمی‌توانند تکراری باشند");return}const v={parts:w.map(Q=>({title:i.name,categoryId:parseInt(i.categoryId),barcode:Q,manufacturerCountry:i.manufacturerCountry,originCountry:i.productType==="imported"?i.originCountry:i.manufacturerCountry,features:Object.entries(i.specifications).map(([re,ae])=>({featureKey:re,value:ae}))}))};await C.post("/admin/parts/batch",v),n.success(`${S} قطعه ${i.productType==="imported"?"وارداتی":"تولیدی"} دسته‌ای ثبت شد`)}else{const r={title:i.name,categoryId:parseInt(i.categoryId),barcode:i.serialNumber,manufacturerCountry:i.manufacturerCountry,originCountry:i.productType==="imported"?i.originCountry:i.manufacturerCountry,features:Object.entries(i.specifications).map(([d,v])=>({featureKey:d,value:v}))};await C.post("/admin/parts",r),n.success(`قطعه ${i.productType==="imported"?"وارداتی":"تولیدی"} جدید ثبت شد`)}f(),window.location.reload()}catch(r){if(console.error("Error creating part:",r),r&&typeof r=="object"&&"isNetworkError"in r){const d=r;d.isNetworkError?n.error("عدم دسترسی به سرور برای ثبت قطعه"):d.isAuthError?n.error("خطای احراز هویت"):n.error("خطا در ثبت قطعه")}else n.error("خطا در ثبت قطعه")}},b=s=>{console.log("Category changed to:",s),h(r=>({...r,categoryId:s,specifications:{}}))},T=(s,r)=>{h(d=>({...d,specifications:{...d.specifications,[s]:r}}))},te=s=>{H(s),s?(A(Array(S).fill("")),h(r=>({...r,serialNumber:""}))):(A([""]),O(1))},W=s=>{O(s);const r=Array(s).fill("");for(let d=0;d<Math.min(s,w.length);d++)r[d]=w[d]||"";A(r)},q=(s,r)=>{A(d=>{const v=[...d];return v[s]=r,v})},$=s=>{const r=s.target.files?.[0];if(r){if(!["application/pdf","image/jpeg","image/png","image/jpg"].includes(r.type)){n.error("فقط فایل‌های PDF، JPG و PNG مجاز هستند");return}if(r.size>5*1024*1024){n.error("حجم فایل نباید بیشتر از ۵ مگابایت باشد");return}R(r),n.success("فایل برگه سبز ترخیص کالا بارگذاری شد")}},k=s=>{h(r=>{const d={...r,productType:s};return s==="manufactured"?d.manufacturerCountry="ایران":s==="imported"&&(d.manufacturerCountry=""),d}),s==="manufactured"&&L&&R(null)};return e.jsx("div",{className:"space-y-6",dir:"rtl",children:e.jsxs("form",{onSubmit:K,className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsx("h3",{className:"font-medium text-blue-800 flex items-center gap-2 mb-4",children:"📦 اطلاعات پایه قطعه"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"name",className:"text-blue-700 flex items-center gap-2",children:"📝 نام قطعه *"}),e.jsx(y,{id:"name",placeholder:"نام قطعه را وارد کنید",value:i.name,onChange:s=>h(r=>({...r,name:s.target.value})),className:"bg-white border-blue-300",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"model",className:"text-blue-700 flex items-center gap-2",children:"🏷️ مدل *"}),e.jsx(y,{id:"model",placeholder:"مدل قطعه",value:i.model,onChange:s=>h(r=>({...r,model:s.target.value})),className:"bg-white border-blue-300",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"category",className:"text-blue-700 flex items-center gap-2",children:"📂 دسته‌بندی قطعه *"}),e.jsxs(P,{value:i.categoryId,onValueChange:b,children:[e.jsx(_,{className:"bg-white border-blue-300",children:e.jsx(F,{placeholder:"انتخاب دسته‌بندی"})}),e.jsx(M,{children:c.flatMap(s=>s.children?s.children.map(r=>e.jsx(u,{value:r.id,children:r.name},r.id)):[e.jsx(u,{value:s.id,children:s.name},s.id)])})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"manufacturer",className:"text-blue-700 flex items-center gap-2",children:"🏭 سازنده *"}),e.jsx(y,{id:"manufacturer",placeholder:"نام سازنده",value:i.manufacturer,onChange:s=>h(r=>({...r,manufacturer:s.target.value})),className:"bg-white border-blue-300",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"brand",className:"text-blue-700 flex items-center gap-2",children:"🏢 برند"}),e.jsx(y,{id:"brand",placeholder:"نام برند",value:i.brand,onChange:s=>h(r=>({...r,brand:s.target.value})),className:"bg-white border-blue-300"})]})]})]}),e.jsxs("div",{className:"bg-indigo-50 p-4 rounded-lg border border-indigo-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-medium text-indigo-800 flex items-center gap-2",children:"📊 نحوه ثبت قطعه"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{htmlFor:"batch-mode",className:"text-indigo-700 flex items-center gap-2",children:"📦 ثبت دسته‌ای"}),e.jsx(Ge,{id:"batch-mode",checked:N,onCheckedChange:te})]})]}),N?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white p-3 rounded border border-indigo-300",children:[e.jsx("p",{className:"text-indigo-700 mb-3 flex items-center gap-2",children:"✨ حالت ثبت دسته‌ای فعال است"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-indigo-700 flex items-center gap-2",children:"🔢 تعداد قطعات *"}),e.jsx(y,{type:"number",min:1,max:50,value:S,onChange:s=>W(Math.max(1,Math.min(50,parseInt(s.target.value)||1))),className:"bg-white border-indigo-300 text-left",dir:"ltr"}),e.jsx("p",{className:"text-xs text-indigo-600",children:"💡 حداکثر ۵۰ قطعه در هر بار"})]})})]}),e.jsxs("div",{className:"bg-white p-3 rounded border border-indigo-300",children:[e.jsx("h4",{className:"font-medium text-indigo-800 mb-3 flex items-center gap-2",children:"🏷️ شماره‌های سریال قطعات"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-64 overflow-y-auto",children:w.map((s,r)=>e.jsxs("div",{className:"space-y-1",children:[e.jsxs(o,{className:"text-indigo-700 text-sm",children:["قطعه ",r+1]}),e.jsx(y,{placeholder:`Serial Number ${r+1}`,value:s,onChange:d=>q(r,d.target.value),className:"bg-white border-indigo-300 text-left",dir:"ltr",required:!0})]},r))}),e.jsx("p",{className:"text-xs text-indigo-600 mt-2",children:"⚠️ تمام شماره‌های سریال باید منحصر به فرد باشند"})]})]}):e.jsx("div",{className:"bg-white p-3 rounded border border-indigo-300",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"serialNumber",className:"text-indigo-700 flex items-center gap-2",children:"🔢 شماره سریال *"}),e.jsx(y,{id:"serialNumber",placeholder:"Serial Number",value:i.serialNumber,onChange:s=>h(r=>({...r,serialNumber:s.target.value})),className:"bg-white border-indigo-300 text-left",dir:"ltr",required:!0}),e.jsx("p",{className:"text-xs text-indigo-600",children:"💡 برای ثبت چندین قطعه با مشخصات یکسان، حالت دسته‌ای را فعال کنید"})]})})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[e.jsx("h3",{className:"font-medium text-green-800 flex items-center gap-2 mb-4",children:"💰 اطلاعات قیمت"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"price",className:"text-green-700 flex items-center gap-2",children:"💵 قیمت (ریال)"}),e.jsx(y,{id:"price",type:"number",placeholder:"قیمت قطعه به ریال",value:i.price,onChange:s=>h(r=>({...r,price:s.target.value})),className:"bg-white border-green-300 text-left",dir:"ltr"}),e.jsx("p",{className:"text-xs text-green-600",children:'💡 در صورت عدم وارد کردن، قیمت به عنوان "تعیین نشده" ثبت خواهد شد'})]})]}),i.categoryId&&e.jsx("div",{className:"bg-yellow-50 p-3 rounded border border-yellow-300",children:e.jsxs("p",{className:"text-xs text-yellow-800",children:["🐛 Debug: categoryId = ",i.categoryId,", selectedCategory = ",D?.name||"null",", specs = ",D?.technicalSpecs?.length||0]})}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:[e.jsx("h3",{className:"font-medium text-purple-800 flex items-center gap-2 mb-4",children:"🌍 اطلاعات تولید/واردات"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-purple-700 flex items-center gap-2",children:"🏭 نوع قطعه *"}),e.jsxs(P,{value:i.productType,onValueChange:k,children:[e.jsx(_,{className:"bg-white border-purple-300",children:e.jsx(F,{})}),e.jsxs(M,{children:[e.jsx(u,{value:"manufactured",children:"🏭 تولیدی"}),e.jsx(u,{value:"imported",children:"🚢 وارداتی"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{className:"text-purple-700 flex items-center gap-2",children:["📅 ",i.productType==="manufactured"?"تاریخ تولید":"تاریخ واردات"]}),e.jsx(es,{value:i.productionDate,onChange:s=>h(r=>({...r,productionDate:s})),placeholder:i.productType==="manufactured"?"انتخاب تاریخ تولید":"انتخاب تاریخ واردات"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{className:"text-purple-700 flex items-center gap-2",children:["🏳️ کشور سازنده *",i.productType==="manufactured"&&e.jsx("span",{className:"text-xs text-green-600",children:"(اتوماتیک)"})]}),e.jsxs(P,{value:i.manufacturerCountry,onValueChange:s=>h(r=>({...r,manufacturerCountry:s})),disabled:i.productType==="manufactured",children:[e.jsx(_,{className:`bg-white border-purple-300 ${i.productType==="manufactured"?"opacity-75 cursor-not-allowed":""}`,children:e.jsx(F,{placeholder:i.productType==="manufactured"?"ایران":"انتخاب کشور"})}),e.jsx(M,{children:pe.map(s=>e.jsx(u,{value:s,children:s},s))})]}),i.productType==="manufactured"&&e.jsx("p",{className:"text-xs text-green-600 flex items-center gap-1",children:"✨ برای قطعات تولیدی، کشور سازنده اتوماتیک ایران انتخاب می‌شود"})]}),i.productType==="imported"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-purple-700 flex items-center gap-2",children:"🌍 کشور مبدأ"}),e.jsxs(P,{value:i.originCountry,onValueChange:s=>h(r=>({...r,originCountry:s})),children:[e.jsx(_,{className:"bg-white border-purple-300",children:e.jsx(F,{placeholder:"انتخاب کشور مبدأ"})}),e.jsx(M,{children:pe.map(s=>e.jsx(u,{value:s,children:s},s))})]})]})]}),i.productType==="imported"&&e.jsx("div",{className:"mt-4 space-y-3",children:e.jsxs("div",{className:"bg-orange-50 p-3 rounded border border-orange-300",children:[e.jsx("h4",{className:"font-medium text-orange-800 mb-3 flex items-center gap-2",children:"📄 مدارک واردات (الزامی)"}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-orange-700 flex items-center gap-2",children:"📋 برگه سبز ترخیص کالا *"}),e.jsx(y,{type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:$,className:"bg-white border-orange-300"}),L&&e.jsxs("p",{className:"text-xs text-green-600 flex items-center gap-1",children:["✅ فایل انتخاب شده: ",L.name]}),e.jsx("p",{className:"text-xs text-orange-600",children:"📎 فرمت‌های مجاز: PDF، JPG، PNG | حداکثر حجم: ۵ مگابایت"})]})})]})})]}),D&&D.technicalSpecs&&D.technicalSpecs.length>0&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[e.jsxs("h3",{className:"font-medium text-gray-800 flex items-center gap-2 mb-4",children:["⚙️ مشخصات فنی (",D.name,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:D.technicalSpecs.map(s=>e.jsxs("div",{className:"space-y-2",children:[e.jsxs(o,{className:"text-gray-700 flex items-center gap-2",children:["🔧 ",s.name," ",s.unit&&`(${s.unit})`]}),s.type==="list"?e.jsxs(P,{value:i.specifications[s.name]||"",onValueChange:r=>T(s.name,r),children:[e.jsx(_,{className:"bg-white border-gray-300",children:e.jsx(F,{placeholder:`انتخاب ${s.name}`})}),e.jsx(M,{children:s.unit.split("/").map(r=>e.jsx(u,{value:r,children:r},r))})]}):s.type==="boolean"?e.jsxs(P,{value:i.specifications[s.name]||"",onValueChange:r=>T(s.name,r),children:[e.jsx(_,{className:"bg-white border-gray-300",children:e.jsx(F,{placeholder:`انتخاب ${s.name}`})}),e.jsxs(M,{children:[e.jsx(u,{value:"true",children:"بله"}),e.jsx(u,{value:"false",children:"خیر"})]})]}):e.jsx(y,{type:s.type==="number"?"number":"text",placeholder:`وارد کردن ${s.name}`,value:i.specifications[s.name]||"",onChange:r=>T(s.name,r.target.value),className:"bg-white border-gray-300"})]},s.name))})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(p,{type:"button",variant:"outline",onClick:f,className:"border-gray-300 text-gray-700 hover:bg-gray-50",children:"انصراف"}),e.jsx(p,{type:"submit",className:"bg-black hover:bg-gray-800 text-white",children:"ثبت قطعه"})]})]})})}function xs({part:c}){return e.jsx("div",{className:"space-y-6",dir:"rtl",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[e.jsx("div",{className:"lg:col-span-3",children:e.jsxs(Le,{defaultValue:"info",className:"w-full",dir:"rtl",children:[e.jsxs(Re,{className:"grid w-full grid-cols-3",dir:"rtl",children:[e.jsx(Y,{value:"info",className:"text-right",children:"اطلاعات پایه"}),e.jsx(Y,{value:"features",className:"text-right",children:"مشخصات فنی"}),e.jsx(Y,{value:"history",className:"text-right",children:"تاریخچه"})]}),e.jsx(Z,{value:"info",className:"space-y-4",dir:"rtl",children:e.jsxs(g,{className:"text-right",children:[e.jsx(G,{className:"text-right",children:e.jsx(z,{className:"text-lg text-right",children:"اطلاعات کامل قطعه"})}),e.jsx(j,{className:"text-right",children:e.jsxs("div",{className:"space-y-6 text-right",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground mb-3 text-right",children:"اطلاعات پایه"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground text-right",children:"نام قطعه:"}),e.jsx("p",{className:"mt-1 font-medium text-right",children:c.title})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground text-right",children:"UID قطعه:"}),e.jsx("p",{className:"mt-1 font-medium text-right font-mono",children:c.partUid})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground text-right",children:"بارکد:"}),e.jsx("p",{className:"mt-1 font-medium text-right font-mono",children:c.barcode||"بدون بارکد"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground text-right",children:"دسته‌بندی:"}),e.jsx("p",{className:"mt-1 font-medium text-right",children:c.categoryName||"نامشخص"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground text-right",children:"کشور سازنده:"}),e.jsx("p",{className:"mt-1 font-medium text-right",children:c.manufacturerCountry})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground text-right",children:"کشور مبدأ:"}),e.jsx("p",{className:"mt-1 font-medium text-right",children:c.originCountry})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground text-right",children:"وضعیت:"}),e.jsx("div",{className:"mt-1",children:e.jsx(se,{variant:"secondary",className:be[c.status],children:ve[c.status]})})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground text-right",children:"مالک فعلی:"}),e.jsx("p",{className:"mt-1 font-medium text-right",children:c.currentOwner.type==="company"?c.currentOwner.companyName||c.registrantCompanyName||"شرکت نامشخص":c.currentOwner.elevatorName||"آسانسور نامشخص"})]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("h4",{className:"font-medium text-sm text-muted-foreground mb-3 text-right",children:"تاریخ‌ها"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground text-right",children:"تاریخ ثبت:"}),e.jsx("p",{className:"mt-1 font-medium text-right",children:c.createdAt})]}),c.updatedAt&&e.jsxs("div",{className:"text-right",children:[e.jsx(o,{className:"text-sm font-medium text-muted-foreground text-right",children:"آخرین بروزرسانی:"}),e.jsx("p",{className:"mt-1 font-medium text-right",children:c.updatedAt})]})]})]})]})})]})}),e.jsx(Z,{value:"features",className:"space-y-4",dir:"rtl",children:e.jsxs(g,{className:"text-right",children:[e.jsx(G,{className:"text-right",children:e.jsx(z,{className:"text-lg text-right",children:"مشخصات فنی"})}),e.jsx(j,{className:"text-right",children:c.features&&c.features.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:c.features.map((f,i)=>e.jsxs("div",{className:"text-right",children:[e.jsxs(o,{className:"text-sm font-medium text-muted-foreground text-right",children:[f.name,":"]}),e.jsx("p",{className:"mt-1 font-medium text-right",children:f.value||"نامشخص"})]},i))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(B,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"مشخصات فنی تعریف نشده"})]})})]})}),e.jsx(Z,{value:"history",className:"space-y-4",dir:"rtl",children:e.jsxs(g,{className:"text-right",children:[e.jsx(G,{className:"text-right",children:e.jsx(z,{className:"text-lg text-right",children:"تاریخچه انتقال‌ها"})}),e.jsx(j,{className:"text-right",children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx(cs,{className:"w-12 h-12 text-muted-foreground mx-auto mb-3"}),e.jsx("p",{className:"text-muted-foreground",children:"تاریخچه انتقال در دسترس نیست"})]})})]})})]})}),e.jsxs("div",{className:"lg:col-span-1",dir:"rtl",children:[e.jsxs(g,{className:"text-right",children:[e.jsx(G,{className:"text-right",children:e.jsx(z,{className:"text-lg text-right",children:"کد QR قطعه"})}),e.jsx(j,{className:"flex flex-col items-center space-y-4 text-right",children:c.qrCode?e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:c.qrCode,alt:"QR Code",className:"w-44 h-44 mx-auto"}),e.jsxs(p,{variant:"outline",size:"sm",className:"mt-3",onClick:()=>window.open(c.qrCode,"_blank"),children:[e.jsx(ds,{className:"w-4 h-4 ml-2"}),"دانلود"]})]}):e.jsx(Ye,{data:`https://elevatorid.ieeu.ir/part/${c.partUid}`,title:"کد QR قطعه",size:180})})]}),e.jsxs(g,{className:"text-right mt-4",children:[e.jsx(G,{className:"text-right",children:e.jsx(z,{className:"text-lg text-right",children:"عملیات سریع"})}),e.jsxs(j,{className:"space-y-2",children:[e.jsxs(p,{variant:"outline",size:"sm",className:"w-full justify-start",children:[e.jsx(ye,{className:"w-4 h-4 ml-2"}),"دانلود شناسنامه PDF"]}),e.jsxs(p,{variant:"outline",size:"sm",className:"w-full justify-start",children:[e.jsx(os,{className:"w-4 h-4 ml-2"}),"مشاهده در سایت"]}),c.status==="available"&&e.jsxs(e.Fragment,{children:[e.jsxs(p,{variant:"outline",size:"sm",className:"w-full justify-start",children:[e.jsx(Ne,{className:"w-4 h-4 ml-2"}),"فروش قطعه"]}),e.jsxs(p,{variant:"outline",size:"sm",className:"w-full justify-start",children:[e.jsx(fe,{className:"w-4 h-4 ml-2"}),"انتقال قطعه"]})]})]})]})]})]})})}export{Js as default};
