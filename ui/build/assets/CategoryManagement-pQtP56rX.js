import{r as x,t as o,$ as he,j as e,q as xe,x as A,C as w,e as L,p as T,b as oe,c as pe,a0 as ue,o as E,B as p,L as v,v as je}from"./index-tH8kGzNV.js";import{T as q,a as _,b as P,c as i,d as K,e as r}from"./table-DC3MYrD8.js";import{D as Ne,a as ge,b as fe,c as ve,d as be,e as ye}from"./dialog-DAjwwShP.js";import{S as W,a as X,b as G,c as J,d as b}from"./select-B8NiX_r6.js";import{S as g}from"./skeleton-vzO12S3j.js";import{I as Se}from"./info-BmNqUgv1.js";import{S as we}from"./search-8LTSveb2.js";import{F as Ce}from"./folder-tree-CoiUlgID.js";import{P as H}from"./plus-A2-5MgKF.js";import{X as Ie}from"./x-B6dSK8zO.js";import{P as Ae}from"./pen-CJgjb0UZ.js";import{T as Te}from"./trash-2-BwVZTJjK.js";import"./index-DGGMjIYi.js";import"./Combination-Dzecd94B.js";import"./index-BdQq_4o_.js";import"./index-BuiImgyP.js";import"./check-DV_4N94Y.js";const Q={موتور:"🔧",کنترل:"⚡",ایمنی:"🛡️",کابین:"🏠",درب:"🚪",کابل:"🔗",مکانیکی:"⚙️",الکترونیک:"💻",هیدرولیک:"💧"},R=[{id:"1",name:"موتور",technicalSpecs:[{name:"قدرت",type:"number",unit:"HP"},{name:"ولتاژ",type:"number",unit:"V"},{name:"دور در دقیقه",type:"number",unit:"RPM"}]},{id:"1-1",name:"موتور AC",parentId:"1",technicalSpecs:[{name:"قدرت",type:"number",unit:"HP"},{name:"ولتاژ ورودی",type:"number",unit:"V"},{name:"فرکانس",type:"number",unit:"Hz"},{name:"نوع روتور",type:"list",unit:"قفسه سنجابی/حلقه‌ای"}]},{id:"1-2",name:"موتور DC",parentId:"1",technicalSpecs:[{name:"قدرت",type:"number",unit:"HP"},{name:"ولتاژ",type:"number",unit:"V"},{name:"جریان",type:"number",unit:"A"},{name:"نوع کموتاتور",type:"list",unit:"کربنی/مسی"}]},{id:"2",name:"کنترل کننده",technicalSpecs:[{name:"نوع ورودی",type:"text",unit:""},{name:"تعداد طبقات",type:"number",unit:"طبقه"},{name:"نوع ارتباط",type:"list",unit:"RS485/CAN/Ethernet"}]},{id:"2-1",name:"کنترلر فرکانس",parentId:"2",technicalSpecs:[{name:"قدرت",type:"number",unit:"KW"},{name:"ولتاژ ورودی",type:"number",unit:"V"},{name:"محدوده فرکانس",type:"text",unit:"Hz"},{name:"نوع کنترل",type:"list",unit:"V/f/Vector/DTC"}]},{id:"3",name:"کابل",technicalSpecs:[{name:"قطر",type:"number",unit:"mm"},{name:"ظرفیت جریان",type:"number",unit:"A"},{name:"ولتاژ مجاز",type:"number",unit:"V"}]}],V=[{id:"1",name:"آسانسور هیدرولیک",description:"آسانسور با سیستم هیدرولیک مناسب برای ساختمان‌های کم طبقه تا 6 طبقه",isActive:!0,createdAt:"۱۴۰۲/۰۹/۱۵"},{id:"2",name:"آسانسور کششی",description:"آسانسور با سیستم کششی شامل MRL (بدون موتورخانه) و کلاسیک (با موتورخانه) مناسب برای ساختمان‌های بلند",isActive:!0,createdAt:"۱۴۰۲/۰۹/۱۴"}],u=l=>({name:l?.name||"",type:l?.type&&["text","number","list","boolean"].includes(l.type)?l.type:"text",unit:l?.unit||""}),Ee=l=>({id:l?.id&&typeof l.id=="string"&&l.id.trim()?l.id.trim():"",name:l?.name&&typeof l.name=="string"&&l.name.trim()?l.name.trim():"",parentId:l?.parentId&&typeof l.parentId=="string"&&l.parentId.trim()?l.parentId.trim():void 0,children:l?.children,technicalSpecs:l?.technicalSpecs?.map(u)});function Xe({triggerDialog:l}){const[m,U]=x.useState(null),[Y,z]=x.useState(V),[d,y]=x.useState(R),[C,Z]=x.useState(""),[ee,F]=x.useState(!1),[$,B]=x.useState(!1),[h,j]=x.useState({name:"",parentId:void 0,technicalSpecs:[u()]}),[N,S]=x.useState(null),[se,f]=x.useState(!1);x.useEffect(()=>{te()},[]),x.useEffect(()=>{m&&ae(m.id)},[m]);const te=async()=>{try{F(!0),z(V)}catch(s){console.error("Error fetching elevator types:",s),o.error("خطا در بارگذاری انواع آسانسور"),z(V)}finally{F(!1)}},ae=async s=>{try{B(!0),y(R)}catch(a){console.error("Error fetching categories:",a),o.error("خطا در بارگذاری دسته‌بندی‌ها"),y(R)}finally{B(!1)}},I=()=>{j({name:"",parentId:void 0,technicalSpecs:[u()]})};he.useEffect(()=>{l&&(I(),S(null),f(!0))},[l]);const ne=()=>{j(s=>({...s,technicalSpecs:[...s.technicalSpecs,u()]}))},le=s=>{h.technicalSpecs.length>1&&j(a=>({...a,technicalSpecs:a.technicalSpecs.filter((t,n)=>n!==s)}))},D=(s,a,t)=>{j(n=>({...n,technicalSpecs:n.technicalSpecs.map((c,k)=>k===s?u({...c,[a]:t}):c)}))},ie=async s=>{if(s.preventDefault(),!h.name.trim()){o.error("نام دسته‌بندی الزامی است");return}if(!m){o.error("نوع آسانسور انتخاب نشده است");return}const a=h.technicalSpecs.map(u).filter(n=>n.name.trim()&&n.type&&n.unit.trim()),t={name:h.name.trim(),parentId:h.parentId,elevatorTypeId:m.id,technicalSpecs:a.length>0?a:void 0};try{if(N){const n=d.map(c=>c.id===N.id?{...N,...t,id:N.id}:c);y(n),o.success("دسته‌بندی بروزرسانی شد")}else{const n={id:Date.now().toString(),name:h.name.trim(),parentId:h.parentId,technicalSpecs:a.length>0?a:void 0};y([...d,n]),o.success("دسته‌بندی جدید ایجاد شد")}f(!1),I(),S(null)}catch(n){console.error("Error saving category:",n),o.error("خطا در ذخیره دسته‌بندی")}},re=s=>{const a=Ee(s);S(a),j({name:a.name,parentId:a.parentId,technicalSpecs:a.technicalSpecs?.length?a.technicalSpecs.map(u):[u()]}),f(!0)},ce=async s=>{if(window.confirm(`آیا از حذف دسته‌بندی "${s.name}" اطمینان دارید؟`))try{const a=d.filter(t=>t.id!==s.id);y(a),o.success("دسته‌بندی حذف شد")}catch(a){console.error("Error deleting category:",a),o.error("خطا در حذف دسته‌بندی")}},de=s=>{U(s)},M=s=>{if(!s.parentId)return s.name;const a=d.find(t=>t.id===s.parentId);return a?`${M(a)} / ${s.name}`:s.name},me=()=>{if($)return e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(q,{children:[e.jsx(_,{children:e.jsxs(P,{children:[e.jsx(i,{className:"text-right w-12",children:"#"}),e.jsx(i,{className:"text-right",children:"نام دسته‌بندی"}),e.jsx(i,{className:"text-right",children:"سلسله مراتب"}),e.jsx(i,{className:"text-right",children:"والد"}),e.jsx(i,{className:"text-right",children:"نوع"}),e.jsx(i,{className:"text-right",children:"مشخصات فنی"}),e.jsx(i,{className:"text-right w-32",children:"عملیات"})]})}),e.jsx(K,{children:[...Array(5)].map((t,n)=>e.jsxs(P,{children:[e.jsx(r,{children:e.jsx(g,{className:"h-4 w-6"})}),e.jsx(r,{children:e.jsx(g,{className:"h-4 w-24"})}),e.jsx(r,{children:e.jsx(g,{className:"h-4 w-32"})}),e.jsx(r,{children:e.jsx(g,{className:"h-4 w-16"})}),e.jsx(r,{children:e.jsx(g,{className:"h-4 w-20"})}),e.jsx(r,{children:e.jsx(g,{className:"h-4 w-24"})}),e.jsx(r,{children:e.jsx(g,{className:"h-4 w-16"})})]},n))})]})})});const a=d.map(t=>({...t,hierarchy:M(t),isParent:!t.parentId,parentName:t.parentId?d.find(n=>n.id===t.parentId)?.name||"والد موجود نیست":"-",techSpecsCount:t.technicalSpecs?.length||0})).sort((t,n)=>t.isParent&&!n.isParent?-1:!t.isParent&&n.isParent?1:t.hierarchy.localeCompare(n.hierarchy,"fa"));return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"rounded-md border",children:e.jsxs(q,{children:[e.jsx(_,{children:e.jsxs(P,{children:[e.jsx(i,{className:"text-right w-12",children:"#"}),e.jsx(i,{className:"text-right",children:"نام دسته‌بندی"}),e.jsx(i,{className:"text-right",children:"سلسله مراتب"}),e.jsx(i,{className:"text-right",children:"والد"}),e.jsx(i,{className:"text-right",children:"نوع"}),e.jsx(i,{className:"text-right",children:"مشخصات فنی"}),e.jsx(i,{className:"text-right w-32",children:"عملیات"})]})}),e.jsx(K,{children:a.map((t,n)=>e.jsxs(P,{className:`
                  ${t.isParent?"bg-blue-50/50 hover:bg-blue-50/70":d.find(c=>c.id===t.parentId)?"bg-green-50/30 hover:bg-green-50/50":"bg-yellow-50/50 hover:bg-yellow-50/70"}
                `,children:[e.jsx(r,{className:"text-right font-medium",children:n+1}),e.jsx(r,{className:"text-right",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:Q[t.name]||"📦"}),e.jsx("span",{className:"font-medium",children:t.name})]})}),e.jsx(r,{className:"text-right",children:e.jsx("span",{className:"text-sm text-muted-foreground",children:t.hierarchy})}),e.jsx(r,{className:"text-right",children:e.jsx("span",{className:`text-sm ${t.parentName==="والد موجود نیست"?"text-red-600":t.parentName==="-"?"text-gray-500":"text-gray-700"}`,children:t.parentName})}),e.jsx(r,{className:"text-right",children:e.jsx(E,{variant:t.isParent?"default":d.find(c=>c.id===t.parentId)?"secondary":"destructive",className:"text-xs",children:t.isParent?"دسته‌بندی اصلی":d.find(c=>c.id===t.parentId)?"زیر دسته‌بندی":"یتیم"})}),e.jsx(r,{className:"text-right",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("span",{className:"text-sm font-medium",children:[t.techSpecsCount," مشخصه"]}),t.technicalSpecs&&t.technicalSpecs.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.technicalSpecs.slice(0,2).map((c,k)=>e.jsx(E,{variant:"outline",className:"text-xs",children:c.name},k)),t.technicalSpecs.length>2&&e.jsxs(E,{variant:"outline",className:"text-xs",children:["+",t.technicalSpecs.length-2]})]})]})}),e.jsx(r,{className:"text-right",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{variant:"ghost",size:"sm",className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50 h-8 w-8 p-0",onClick:()=>re(t),children:e.jsx(Ae,{className:"h-4 w-4"})}),e.jsx(p,{variant:"ghost",size:"sm",className:"text-red-600 hover:text-red-700 hover:bg-red-50 h-8 w-8 p-0",onClick:()=>ce(t),children:e.jsx(Te,{className:"h-4 w-4"})})]})})]},t.id))})]})}),a.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"هیچ دسته‌بندی‌ای برای این نوع آسانسور تعریف نشده است"})})]})},O=Y.filter(s=>s.name.toLowerCase().includes(C.toLowerCase())||s.description.toLowerCase().includes(C.toLowerCase()));return ee?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(xe,{className:"h-8 w-8 animate-spin mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"در حال بارگذاری مدیریت دسته‌بندی‌ها..."})]})}):m?e.jsxs("div",{className:"space-y-6",style:{direction:"rtl"},children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-5 h-5 text-green-600"}),e.jsxs("h3",{className:"text-lg font-semibold",children:["دسته‌بندی قطعات: ",m.name]})]}),e.jsxs(Ne,{open:se,onOpenChange:f,children:[e.jsx(ge,{asChild:!0,children:e.jsxs(p,{onClick:()=>{I(),S(null)},className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),"دسته‌بندی جدید"]})}),e.jsxs(fe,{className:"max-w-2xl max-h-[90vh]",style:{direction:"rtl",textAlign:"right"},children:[e.jsxs(ve,{style:{textAlign:"right"},children:[e.jsx(be,{style:{textAlign:"right"},children:N?"ویرایش دسته‌بندی":"ایجاد دسته‌بندی جدید"}),e.jsxs(ye,{style:{textAlign:"right"},children:["دسته‌بندی قطعات برای ",m.name]})]}),e.jsx("div",{className:"max-h-[calc(90vh-8rem)] overflow-auto",children:e.jsxs("form",{onSubmit:ie,className:"space-y-6",style:{direction:"rtl"},children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"name",style:{textAlign:"right",display:"block"},children:"نام دسته‌بندی *"}),e.jsx(T,{id:"name",value:h.name,onChange:s=>j(a=>({...a,name:s.target.value})),placeholder:"نام دسته‌بندی را وارد کنید",required:!0,style:{textAlign:"right",direction:"rtl"}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(v,{htmlFor:"parentId",style:{textAlign:"right",display:"block"},children:"دسته‌بندی والد (اختیاری)"}),e.jsxs(W,{value:h.parentId||"none",onValueChange:s=>j(a=>({...a,parentId:s==="none"?void 0:s})),children:[e.jsx(X,{style:{textAlign:"right",direction:"rtl"},children:e.jsx(G,{placeholder:"انتخاب کنید..."})}),e.jsxs(J,{style:{direction:"rtl"},children:[e.jsx(b,{value:"none",children:"هیچ کدام (دسته‌بندی اصلی)"}),d.filter(s=>s.id!==N?.id).map(s=>e.jsxs(b,{value:s.id,children:[Q[s.name]||"📦"," ",s.name]},s.id))]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(v,{className:"text-base font-medium",children:"مشخصات فنی"}),e.jsxs(p,{type:"button",onClick:ne,size:"sm",variant:"outline",children:[e.jsx(H,{className:"w-4 h-4 ml-1"}),"افزودن مشخصه"]})]}),e.jsx("div",{className:"space-y-3",children:h.technicalSpecs.map((s,a)=>e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(v,{className:"text-sm",children:"نام مشخصه"}),e.jsx(T,{value:s.name,onChange:t=>D(a,"name",t.target.value),placeholder:"مثال: قدرت",style:{textAlign:"right",direction:"rtl"}})]}),e.jsxs("div",{className:"w-32",children:[e.jsx(v,{className:"text-sm",children:"نوع"}),e.jsxs(W,{value:s.type,onValueChange:t=>D(a,"type",t),children:[e.jsx(X,{children:e.jsx(G,{})}),e.jsxs(J,{children:[e.jsx(b,{value:"text",children:"متن"}),e.jsx(b,{value:"number",children:"عدد"}),e.jsx(b,{value:"list",children:"لیست"}),e.jsx(b,{value:"boolean",children:"بله/خیر"})]})]})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(v,{className:"text-sm",children:"واحد"}),e.jsx(T,{value:s.unit,onChange:t=>D(a,"unit",t.target.value),placeholder:"مثال: HP",style:{textAlign:"right",direction:"rtl"}})]}),h.technicalSpecs.length>1&&e.jsx(p,{type:"button",onClick:()=>le(a),size:"sm",variant:"ghost",className:"text-red-600 hover:text-red-700 hover:bg-red-50 p-2",children:e.jsx(Ie,{className:"w-4 h-4"})})]},a))})]}),e.jsxs("div",{className:"flex justify-between pt-4 border-t",children:[e.jsx("div",{}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(p,{type:"button",variant:"outline",onClick:()=>f(!1),children:"انصراف"}),e.jsx(p,{type:"submit",children:N?"بروزرسانی":"ایجاد"})]})]})]})})]})]})]}),e.jsx(w,{className:"bg-blue-50 border-blue-200",children:e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-800",children:m.name}),e.jsx("p",{className:"text-sm text-blue-600",children:m.description})]})]})})}),e.jsx("div",{className:"space-y-4",children:me()}),d.length===0&&!$&&e.jsxs(w,{className:"p-8 text-center",children:[e.jsx(je,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"هیچ دسته‌بندی یافت نشد"}),e.jsxs("p",{className:"text-muted-foreground mb-4",children:["برای ",m.name,"، اولین دسته‌بندی قطعات را ایجاد کنید"]}),e.jsxs(p,{onClick:()=>{I(),S(null),f(!0)},className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4"}),"ایجاد دسته‌بندی"]})]})]}):e.jsxs("div",{className:"space-y-6",style:{direction:"rtl"},children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-5 h-5 text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold",children:"انتخاب نوع آسانسور برای مدیریت دسته‌بندی قطعات"})]})}),e.jsx(w,{className:"bg-blue-50 border-blue-200",children:e.jsx(L,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Se,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsx("p",{className:"font-medium mb-1",children:"راهنمای استفاده:"}),e.jsx("p",{children:"ابتدا نوع آسانسور مورد نظر خود را از لیست زیر انتخاب کنید، سپس می‌توانید دسته‌بندی‌های قطعات مربوط به آن نوع آسانسور را تعریف و مدیریت کنید."})]})]})})}),e.jsxs("div",{className:"relative",children:[e.jsx(we,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(T,{placeholder:"جستجو در انواع آسانسور...",value:C,onChange:s=>Z(s.target.value),className:"pr-10",style:{textAlign:"right",direction:"rtl"}})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:O.map(s=>{const a=d.filter(t=>t.name.includes(s.name.split(" ")[1]||"")).length;return e.jsxs(w,{className:"cursor-pointer hover:shadow-lg transition-all duration-200 border-2 hover:border-blue-400 hover:scale-[1.02]",onClick:()=>de(s),children:[e.jsx(oe,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0",children:e.jsx(A,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx(pe,{className:"text-base leading-tight",children:s.name}),a>0&&e.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:[a," دسته‌بندی قطعات"]}),a===0&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"هنوز دسته‌بندی تعریف نشده"})]})]}),e.jsx(ue,{className:"w-4 h-4 text-muted-foreground flex-shrink-0"})]})}),e.jsx(L,{className:"pt-0",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2 leading-relaxed",children:s.description}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(E,{variant:s.isActive?"default":"secondary",className:"text-xs",children:s.isActive?"فعال":"غیرفعال"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.createdAt})]})]})})]},s.id)})}),O.length===0&&e.jsxs(w,{className:"p-8 text-center",children:[e.jsx(A,{className:"w-12 h-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"هیچ نوع آسانسوری یافت نشد"}),e.jsx("p",{className:"text-muted-foreground",children:C?"نتیجه‌ای برای جستجوی شما یافت نشد":"ابتدا انواع آسانسور را تعریف کنید"})]})]})}export{Xe as default};
