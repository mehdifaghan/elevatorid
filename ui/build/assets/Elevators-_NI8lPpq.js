import{r as a,t as j,j as e,B as N,V as Y,C as m,e as h,x as Z,W as me,O as he,p as P,b as V,c as L,d as je,o as ee,M as ue,Q as pe,H as ge,L as f}from"./index-tH8kGzNV.js";import{T as fe,a as Ne,b as se,c as p,d as ve,e as g}from"./table-DC3MYrD8.js";import{D as E,b as O,c as T,d as M,e as D}from"./dialog-DAjwwShP.js";import{D as ye,a as be,b as we,c as H}from"./dropdown-menu-BKfQT_JD.js";import{S as Q,a as $,b as A,c as z,d as i}from"./select-B8NiX_r6.js";import{T as ae}from"./textarea-1hTYB3HE.js";import{E as Ce}from"./ElevatorRegistrationForm-C4UDbIJW.js";import{Q as Se}from"./QRCodeGenerator-DzqPO6-F.js";import{r as R}from"./real-api-client-o-2gE2Hp.js";import{P as Ee}from"./plus-A2-5MgKF.js";import{C as Oe}from"./clock-BiwlPOks.js";import{S as Te}from"./search-8LTSveb2.js";import{F as Me}from"./folder-tree-CoiUlgID.js";import{E as De}from"./ellipsis-J_HkHiqq.js";import"./index-DGGMjIYi.js";import"./Combination-Dzecd94B.js";import"./x-B6dSK8zO.js";import"./chevron-right-B97jr1RJ.js";import"./check-DV_4N94Y.js";import"./index-BdQq_4o_.js";import"./index-BuiImgyP.js";import"./PersianDatePicker-1MwY2jFT.js";import"./popover-B3pW-y7H.js";import"./utils-BvTIn9cQ.js";import"./ProvinceAndCitySelector-ByNK_lw_.js";import"./iran-provinces-cities-ClUeFN4S.js";import"./download-BGqk_jGh.js";import"./copy-CIVXPvX_.js";function is(){const[t,o]=a.useState([]),[u,v]=a.useState(!0),[n,y]=a.useState(""),[d,b]=a.useState("all"),[x,r]=a.useState(null),[w,c]=a.useState(!1),[C,G]=a.useState(!1),[U,I]=a.useState(!1),[W,k]=a.useState(!1),[F,te]=a.useState(null),[B,le]=a.useState(null),[J,_]=a.useState(!1),[S,K]=a.useState({total:0,active:0,maintenance:0,outOfOrder:0,installing:0}),re={active:"bg-green-100 text-green-800 border-green-300",maintenance:"bg-yellow-100 text-yellow-800 border-yellow-300",out_of_order:"bg-red-100 text-red-800 border-red-300",installing:"bg-blue-100 text-blue-800 border-blue-300"},ne={active:"🟢 فعال",maintenance:"🟡 تعمیرات",out_of_order:"🔴 خراب",installing:"🔵 در حال نصب"};a.useEffect(()=>{q()},[]);const q=async()=>{try{v(!0);const l=(await R.get("/user/elevators")).data.elevators||[];o(l),K(ce(l))}catch(s){console.error("Error fetching elevators:",s),j.error("خطا در بارگذاری اطلاعات آسانسورها"),o([]),K({total:0,active:0,maintenance:0,outOfOrder:0,installing:0})}finally{v(!1)}},ce=s=>({total:s.length,active:s.filter(l=>l.status==="active").length,maintenance:s.filter(l=>l.status==="maintenance").length,outOfOrder:s.filter(l=>l.status==="out_of_order").length,installing:s.filter(l=>l.status==="installing").length}),X=t.filter(s=>{const l=s.buildingName.toLowerCase().includes(n.toLowerCase())||s.uid.toLowerCase().includes(n.toLowerCase())||s.address.includes(n),xe=d==="all"||s.status===d;return l&&xe}),ie=s=>{le(s),I(!0)},de=async()=>{G(!0),await q(),G(!1),j.success("✅ اطلاعات بروزرسانی شد")},oe=async s=>{try{(await R.post("/user/elevators",s)).data&&(await q(),j.success("آسانسور جدید با موفقیت ثبت شد"))}catch(l){console.error("Error creating elevator:",l),j.error("خطا در ثبت آسانسور جدید")}};return u?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"در حال بارگذاری آسانسورها..."})]})}):e.jsxs("div",{className:"p-6 space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"مدیریت آسانسورها"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"مدیریت آسانسورهای تحت مالکیت و مشاهده شناسنامه"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(N,{onClick:de,variant:"outline",disabled:C,className:"flex items-center gap-2",children:[e.jsx(Y,{className:`w-4 h-4 ${C?"animate-spin":""}`}),"بروزرسانی"]}),e.jsxs(N,{onClick:()=>_(!0),className:"flex items-center gap-2 bg-black hover:bg-gray-800 text-white",children:[e.jsx(Ee,{className:"w-4 h-4"}),"ثبت آسانسور جدید"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(m,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(Z,{className:"w-5 h-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"کل آسانسورها"}),e.jsx("p",{className:"text-xl font-bold",children:S.total})]})]})})}),e.jsx(m,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(me,{className:"w-5 h-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"فعال"}),e.jsx("p",{className:"text-xl font-bold text-green-600",children:S.active})]})]})})}),e.jsx(m,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-yellow-100 rounded-lg",children:e.jsx(Oe,{className:"w-5 h-5 text-yellow-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"تعمیرات"}),e.jsx("p",{className:"text-xl font-bold text-yellow-600",children:S.maintenance})]})]})})}),e.jsx(m,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-red-100 rounded-lg",children:e.jsx(he,{className:"w-5 h-5 text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"خراب"}),e.jsx("p",{className:"text-xl font-bold text-red-600",children:S.outOfOrder})]})]})})})]}),e.jsx(m,{children:e.jsx(h,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Te,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(P,{placeholder:"جستجو آسانسور...",value:n,onChange:s=>y(s.target.value),className:"pr-10"})]}),e.jsxs(Q,{value:d,onValueChange:b,children:[e.jsx($,{className:"w-full md:w-48",children:e.jsx(A,{placeholder:"انتخاب وضعیت"})}),e.jsxs(z,{children:[e.jsx(i,{value:"all",children:"همه وضعیت‌ها"}),e.jsx(i,{value:"active",children:"فعال"}),e.jsx(i,{value:"maintenance",children:"تعمیرات"}),e.jsx(i,{value:"out_of_order",children:"خراب"}),e.jsx(i,{value:"installing",children:"در حال نصب"})]})]})]})})}),e.jsxs(m,{children:[e.jsxs(V,{children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-5 h-5"}),"فهرست آسانسورها"]}),e.jsx(je,{children:"مدیریت و مشاهده جزئیات آسانسورهای تحت مالکیت"})]}),e.jsxs(h,{className:"p-0",children:[e.jsxs(fe,{children:[e.jsx(Ne,{children:e.jsxs(se,{children:[e.jsx(p,{children:"شناسه آسانسور"}),e.jsx(p,{children:"نام ساختمان"}),e.jsx(p,{children:"نوع ساختمان"}),e.jsx(p,{children:"موقعیت"}),e.jsx(p,{children:"وضعیت"}),e.jsx(p,{children:"آخرین بازرسی"}),e.jsx(p,{children:"عملیات"})]})}),e.jsx(ve,{children:X.map(s=>e.jsxs(se,{children:[e.jsx(g,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.uid}),e.jsxs("p",{className:"text-sm text-gray-500",children:["طبقات: ",s.floors]})]})}),e.jsx(g,{children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.buildingName}),e.jsx("p",{className:"text-sm text-gray-500",children:s.capacity})]})}),e.jsx(g,{children:e.jsx(ee,{variant:"outline",children:s.buildingType})}),e.jsx(g,{children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ue,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-sm",children:s.city})]})}),e.jsx(g,{children:e.jsx(ee,{className:re[s.status],children:ne[s.status]})}),e.jsx(g,{children:s.lastInspection}),e.jsx(g,{children:e.jsxs(ye,{children:[e.jsx(be,{asChild:!0,children:e.jsx(N,{variant:"ghost",className:"h-8 w-8 p-0",children:e.jsx(De,{className:"h-4 w-4"})})}),e.jsxs(we,{align:"end",className:"w-48",children:[e.jsxs(H,{onClick:()=>{r(s),c(!0)},children:[e.jsx(pe,{className:"w-4 h-4 ml-2"}),"شناسنامه آسانسور"]}),e.jsxs(H,{onClick:()=>ie(s),children:[e.jsx(ge,{className:"w-4 h-4 ml-2"}),"تغییر قطعات"]}),e.jsxs(H,{onClick:()=>{te(s),k(!0)},children:[e.jsx(Y,{className:"w-4 h-4 ml-2"}),"ثبت تعمیرات"]})]})]})})]},s.id))})]}),X.length===0&&e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(Z,{className:"w-12 h-12 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"هیچ آسانسوری یافت نشد"})]})]})]}),x&&e.jsx(E,{open:w,onOpenChange:c,children:e.jsxs(O,{className:"max-w-6xl max-h-[95vh] overflow-hidden",dir:"rtl",children:[e.jsxs(T,{className:"text-right",children:[e.jsxs(M,{children:["شناسنامه آسانسور ",x.uid]}),e.jsx(D,{children:"اطلاعات کامل و مشخصات فنی آسانسور"})]}),e.jsx("div",{className:"modal-scroll-container",children:e.jsx(Pe,{elevator:x})})]})}),J&&e.jsx(E,{open:J,onOpenChange:_,children:e.jsxs(O,{className:"max-w-4xl max-h-[90vh]",dir:"rtl",children:[e.jsxs(T,{className:"text-right",children:[e.jsx(M,{children:"ثبت آسانسور جدید"}),e.jsx(D,{children:"اطلاعات آسانسور جدید را وارد کنید"})]}),e.jsx("div",{className:"modal-scroll-container",children:e.jsx(Ce,{onSubmit:oe,onCancel:()=>_(!1)})})]})}),U&&B&&e.jsx(E,{open:U,onOpenChange:I,children:e.jsxs(O,{className:"max-w-2xl",dir:"rtl",children:[e.jsxs(T,{className:"text-right",children:[e.jsx(M,{children:"تغییر قطعات آسانسور"}),e.jsxs(D,{children:["ثبت تغییرات قطعات آسانسور ",B.uid]})]}),e.jsx(Re,{elevator:B,onClose:()=>I(!1)})]})}),W&&F&&e.jsx(E,{open:W,onOpenChange:k,children:e.jsxs(O,{className:"max-w-2xl",dir:"rtl",children:[e.jsxs(T,{className:"text-right",children:[e.jsx(M,{children:"ثبت تعمیرات آسانسور"}),e.jsxs(D,{children:["ثبت اطلاعات تعمیرات آسانسور ",F.uid]})]}),e.jsx(Ie,{elevator:F,onClose:()=>k(!1)})]})})]})}function Pe({elevator:t}){return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"text-center border-b-2 border-primary pb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-primary mb-2",children:"شناسنامه آسانسور"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"سامانه ردیابی قطعات و شناسنامه آسانسور"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["شناسه: ",t.uid]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(m,{children:[e.jsx(V,{children:e.jsx(L,{children:"اطلاعات ساختمان"})}),e.jsxs(h,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"نام ساختمان:"}),e.jsx("span",{className:"font-medium",children:t.buildingName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"نوع ساختمان:"}),e.jsx("span",{className:"font-medium",children:t.buildingType})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"تعداد طبقات:"}),e.jsx("span",{className:"font-medium",children:t.floors})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"ظرفیت:"}),e.jsx("span",{className:"font-medium",children:t.capacity})]})]})]}),e.jsxs(m,{children:[e.jsx(V,{children:e.jsx(L,{children:"اطلاعات فنی"})}),e.jsxs(h,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"نوع موتور:"}),e.jsx("span",{className:"font-medium",children:t.motorType})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"تاریخ نصب:"}),e.jsx("span",{className:"font-medium",children:t.installationDate})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"آخرین بازرسی:"}),e.jsx("span",{className:"font-medium",children:t.lastInspection})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"بازرسی بعدی:"}),e.jsx("span",{className:"font-medium",children:t.nextInspection})]})]})]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(Se,{value:`https://elevatorid.ieeu.ir/elevator/${t.uid}`,size:150}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"کد QR آسانسور"})]})]})}function Re({elevator:t,onClose:o}){const[u,v]=a.useState(""),[n,y]=a.useState(""),[d,b]=a.useState(""),x=async r=>{r.preventDefault();try{await R.post(`/user/elevators/${t.id}/change-part`,{partId:u,newPartSerial:n,reason:d}),j.success("تغییر قطعه با موفقیت ثبت شد"),o()}catch(w){console.error("Error changing part:",w),j.error("خطا در ثبت تغییر قطعه")}};return e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"انتخاب قطعه"}),e.jsxs(Q,{value:u,onValueChange:v,children:[e.jsx($,{children:e.jsx(A,{placeholder:"قطعه را انتخاب کنید"})}),e.jsx(z,{children:t.parts.map(r=>e.jsxs(i,{value:r.id,children:[r.name," - ",r.serialNumber]},r.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"شماره سریال قطعه جدید"}),e.jsx(P,{value:n,onChange:r=>y(r.target.value),placeholder:"شماره سریال جدید",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"دلیل تغییر"}),e.jsx(ae,{value:d,onChange:r=>b(r.target.value),placeholder:"دلیل تغییر قطعه را بنویسید...",required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(N,{type:"button",variant:"outline",onClick:o,children:"انصراف"}),e.jsx(N,{type:"submit",children:"ثبت تغییر"})]})]})}function Ie({elevator:t,onClose:o}){const[u,v]=a.useState(""),[n,y]=a.useState(""),[d,b]=a.useState(""),[x,r]=a.useState(""),w=async c=>{c.preventDefault();try{await R.post(`/user/elevators/${t.id}/maintenance`,{type:u,description:n,cost:parseFloat(d),performedBy:x}),j.success("تعمیرات با موفقیت ثبت شد"),o()}catch(C){console.error("Error recording maintenance:",C),j.error("خطا در ثبت تعمیرات")}};return e.jsxs("form",{onSubmit:w,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"نوع تعمیرات"}),e.jsxs(Q,{value:u,onValueChange:v,children:[e.jsx($,{children:e.jsx(A,{placeholder:"نوع تعمیرات را انتخاب کنید"})}),e.jsxs(z,{children:[e.jsx(i,{value:"preventive",children:"تعمیرات پیشگیرانه"}),e.jsx(i,{value:"corrective",children:"تعمیرات اصلاحی"}),e.jsx(i,{value:"emergency",children:"تعمیرات اضطراری"}),e.jsx(i,{value:"inspection",children:"بازرسی"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"شرح تعمیرات"}),e.jsx(ae,{value:n,onChange:c=>y(c.target.value),placeholder:"شرح کامل تعمیرات انجام شده...",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"هزینه (ریال)"}),e.jsx(P,{type:"number",value:d,onChange:c=>b(c.target.value),placeholder:"هزینه تعمیرات"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(f,{children:"انجام‌دهنده"}),e.jsx(P,{value:x,onChange:c=>r(c.target.value),placeholder:"نام انجام‌دهنده تعمیرات",required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(N,{type:"button",variant:"outline",onClick:o,children:"انصراف"}),e.jsx(N,{type:"submit",children:"ثبت تعمیرات"})]})]})}export{is as default};
