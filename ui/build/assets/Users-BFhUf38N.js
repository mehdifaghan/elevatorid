import{a1 as oe,r as d,t as a,j as e,B as v,q as te,V as re,C,e as S,T as Ue,p as Q,b as qe,c as _e,y as ae,d as Fe,o as L,Q as Re,H as Le,L as c}from"./index-tH8kGzNV.js";import{T as le,a as ie,b as R,c as g,d as ne,e as f}from"./table-DC3MYrD8.js";import{D as V,a as $e,b as G,c as B,d as z,e as W}from"./dialog-DAjwwShP.js";import{D as Oe,a as Pe,b as He,c as D,d as ce}from"./dropdown-menu-BKfQT_JD.js";import{S as de,a as me,b as xe,c as he,d as E}from"./select-B8NiX_r6.js";import{S as N}from"./skeleton-vzO12S3j.js";import{A as Ve,a as Ge,b as Be,c as ze,d as We,e as Qe,f as Je,g as Ke}from"./alert-dialog-DO3MSb5m.js";import{r as k}from"./real-api-client-o-2gE2Hp.js";import{P as Xe}from"./plus-A2-5MgKF.js";import{T as Ye}from"./trending-down-HaRH2stY.js";import{S as Ze}from"./search-8LTSveb2.js";import{D as es}from"./download-BGqk_jGh.js";import{E as ss}from"./ellipsis-J_HkHiqq.js";import{M as ts}from"./message-square-Gum9_klA.js";import{T as rs}from"./trash-2-BwVZTJjK.js";import"./index-DGGMjIYi.js";import"./Combination-Dzecd94B.js";import"./x-B6dSK8zO.js";import"./chevron-right-B97jr1RJ.js";import"./check-DV_4N94Y.js";import"./index-BdQq_4o_.js";import"./index-BuiImgyP.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],ls=oe("user-check",as);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],ns=oe("user-minus",is),pe={active:"bg-green-100 text-green-800",suspended:"bg-red-100 text-red-800",pending:"bg-yellow-100 text-yellow-800"},je=i=>({active:"فعال",suspended:"معلق",pending:"در انتظار تایید"})[i]||i,ue=i=>({producer:"تولیدکننده",importer:"وارد کننده",installer:"نصابی",seller:"فروشنده",coop_org:"سازمان همکار"})[i]||i,ge=i=>i?i.startsWith("98")?i.replace(/^98/,"+98 "):i.startsWith("09")?i.replace(/^(\d{4})(\d{3})(\d{4})$/,"$1 $2 $3"):i:"";function Us(){const[i,h]=d.useState([]),[m,x]=d.useState({total:0,active:0,pending:0,suspended:0,thisMonth:0,lastMonth:0,monthlyGrowth:0}),[u,A]=d.useState(""),[y,p]=d.useState("all"),[o,$]=d.useState(null),[O,n]=d.useState(!1),[b,w]=d.useState(!1),[P,M]=d.useState(!1),[I,H]=d.useState(null),[U,q]=d.useState(null),[J,K]=d.useState(!0),[fe,X]=d.useState(!0),[Y,Z]=d.useState(!1),[_,ee]=d.useState(!1);d.useEffect(()=>{F(),T()},[]),d.useEffect(()=>{const t=setTimeout(()=>{F()},500);return()=>clearTimeout(t)},[u,y]);const T=async()=>{try{X(!0);const t=await k.get("/admin/users/stats"),s=t.stats||t,r={total:s.total||0,active:s.active||0,pending:s.pending||0,suspended:s.suspended||0,thisMonth:s.this_month||s.thisMonth||0,lastMonth:s.last_month||s.lastMonth||0,monthlyGrowth:s.monthly_growth||s.monthlyGrowth||0};x(r)}catch(t){if(console.error("Error fetching user stats:",t),t&&typeof t=="object"&&"isNetworkError"in t){const s=t;s.isNetworkError?a.error("عدم دسترسی به سرور برای دریافت آمار کاربران"):s.isAuthError?a.error("خطای احراز هویت در دریافت آمار"):a.error("خطا در بارگذاری آمار کاربران")}else a.error("خطا در بارگذاری آمار کاربران");x({total:0,active:0,pending:0,suspended:0,thisMonth:0,lastMonth:0,monthlyGrowth:0})}finally{X(!1)}},F=async()=>{try{K(!0);const t={};u&&(t.q=u),y!=="all"&&(t.status=y);const s=await k.get("/admin/users",t),r=s.users||s.data||s||[],l=Array.isArray(r)?r.map(j=>({id:j.id||j._id,companyName:j.company_name||j.companyName||j.company?.name||"شرکت نامشخص",phone:j.phone||j.mobile||"",email:j.email,status:j.status||"pending",profileTypes:j.profile_types||j.profileTypes||j.profiles?.map(Ie=>Ie.profileType)||[],createdAt:j.created_at||j.createdAt||new Date().toLocaleDateString("fa-IR"),lastActive:j.last_active||j.lastActive})):[];h(l)}catch(t){if(console.error("Error fetching users:",t),h([]),t&&typeof t=="object"&&"isNetworkError"in t){const s=t;s.isNetworkError?a.error("عدم دسترسی به سرور برای دریافت کاربران"):s.isAuthError?a.error("خطای احراز هویت در دریافت کاربران"):a.error("خطا در بارگذاری کاربران")}else a.error("خطا در بارگذاری کاربران")}finally{K(!1)}},ye=async t=>{try{Z(!0);const s=await k.get(`/admin/users/${t}`),r={id:s.id||s._id,companyName:s.company_name||s.companyName||s.company?.name||"شرکت نامشخص",phone:s.phone||s.mobile||"",email:s.email,status:s.status||"pending",profileTypes:s.profile_types||s.profileTypes||s.profiles?.map(l=>l.profileType)||[],createdAt:s.created_at||s.createdAt,lastActive:s.last_active||s.lastActive,company:s.company?{name:s.company.name,tradeId:s.company.trade_id||s.company.tradeId,province:s.company.province,city:s.company.city,address:s.company.address}:void 0,profiles:s.profiles?.map(l=>({id:l.id,profileType:l.profile_type||l.profileType,isActive:l.is_active!==void 0?l.is_active:l.isActive}))||[]};$(r),w(!0)}catch(s){if(console.error("Error fetching user details:",s),s&&typeof s=="object"&&"isNetworkError"in s){const r=s;r.isNetworkError?a.error("عدم دسترسی به سرور برای دریافت جزئیات کاربر"):r.isAuthError?a.error("خطای احراز هویت"):a.error("خطا در بارگذاری جزئیات کاربر")}else a.error("خطا در بارگذاری جزئیات کاربر")}finally{Z(!1)}},Ne=async(t,s)=>{try{await k.post(`/admin/users/${t}/sms`,{body:s}),a.success("پیامک با موفقیت ارسال شد")}catch(r){if(console.error("Error sending SMS:",r),r&&typeof r=="object"&&"isNetworkError"in r){const l=r;l.isNetworkError?a.error("عدم دسترسی به سرور برای ارسال پیامک"):l.isAuthError?a.error("خطای احراز هویت"):a.error("خطا در ارسال پیامک")}else a.error("خطا در ارسال پیامک")}},ve=async(t,s)=>{try{await k.put(`/admin/users/${t}`,{status:s}),h(r=>r.map(l=>l.id===t?{...l,status:s}:l)),a.success("وضعیت کاربر بروزرسانی شد"),T()}catch(r){if(console.error("Error updating user status:",r),r&&typeof r=="object"&&"isNetworkError"in r){const l=r;l.isNetworkError?a.error("عدم دسترسی به سرور برای بروزرسانی وضعیت"):l.isAuthError?a.error("خطای احراز هویت"):a.error("خطا در بروزرسانی وضعیت کاربر")}else a.error("خطا در بروزرسانی وضعیت کاربر")}},be=async t=>{try{await k.delete(`/admin/users/${t.id}`),h(s=>s.filter(r=>r.id!==t.id)),q(null),a.success(`کاربر ${t.companyName} حذف شد`),T()}catch(s){if(console.error("Error deleting user:",s),s&&typeof s=="object"&&"isNetworkError"in s){const r=s;r.isNetworkError?a.error("عدم دسترسی به سرور برای حذف کاربر"):r.isAuthError?a.error("خطای احراز هویت"):a.error("خطا در حذف کاربر")}else a.error("خطا در حذف کاربر")}},we=async()=>{try{const t=await k.get("/admin/users/export",{},{responseType:"blob"}),s=new Blob([t],{type:"text/csv"}),r=window.URL.createObjectURL(s),l=document.createElement("a");l.href=r,l.download=`users-${new Date().toISOString().split("T")[0]}.csv`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(r),a.success("لیست کاربران صادر شد")}catch(t){console.error("Error exporting users:",t),a.error("خطا در صادرات لیست کاربران")}},ke=async t=>{try{await k.post("/admin/coworkers",t),a.success("کاربر همکار با موفقیت ایجاد شد"),n(!1),F(),T()}catch(s){if(console.error("Error creating coworker:",s),s&&typeof s=="object"&&"isNetworkError"in s){const r=s;r.isNetworkError?a.error("عدم دسترسی به سرور برای ایجاد کاربر"):r.isAuthError?a.error("خطای احراز هویت"):a.error("خطا در ایجاد کاربر همکار")}else a.error("خطا در ایجاد کاربر همکار")}},Ae=async(t,s)=>{try{await k.put(`/admin/users/${t}`,s),h(r=>r.map(l=>l.id===t?{...l,status:s.status||l.status,profileTypes:s.profileTypes||l.profileTypes}:l)),a.success("سطح دسترسی با موفقیت بروزرسانی شد"),M(!1),H(null)}catch(r){if(console.error("Error updating user access:",r),r&&typeof r=="object"&&"isNetworkError"in r){const l=r;l.isNetworkError?a.error("عدم دسترسی به سرور برای بروزرسانی سطح دسترسی"):l.isAuthError?a.error("خطای احراز هویت"):a.error("خطا در بروزرسانی سطح دسترسی")}else a.error("خطا در بروزرسانی سطح دسترسی")}},se=async()=>{ee(!0);try{await Promise.all([F(),T()]),a.success("داده‌ها با موفقیت به‌روزرسانی شد")}catch{a.error("خطا در به‌روزرسانی داده‌ها")}finally{ee(!1)}},Ce=async t=>{const s=prompt("متن پیامک را وارد کنید:");s&&await Ne(t.id,s)},Se=async t=>{await ve(t.id,"suspended")},Ee=t=>{q(t)},Te=()=>e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[...Array(5)].map((t,s)=>e.jsx(C,{className:"border-l-4 border-l-gray-300",children:e.jsx(S,{className:"p-3",children:e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx(N,{className:"h-6 w-12 mx-auto"}),e.jsx(N,{className:"h-3 w-16 mx-auto"})]})})},s))}),De=t=>{ye(t)},Me=t=>{H(t),M(!0)};return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"مدیریت کاربران"}),e.jsx("p",{className:"text-muted-foreground",children:"لیست کاربران و شرکت‌های ثبت‌شده"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{variant:"outline",onClick:se,disabled:_,children:[_?e.jsx(te,{className:"w-4 h-4 ml-2 animate-spin"}):e.jsx(re,{className:"w-4 h-4 ml-2"}),"به‌روزرسانی"]}),e.jsxs(V,{open:O,onOpenChange:n,children:[e.jsx($e,{asChild:!0,children:e.jsxs(v,{children:[e.jsx(Xe,{className:"w-4 h-4 ml-2"}),"ایجاد کاربر همکار"]})}),e.jsxs(G,{style:{direction:"rtl",textAlign:"right"},children:[e.jsxs(B,{style:{textAlign:"right"},children:[e.jsx(z,{style:{textAlign:"right"},children:"ایجاد کاربر همکار جدید"}),e.jsx(W,{style:{textAlign:"right"},children:"اطلاعات کاربر همکار جدید را وارد کنید"})]}),e.jsx(cs,{onClose:()=>n(!1),onCreate:ke})]})]})]})]}),fe?e.jsx(Te,{}):e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[e.jsx(C,{className:"border-l-4 border-l-blue-500",children:e.jsx(S,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-blue-600",children:m.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"کل کاربران"})]})})}),e.jsx(C,{className:"border-l-4 border-l-green-500",children:e.jsx(S,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-green-600",children:m.active}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"فعال"})]})})}),e.jsx(C,{className:"border-l-4 border-l-yellow-500",children:e.jsx(S,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-yellow-600",children:m.pending}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"در انتظار"})]})})}),e.jsx(C,{className:"border-l-4 border-l-red-500",children:e.jsx(S,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-red-600",children:m.suspended}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"تعلیق شده"})]})})}),e.jsx(C,{className:"border-l-4 border-l-indigo-500",children:e.jsx(S,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("p",{className:"text-lg font-bold text-indigo-600",children:m.thisMonth}),m.monthlyGrowth>0?e.jsx(Ue,{className:"w-3 h-3 text-green-500"}):m.monthlyGrowth<0?e.jsx(Ye,{className:"w-3 h-3 text-red-500"}):null]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"این ماه"})]})})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ze,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(Q,{placeholder:"جستجو بر اساس نام شرکت یا موبایل...",value:u,onChange:t=>A(t.target.value),className:"pr-10"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(de,{value:y,onValueChange:p,children:[e.jsx(me,{className:"w-48",children:e.jsx(xe,{placeholder:"فیلتر وضعیت"})}),e.jsxs(he,{children:[e.jsx(E,{value:"all",children:"همه وضعیت‌ها"}),e.jsx(E,{value:"active",children:"فعال"}),e.jsx(E,{value:"pending",children:"در انتظار"}),e.jsx(E,{value:"suspended",children:"تعلیق شده"})]})]}),e.jsxs(v,{variant:"outline",size:"sm",onClick:we,children:[e.jsx(es,{className:"w-4 h-4 ml-2"}),"خروجی CSV"]})]})]}),e.jsxs(C,{children:[e.jsxs(qe,{children:[e.jsxs(_e,{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-5 h-5"}),"لیست کاربران"]}),e.jsx(Fe,{children:J?e.jsx("span",{children:"در حال بارگذاری..."}):i.length>0?e.jsxs(e.Fragment,{children:["مجموعاً ",i.length," کاربر یافت شد"]}):e.jsx(e.Fragment,{children:"هیچ کاربری یافت نشد"})})]}),e.jsx(S,{children:J?e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(le,{children:[e.jsx(ie,{children:e.jsxs(R,{children:[e.jsx(g,{className:"text-right w-12",children:"#"}),e.jsx(g,{className:"text-right",children:"شرکت"}),e.jsx(g,{className:"text-right",children:"تماس"}),e.jsx(g,{className:"text-right",children:"وضعیت"}),e.jsx(g,{className:"text-right",children:"نوع پروفایل"}),e.jsx(g,{className:"text-right w-32",children:"عملیات"})]})}),e.jsx(ne,{children:[...Array(5)].map((t,s)=>e.jsxs(R,{children:[e.jsx(f,{children:e.jsx(N,{className:"h-4 w-6"})}),e.jsx(f,{children:e.jsx(N,{className:"h-4 w-32"})}),e.jsx(f,{children:e.jsx(N,{className:"h-4 w-24"})}),e.jsx(f,{children:e.jsx(N,{className:"h-4 w-16"})}),e.jsx(f,{children:e.jsx(N,{className:"h-4 w-20"})}),e.jsx(f,{children:e.jsx(N,{className:"h-4 w-16"})})]},s))})]})})}):i.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-100 flex items-center justify-center",children:e.jsx(ae,{className:"w-8 h-8 text-gray-400"})}),e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h3",{className:"text-lg font-medium text-muted-foreground",children:"کاربری یافت نشد"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-md",children:u||y!=="all"?"هیچ کاربری با این فیلترها موجود نیست. لطفاً جستجوی خود را تغییر دهید.":"هنوز کاربری ثبت نشده است. پس از ثبت کاربران جدید، آنها در اینجا نمایش داده خواهند شد."})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(v,{onClick:se,variant:"outline",disabled:_,children:[_?e.jsx(te,{className:"w-4 h-4 ml-2 animate-spin"}):e.jsx(re,{className:"w-4 h-4 ml-2"}),"تلاش مجدد"]}),(u||y!=="all")&&e.jsx(v,{onClick:()=>{A(""),p("all")},variant:"ghost",children:"پاک کردن فیلترها"})]})]}):e.jsx("div",{className:"space-y-4",children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(le,{children:[e.jsx(ie,{children:e.jsxs(R,{children:[e.jsx(g,{className:"text-right w-12",children:"#"}),e.jsx(g,{className:"text-right",children:"شرکت"}),e.jsx(g,{className:"text-right",children:"تماس"}),e.jsx(g,{className:"text-right",children:"وضعیت"}),e.jsx(g,{className:"text-right",children:"نوع پروفایل"}),e.jsx(g,{className:"text-right w-32",children:"عملیات"})]})}),e.jsx(ne,{children:i.map((t,s)=>e.jsxs(R,{className:"hover:bg-muted/50",children:[e.jsx(f,{className:"text-right font-medium",children:s+1}),e.jsx(f,{className:"text-right",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.companyName}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["کد شرکت: CMP-",t.id.toString().padStart(6,"0")]})]})}),e.jsx(f,{className:"text-right",children:e.jsxs("div",{children:[e.jsx("div",{children:ge(t.phone)}),t.email&&e.jsx("div",{className:"text-sm text-muted-foreground",children:t.email})]})}),e.jsx(f,{className:"text-right",children:e.jsx(L,{variant:"secondary",className:pe[t.status],children:je(t.status)})}),e.jsx(f,{className:"text-right",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:t.profileTypes&&t.profileTypes.length>0?t.profileTypes.map((r,l)=>e.jsx(L,{variant:"outline",className:"text-xs",children:ue(r)},l)):e.jsx("span",{className:"text-sm text-muted-foreground",children:"بدون پروفایل"})})}),e.jsx(f,{className:"text-right",children:e.jsxs(Oe,{children:[e.jsx(Pe,{asChild:!0,children:e.jsx(v,{variant:"ghost",size:"sm",children:e.jsx(ss,{className:"w-4 h-4"})})}),e.jsxs(He,{align:"end",style:{direction:"rtl"},children:[e.jsxs(D,{onClick:()=>De(t.id),disabled:Y,style:{textAlign:"right",justifyContent:"flex-end"},children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"نمایش کامل"]}),e.jsx(ce,{}),e.jsxs(D,{onClick:()=>Ce(t),style:{textAlign:"right",justifyContent:"flex-end"},children:[e.jsx(ts,{className:"w-4 h-4 mr-2"}),"ارسال پیامک"]}),e.jsxs(D,{onClick:()=>Me(t),style:{textAlign:"right",justifyContent:"flex-end"},children:[e.jsx(Le,{className:"w-4 h-4 mr-2"}),"ویرایش سطح دسترسی"]}),e.jsx(ce,{}),e.jsx(D,{onClick:()=>Se(t),style:{textAlign:"right",justifyContent:"flex-end"},children:t.status==="suspended"?e.jsxs(e.Fragment,{children:[e.jsx(ls,{className:"w-4 h-4 mr-2"}),"فعال‌سازی"]}):e.jsxs(e.Fragment,{children:[e.jsx(ns,{className:"w-4 h-4 mr-2"}),"تعلیق"]})}),e.jsxs(D,{onClick:()=>Ee(t),className:"text-destructive focus:text-destructive",style:{textAlign:"right",justifyContent:"flex-end"},children:[e.jsx(rs,{className:"w-4 h-4 mr-2"}),"حذف"]})]})]})})]},t.id))})]})})})})]}),e.jsx(V,{open:b,onOpenChange:w,children:e.jsxs(G,{className:"max-w-2xl",style:{direction:"rtl",textAlign:"right"},children:[e.jsxs(B,{style:{textAlign:"right"},children:[e.jsx(z,{style:{textAlign:"right"},children:"جزئیات کاربر"}),e.jsx(W,{style:{textAlign:"right"},children:"مشاهده اطلاعات کامل کاربر انتخاب شده"})]}),Y?e.jsx("div",{className:"space-y-4",children:[...Array(3)].map((t,s)=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{className:"h-4 w-24"}),e.jsx(N,{className:"h-6 w-full"})]},s))}):o?e.jsx(ds,{user:o}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"اطلاعات کاربر یافت نشد"})})]})}),e.jsx(V,{open:P,onOpenChange:M,children:e.jsxs(G,{className:"max-w-md",style:{direction:"rtl",textAlign:"right"},children:[e.jsxs(B,{style:{textAlign:"right"},children:[e.jsx(z,{style:{textAlign:"right"},children:"ویرایش سطح دسترسی"}),e.jsxs(W,{style:{textAlign:"right"},children:["سطح دسترسی ",I?.companyName," را ویرایش کنید"]})]}),I&&e.jsx(os,{user:I,onClose:()=>{M(!1),H(null)},onUpdate:t=>{Ae(I.id,t)}})]})}),U&&e.jsx(Ve,{open:!!U,onOpenChange:()=>q(null),children:e.jsxs(Ge,{style:{direction:"rtl",textAlign:"right"},children:[e.jsxs(Be,{style:{textAlign:"right"},children:[e.jsx(ze,{style:{textAlign:"right"},children:"تأیید حذف کاربر"}),e.jsxs(We,{style:{textAlign:"right"},children:['آیا از حذف کاربر "',U.companyName,'" اطمینان دارید؟ این عمل قابل بازگشت نیست و تمام اطلاعات مرتبط با این کاربر حذف خواهد شد.']})]}),e.jsxs(Qe,{className:"flex-row-reverse",children:[e.jsx(Je,{onClick:()=>q(null),children:"انصراف"}),e.jsx(Ke,{onClick:()=>be(U),className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:"حذف"})]})]})})]})}function cs({onClose:i,onCreate:h}){const[m,x]=d.useState({orgName:"",phone:"",access:{mgmtReports:!1,partsInquiry:!1,elevatorsInquiry:!1}}),[u,A]=d.useState(!1),y=async p=>{if(p.preventDefault(),!m.orgName.trim()){a.error("نام سازمان الزامی است");return}if(!m.phone.trim()){a.error("شماره موبایل الزامی است");return}if(!/^09\d{9}$/.test(m.phone)){a.error("شماره موبایل باید با 09 شروع شده و 11 رقم باشد");return}A(!0);try{await h(m)}finally{A(!1)}};return e.jsxs("form",{onSubmit:y,className:"space-y-4",dir:"rtl",children:[e.jsxs("div",{className:"space-y-2 text-right",children:[e.jsx(c,{htmlFor:"orgName",children:"نام سازمان"}),e.jsx(Q,{id:"orgName",value:m.orgName,onChange:p=>x(o=>({...o,orgName:p.target.value})),required:!0})]}),e.jsxs("div",{className:"space-y-2 text-right",children:[e.jsx(c,{htmlFor:"phone",children:"شماره موبایل"}),e.jsx(Q,{id:"phone",type:"tel",value:m.phone,onChange:p=>x(o=>({...o,phone:p.target.value})),placeholder:"09123456789",required:!0,className:"text-left",dir:"ltr"})]}),e.jsxs("div",{className:"space-y-3 text-right",children:[e.jsx(c,{children:"سطح دسترسی"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"mgmtReports",checked:m.access.mgmtReports,onChange:p=>x(o=>({...o,access:{...o.access,mgmtReports:p.target.checked}})),className:"rounded border-input"}),e.jsx(c,{htmlFor:"mgmtReports",className:"text-sm font-normal",children:"دسترسی به گزارش‌های مدیریتی"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"partsInquiry",checked:m.access.partsInquiry,onChange:p=>x(o=>({...o,access:{...o.access,partsInquiry:p.target.checked}})),className:"rounded border-input"}),e.jsx(c,{htmlFor:"partsInquiry",className:"text-sm font-normal",children:"استعلام قطعات"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"elevatorsInquiry",checked:m.access.elevatorsInquiry,onChange:p=>x(o=>({...o,access:{...o.access,elevatorsInquiry:p.target.checked}})),className:"rounded border-input"}),e.jsx(c,{htmlFor:"elevatorsInquiry",className:"text-sm font-normal",children:"استعلام آسانسورها"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(v,{type:"button",variant:"outline",onClick:i,children:"انصراف"}),e.jsx(v,{type:"submit",disabled:u,children:u?"در حال ایجاد...":"ایجاد کاربر"})]})]})}function os({user:i,onClose:h,onUpdate:m}){const[x,u]=d.useState({profileTypes:i.profileTypes||[],status:i.status,permissions:{mgmtReports:!1,partsInquiry:!0,elevatorsInquiry:!0,transferApproval:!1,userManagement:!1}}),[A,y]=d.useState(!1),p=(n,b)=>{u(w=>({...w,profileTypes:b?[...w.profileTypes,n]:w.profileTypes.filter(P=>P!==n)}))},o=(n,b)=>{u(w=>({...w,permissions:{...w.permissions,[n]:b}}))},$=async n=>{n.preventDefault(),y(!0);try{await m({profileTypes:x.profileTypes,status:x.status,permissions:x.permissions})}finally{y(!1)}},O=[{value:"producer",label:"تولیدکننده"},{value:"importer",label:"وارد کننده"},{value:"installer",label:"نصابی"},{value:"seller",label:"فروشنده"},{value:"coop_org",label:"سازمان همکار"}];return e.jsxs("form",{onSubmit:$,className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"space-y-4 text-right",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{children:"وضعیت کاربر"}),e.jsxs(de,{value:x.status,onValueChange:n=>u(b=>({...b,status:n})),children:[e.jsx(me,{children:e.jsx(xe,{})}),e.jsxs(he,{children:[e.jsx(E,{value:"active",children:"فعال"}),e.jsx(E,{value:"pending",children:"در انتظار"}),e.jsx(E,{value:"suspended",children:"معلق"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{children:"نوع پروفایل"}),e.jsx("div",{className:"space-y-2",children:O.map(n=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:`profile-${n.value}`,checked:x.profileTypes.includes(n.value),onChange:b=>p(n.value,b.target.checked),className:"rounded border-input"}),e.jsx(c,{htmlFor:`profile-${n.value}`,className:"text-sm font-normal",children:n.label})]},n.value))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{children:"مجوزهای سیستم"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"mgmtReports",checked:x.permissions.mgmtReports,onChange:n=>o("mgmtReports",n.target.checked),className:"rounded border-input"}),e.jsx(c,{htmlFor:"mgmtReports",className:"text-sm font-normal",children:"دسترسی به گزارش‌های مدیریتی"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"partsInquiry",checked:x.permissions.partsInquiry,onChange:n=>o("partsInquiry",n.target.checked),className:"rounded border-input"}),e.jsx(c,{htmlFor:"partsInquiry",className:"text-sm font-normal",children:"استعلام قطعات"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"elevatorsInquiry",checked:x.permissions.elevatorsInquiry,onChange:n=>o("elevatorsInquiry",n.target.checked),className:"rounded border-input"}),e.jsx(c,{htmlFor:"elevatorsInquiry",className:"text-sm font-normal",children:"استعلام آسانسورها"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"transferApproval",checked:x.permissions.transferApproval,onChange:n=>o("transferApproval",n.target.checked),className:"rounded border-input"}),e.jsx(c,{htmlFor:"transferApproval",className:"text-sm font-normal",children:"تایید انتقال قطعات"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"userManagement",checked:x.permissions.userManagement,onChange:n=>o("userManagement",n.target.checked),className:"rounded border-input"}),e.jsx(c,{htmlFor:"userManagement",className:"text-sm font-normal",children:"مدیریت کاربران"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx(v,{type:"button",variant:"outline",onClick:h,children:"انصراف"}),e.jsx(v,{type:"submit",disabled:A,children:A?"در حال بروزرسانی...":"بروزرسانی"})]})]})}function ds({user:i}){return e.jsxs("div",{className:"space-y-4",dir:"rtl",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"شماره موبایل"}),e.jsx("p",{children:ge(i.phone)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"وضعیت"}),e.jsx("p",{children:e.jsx(L,{className:pe[i.status],children:je(i.status)})})]})]}),i.company&&e.jsxs("div",{className:"space-y-3 text-right",children:[e.jsx("h4",{className:"font-medium",children:"اطلاعات شرکت"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"نام شرکت"}),e.jsx("p",{children:i.company.name})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"کد شرکت"}),e.jsxs("p",{children:["CMP-",i.id.toString().padStart(6,"0")]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"شناسه تجاری"}),e.jsx("p",{children:i.company.tradeId||"-"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"استان"}),e.jsx("p",{children:i.company.province||"-"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"شهر"}),e.jsx("p",{children:i.company.city||"-"})]}),e.jsxs("div",{className:"col-span-2 text-right",children:[e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"آدرس"}),e.jsx("p",{children:i.company.address||"-"})]})]})]}),i.profiles&&i.profiles.length>0&&e.jsxs("div",{className:"space-y-3 text-right",children:[e.jsx("h4",{className:"font-medium",children:"پروفایل‌ها"}),e.jsx("div",{className:"space-y-2",children:i.profiles.map(h=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded",children:[e.jsx("span",{children:ue(h.profileType)}),e.jsx(L,{variant:h.isActive?"default":"secondary",children:h.isActive?"فعال":"غیرفعال"})]},h.id))})]})]})}export{Us as default};
