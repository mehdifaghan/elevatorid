import{r as l,a8 as q,a3 as M,aw as _,j as a,a2 as ee,L as xe,x as be,B as le,o as ae,M as se}from"./index-tH8kGzNV.js";import{P as ye,a as we,b as je}from"./popover-B3pW-y7H.js";import{R as Ve,P as Be,O as qe,C as Ge}from"./index-DGGMjIYi.js";import"./dialog-DAjwwShP.js";import{S as ue}from"./search-8LTSveb2.js";import{c as Z}from"./utils-BvTIn9cQ.js";import{i as Ce,s as Te}from"./iran-provinces-cities-ClUeFN4S.js";var ke=1,Ue=.9,He=.8,We=.17,ie=.1,ce=.999,_e=.9999,Je=.99,Xe=/[\\\/_+.#"@\[\(\{&]/,Ye=/[\\\/_+.#"@\[\(\{&]/g,Qe=/[\s-]/,Me=/[\s-]/g;function de(e,n,r,m,s,o,d){if(o===n.length)return s===e.length?ke:Je;var v=`${s},${o}`;if(d[v]!==void 0)return d[v];for(var f=m.charAt(o),c=r.indexOf(f,s),p=0,g,C,j,E;c>=0;)g=de(e,n,r,m,c+1,o+1,d),g>p&&(c===s?g*=ke:Xe.test(e.charAt(c-1))?(g*=He,j=e.slice(s,c-1).match(Ye),j&&s>0&&(g*=Math.pow(ce,j.length))):Qe.test(e.charAt(c-1))?(g*=Ue,E=e.slice(s,c-1).match(Me),E&&s>0&&(g*=Math.pow(ce,E.length))):(g*=We,s>0&&(g*=Math.pow(ce,c-s))),e.charAt(c)!==n.charAt(o)&&(g*=_e)),(g<ie&&r.charAt(c-1)===m.charAt(o+1)||m.charAt(o+1)===m.charAt(o)&&r.charAt(c-1)!==m.charAt(o))&&(C=de(e,n,r,m,c+1,o+2,d),C*ie>g&&(g=C*ie)),g>p&&(p=g),c=r.indexOf(f,c+1);return d[v]=p,p}function Ne(e){return e.toLowerCase().replace(Me," ")}function Ze(e,n,r){return e=r&&r.length>0?`${e+" "+r.join(" ")}`:e,de(e,n,Ne(e),Ne(n),0,0,{})}var W='[cmdk-group=""]',oe='[cmdk-group-items=""]',et='[cmdk-group-heading=""]',$e='[cmdk-item=""]',Se=`${$e}:not([aria-disabled="true"])`,me="cmdk-item-select",V="data-value",tt=(e,n,r)=>Ze(e,n,r),De=l.createContext(void 0),J=()=>l.useContext(De),Oe=l.createContext(void 0),fe=()=>l.useContext(Oe),Le=l.createContext(void 0),ze=l.forwardRef((e,n)=>{let r=B(()=>{var t,u;return{search:"",value:(u=(t=e.value)!=null?t:e.defaultValue)!=null?u:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),m=B(()=>new Set),s=B(()=>new Map),o=B(()=>new Map),d=B(()=>new Set),v=Fe(e),{label:f,children:c,value:p,onValueChange:g,filter:C,shouldFilter:j,loop:E,disablePointerSelection:z=!1,vimBindings:I=!0,...$}=e,F=q(),G=q(),T=q(),R=l.useRef(null),w=mt();L(()=>{if(p!==void 0){let t=p.trim();r.current.value=t,k.emit()}},[p]),L(()=>{w(6,O)},[]);let k=l.useMemo(()=>({subscribe:t=>(d.current.add(t),()=>d.current.delete(t)),snapshot:()=>r.current,setState:(t,u,h)=>{var i,b,y,S;if(!Object.is(r.current[t],u)){if(r.current[t]=u,t==="search")x(),U(),w(1,K);else if(t==="value"){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let N=document.getElementById(T);N?N.focus():(i=document.getElementById(F))==null||i.focus()}if(w(7,()=>{var N;r.current.selectedItemId=(N=P())==null?void 0:N.id,k.emit()}),h||w(5,O),((b=v.current)==null?void 0:b.value)!==void 0){let N=u??"";(S=(y=v.current).onValueChange)==null||S.call(y,N);return}}k.emit()}},emit:()=>{d.current.forEach(t=>t())}}),[]),D=l.useMemo(()=>({value:(t,u,h)=>{var i;u!==((i=o.current.get(t))==null?void 0:i.value)&&(o.current.set(t,{value:u,keywords:h}),r.current.filtered.items.set(t,Y(u,h)),w(2,()=>{U(),k.emit()}))},item:(t,u)=>(m.current.add(t),u&&(s.current.has(u)?s.current.get(u).add(t):s.current.set(u,new Set([t]))),w(3,()=>{x(),U(),r.current.value||K(),k.emit()}),()=>{o.current.delete(t),m.current.delete(t),r.current.filtered.items.delete(t);let h=P();w(4,()=>{x(),h?.getAttribute("id")===t&&K(),k.emit()})}),group:t=>(s.current.has(t)||s.current.set(t,new Set),()=>{o.current.delete(t),s.current.delete(t)}),filter:()=>v.current.shouldFilter,label:f||e["aria-label"],getDisablePointerSelection:()=>v.current.disablePointerSelection,listId:F,inputId:T,labelId:G,listInnerRef:R}),[]);function Y(t,u){var h,i;let b=(i=(h=v.current)==null?void 0:h.filter)!=null?i:tt;return t?b(t,r.current.search,u):0}function U(){if(!r.current.search||v.current.shouldFilter===!1)return;let t=r.current.filtered.items,u=[];r.current.filtered.groups.forEach(i=>{let b=s.current.get(i),y=0;b.forEach(S=>{let N=t.get(S);y=Math.max(N,y)}),u.push([i,y])});let h=R.current;H().sort((i,b)=>{var y,S;let N=i.getAttribute("id"),Q=b.getAttribute("id");return((y=t.get(Q))!=null?y:0)-((S=t.get(N))!=null?S:0)}).forEach(i=>{let b=i.closest(oe);b?b.appendChild(i.parentElement===b?i:i.closest(`${oe} > *`)):h.appendChild(i.parentElement===h?i:i.closest(`${oe} > *`))}),u.sort((i,b)=>b[1]-i[1]).forEach(i=>{var b;let y=(b=R.current)==null?void 0:b.querySelector(`${W}[${V}="${encodeURIComponent(i[0])}"]`);y?.parentElement.appendChild(y)})}function K(){let t=H().find(h=>h.getAttribute("aria-disabled")!=="true"),u=t?.getAttribute(V);k.setState("value",u||void 0)}function x(){var t,u,h,i;if(!r.current.search||v.current.shouldFilter===!1){r.current.filtered.count=m.current.size;return}r.current.filtered.groups=new Set;let b=0;for(let y of m.current){let S=(u=(t=o.current.get(y))==null?void 0:t.value)!=null?u:"",N=(i=(h=o.current.get(y))==null?void 0:h.keywords)!=null?i:[],Q=Y(S,N);r.current.filtered.items.set(y,Q),Q>0&&b++}for(let[y,S]of s.current)for(let N of S)if(r.current.filtered.items.get(N)>0){r.current.filtered.groups.add(y);break}r.current.filtered.count=b}function O(){var t,u,h;let i=P();i&&(((t=i.parentElement)==null?void 0:t.firstChild)===i&&((h=(u=i.closest(W))==null?void 0:u.querySelector(et))==null||h.scrollIntoView({block:"nearest"})),i.scrollIntoView({block:"nearest"}))}function P(){var t;return(t=R.current)==null?void 0:t.querySelector(`${$e}[aria-selected="true"]`)}function H(){var t;return Array.from(((t=R.current)==null?void 0:t.querySelectorAll(Se))||[])}function re(t){let u=H()[t];u&&k.setState("value",u.getAttribute(V))}function ne(t){var u;let h=P(),i=H(),b=i.findIndex(S=>S===h),y=i[b+t];(u=v.current)!=null&&u.loop&&(y=b+t<0?i[i.length-1]:b+t===i.length?i[0]:i[b+t]),y&&k.setState("value",y.getAttribute(V))}function pe(t){let u=P(),h=u?.closest(W),i;for(;h&&!i;)h=t>0?ut(h,W):dt(h,W),i=h?.querySelector(Se);i?k.setState("value",i.getAttribute(V)):ne(t)}let ve=()=>re(H().length-1),he=t=>{t.preventDefault(),t.metaKey?ve():t.altKey?pe(1):ne(1)},ge=t=>{t.preventDefault(),t.metaKey?re(0):t.altKey?pe(-1):ne(-1)};return l.createElement(M.div,{ref:n,tabIndex:-1,...$,"cmdk-root":"",onKeyDown:t=>{var u;(u=$.onKeyDown)==null||u.call($,t);let h=t.nativeEvent.isComposing||t.keyCode===229;if(!(t.defaultPrevented||h))switch(t.key){case"n":case"j":{I&&t.ctrlKey&&he(t);break}case"ArrowDown":{he(t);break}case"p":case"k":{I&&t.ctrlKey&&ge(t);break}case"ArrowUp":{ge(t);break}case"Home":{t.preventDefault(),re(0);break}case"End":{t.preventDefault(),ve();break}case"Enter":{t.preventDefault();let i=P();if(i){let b=new Event(me);i.dispatchEvent(b)}}}}},l.createElement("label",{"cmdk-label":"",htmlFor:D.inputId,id:D.labelId,style:pt},f),te(e,t=>l.createElement(Oe.Provider,{value:k},l.createElement(De.Provider,{value:D},t))))}),rt=l.forwardRef((e,n)=>{var r,m;let s=q(),o=l.useRef(null),d=l.useContext(Le),v=J(),f=Fe(e),c=(m=(r=f.current)==null?void 0:r.forceMount)!=null?m:d?.forceMount;L(()=>{if(!c)return v.item(s,d?.id)},[c]);let p=Ke(s,o,[e.value,e.children,o],e.keywords),g=fe(),C=A(w=>w.value&&w.value===p.current),j=A(w=>c||v.filter()===!1?!0:w.search?w.filtered.items.get(s)>0:!0);l.useEffect(()=>{let w=o.current;if(!(!w||e.disabled))return w.addEventListener(me,E),()=>w.removeEventListener(me,E)},[j,e.onSelect,e.disabled]);function E(){var w,k;z(),(k=(w=f.current).onSelect)==null||k.call(w,p.current)}function z(){g.setState("value",p.current,!0)}if(!j)return null;let{disabled:I,value:$,onSelect:F,forceMount:G,keywords:T,...R}=e;return l.createElement(M.div,{ref:_(o,n),...R,id:s,"cmdk-item":"",role:"option","aria-disabled":!!I,"aria-selected":!!C,"data-disabled":!!I,"data-selected":!!C,onPointerMove:I||v.getDisablePointerSelection()?void 0:z,onClick:I?void 0:E},e.children)}),nt=l.forwardRef((e,n)=>{let{heading:r,children:m,forceMount:s,...o}=e,d=q(),v=l.useRef(null),f=l.useRef(null),c=q(),p=J(),g=A(j=>s||p.filter()===!1?!0:j.search?j.filtered.groups.has(d):!0);L(()=>p.group(d),[]),Ke(d,v,[e.value,e.heading,f]);let C=l.useMemo(()=>({id:d,forceMount:s}),[s]);return l.createElement(M.div,{ref:_(v,n),...o,"cmdk-group":"",role:"presentation",hidden:g?void 0:!0},r&&l.createElement("div",{ref:f,"cmdk-group-heading":"","aria-hidden":!0,id:c},r),te(e,j=>l.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":r?c:void 0},l.createElement(Le.Provider,{value:C},j))))}),lt=l.forwardRef((e,n)=>{let{alwaysRender:r,...m}=e,s=l.useRef(null),o=A(d=>!d.search);return!r&&!o?null:l.createElement(M.div,{ref:_(s,n),...m,"cmdk-separator":"",role:"separator"})}),at=l.forwardRef((e,n)=>{let{onValueChange:r,...m}=e,s=e.value!=null,o=fe(),d=A(c=>c.search),v=A(c=>c.selectedItemId),f=J();return l.useEffect(()=>{e.value!=null&&o.setState("search",e.value)},[e.value]),l.createElement(M.input,{ref:n,...m,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":f.listId,"aria-labelledby":f.labelId,"aria-activedescendant":v,id:f.inputId,type:"text",value:s?e.value:d,onChange:c=>{s||o.setState("search",c.target.value),r?.(c.target.value)}})}),st=l.forwardRef((e,n)=>{let{children:r,label:m="Suggestions",...s}=e,o=l.useRef(null),d=l.useRef(null),v=A(c=>c.selectedItemId),f=J();return l.useEffect(()=>{if(d.current&&o.current){let c=d.current,p=o.current,g,C=new ResizeObserver(()=>{g=requestAnimationFrame(()=>{let j=c.offsetHeight;p.style.setProperty("--cmdk-list-height",j.toFixed(1)+"px")})});return C.observe(c),()=>{cancelAnimationFrame(g),C.unobserve(c)}}},[]),l.createElement(M.div,{ref:_(o,n),...s,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":v,"aria-label":m,id:f.listId},te(e,c=>l.createElement("div",{ref:_(d,f.listInnerRef),"cmdk-list-sizer":""},c)))}),it=l.forwardRef((e,n)=>{let{open:r,onOpenChange:m,overlayClassName:s,contentClassName:o,container:d,...v}=e;return l.createElement(Ve,{open:r,onOpenChange:m},l.createElement(Be,{container:d},l.createElement(qe,{"cmdk-overlay":"",className:s}),l.createElement(Ge,{"aria-label":e.label,"cmdk-dialog":"",className:o},l.createElement(ze,{ref:n,...v}))))}),ct=l.forwardRef((e,n)=>A(r=>r.filtered.count===0)?l.createElement(M.div,{ref:n,...e,"cmdk-empty":"",role:"presentation"}):null),ot=l.forwardRef((e,n)=>{let{progress:r,children:m,label:s="Loading...",...o}=e;return l.createElement(M.div,{ref:n,...o,"cmdk-loading":"",role:"progressbar","aria-valuenow":r,"aria-valuemin":0,"aria-valuemax":100,"aria-label":s},te(e,d=>l.createElement("div",{"aria-hidden":!0},d)))}),X=Object.assign(ze,{List:st,Item:rt,Input:at,Group:nt,Separator:lt,Dialog:it,Empty:ct,Loading:ot});function ut(e,n){let r=e.nextElementSibling;for(;r;){if(r.matches(n))return r;r=r.nextElementSibling}}function dt(e,n){let r=e.previousElementSibling;for(;r;){if(r.matches(n))return r;r=r.previousElementSibling}}function Fe(e){let n=l.useRef(e);return L(()=>{n.current=e}),n}var L=typeof window>"u"?l.useEffect:l.useLayoutEffect;function B(e){let n=l.useRef();return n.current===void 0&&(n.current=e()),n}function A(e){let n=fe(),r=()=>e(n.snapshot());return l.useSyncExternalStore(n.subscribe,r,r)}function Ke(e,n,r,m=[]){let s=l.useRef(),o=J();return L(()=>{var d;let v=(()=>{var c;for(let p of r){if(typeof p=="string")return p.trim();if(typeof p=="object"&&"current"in p)return p.current?(c=p.current.textContent)==null?void 0:c.trim():s.current}})(),f=m.map(c=>c.trim());o.value(e,v,f),(d=n.current)==null||d.setAttribute(V,v),s.current=v}),s}var mt=()=>{let[e,n]=l.useState(),r=B(()=>new Map);return L(()=>{r.current.forEach(m=>m()),r.current=new Map},[e]),(m,s)=>{r.current.set(m,s),n({})}};function ft(e){let n=e.type;return typeof n=="function"?n(e.props):"render"in n?n.render(e.props):e}function te({asChild:e,children:n},r){return e&&l.isValidElement(n)?l.cloneElement(ft(n),{ref:n.ref},r(n.props.children)):r(n)}var pt={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};function Ee({className:e,...n}){return a.jsx(X,{"data-slot":"command",className:ee("bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md",e),...n})}function Ie({className:e,...n}){return a.jsxs("div",{"data-slot":"command-input-wrapper",className:"flex h-9 items-center gap-2 border-b px-3",children:[a.jsx(ue,{className:"size-4 shrink-0 opacity-50"}),a.jsx(X.Input,{"data-slot":"command-input",className:ee("placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50",e),...n})]})}function Re({...e}){return a.jsx(X.Empty,{"data-slot":"command-empty",className:"py-6 text-center text-sm",...e})}function Pe({className:e,...n}){return a.jsx(X.Group,{"data-slot":"command-group",className:ee("text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium",e),...n})}function Ae({className:e,...n}){return a.jsx(X.Item,{"data-slot":"command-item",className:ee("data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...n})}function jt({value:e,onChange:n,disabled:r=!1,required:m=!1,showSearch:s=!0,placeholder:o={province:"استان را انتخاب کنید",city:"شهر را انتخاب کنید"},className:d,layout:v="vertical"}){const[f,c]=l.useState(null),[p,g]=l.useState(null),[C,j]=l.useState(""),[E,z]=l.useState(""),[I,$]=l.useState(!1),[F,G]=l.useState(!1);l.useEffect(()=>{if(e?.provinceId){const x=Ce.find(O=>O.id===e.provinceId);if(x&&(c(x),e.cityId)){const O=x.cities.find(P=>P.id===e.cityId);O&&g(O)}}},[e]);const T=x=>{c(x),g(null),$(!1),j(""),n({provinceId:x.id,provinceName:x.name,cityId:void 0,cityName:void 0})},R=x=>{g(x),G(!1),z(""),n({provinceId:f?.id,provinceName:f?.name,cityId:x.id,cityName:x.name})},w=()=>{c(null),g(null),n({})},k=s&&C?Te(C):Ce,D=f?f.cities:[],Y=s&&E?D.filter(x=>x.name.toLowerCase().includes(E.toLowerCase())):D,U=Z("space-y-4",v==="horizontal"&&"lg:flex lg:space-y-0 lg:space-x-4 lg:space-x-reverse",d),K=Z("space-y-2",v==="horizontal"&&"lg:flex-1");return a.jsxs("div",{className:U,children:[a.jsxs("div",{className:K,children:[a.jsxs(xe,{className:"flex items-center gap-2",children:[a.jsx(be,{className:"w-4 h-4"}),"استان",m&&a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs(ye,{open:I,onOpenChange:$,children:[a.jsx(we,{asChild:!0,children:a.jsxs(le,{variant:"outline",role:"combobox","aria-expanded":I,className:Z("w-full justify-between text-right h-10",!f&&"text-muted-foreground",r&&"opacity-50 cursor-not-allowed"),disabled:r,children:[a.jsx("span",{className:"flex-1 text-right truncate",children:f?f.name:o.province}),a.jsx(ue,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),a.jsx(je,{className:"w-full p-0",align:"start",children:a.jsxs(Ee,{className:"w-full",children:[s&&a.jsx(Ie,{placeholder:"جستجوی استان...",value:C,onValueChange:j,className:"text-right"}),a.jsx(Re,{children:"استانی یافت نشد."}),a.jsx(Pe,{className:"max-h-60 overflow-auto",children:k.map(x=>a.jsxs(Ae,{value:x.name,onSelect:()=>T(x),className:"flex items-center justify-between cursor-pointer",children:[a.jsx("span",{className:"flex-1 text-right",children:x.name}),a.jsxs(ae,{variant:"secondary",className:"ml-2 text-xs",children:[x.cities.length," شهر"]})]},x.id))})]})})]})]}),a.jsxs("div",{className:K,children:[a.jsxs(xe,{className:"flex items-center gap-2",children:[a.jsx(se,{className:"w-4 h-4"}),"شهر",m&&a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs(ye,{open:F,onOpenChange:G,children:[a.jsx(we,{asChild:!0,children:a.jsxs(le,{variant:"outline",role:"combobox","aria-expanded":F,className:Z("w-full justify-between text-right h-10",!p&&"text-muted-foreground",(!f||r)&&"opacity-50 cursor-not-allowed"),disabled:!f||r,children:[a.jsx("span",{className:"flex-1 text-right truncate",children:p?p.name:o.city}),a.jsx(ue,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),a.jsx(je,{className:"w-full p-0",align:"start",children:a.jsxs(Ee,{className:"w-full",children:[s&&a.jsx(Ie,{placeholder:"جستجوی شهر...",value:E,onValueChange:z,className:"text-right"}),a.jsx(Re,{children:D.length===0?"ابتدا استان را انتخاب کنید":"شهری یافت نشد."}),a.jsx(Pe,{className:"max-h-60 overflow-auto",children:Y.map(x=>a.jsx(Ae,{value:x.name,onSelect:()=>R(x),className:"flex items-center justify-end cursor-pointer",children:a.jsx("span",{className:"text-right",children:x.name})},x.id))})]})})]})]}),(f||p)&&a.jsx("div",{className:"flex justify-start",children:a.jsx(le,{variant:"ghost",size:"sm",onClick:w,className:"text-muted-foreground hover:text-foreground",disabled:r,children:"پاک کردن انتخاب"})}),(f||p)&&a.jsxs("div",{className:"bg-muted/50 rounded-lg p-3 space-y-2",children:[a.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[a.jsx(se,{className:"w-4 h-4"}),a.jsx("span",{children:"انتخاب شده:"})]}),a.jsxs("div",{className:"flex flex-wrap gap-2",children:[f&&a.jsxs(ae,{variant:"secondary",className:"flex items-center gap-1",children:[a.jsx(be,{className:"w-3 h-3"}),f.name]}),p&&a.jsxs(ae,{variant:"default",className:"flex items-center gap-1",children:[a.jsx(se,{className:"w-3 h-3"}),p.name]})]})]})]})}export{jt as P};
