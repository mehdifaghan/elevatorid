import{r as o,t as l,j as e,q as S,B as i,V as R,z as re,D as le,E as v,F as y,C as r,e as c,T as G,b as m,c as h,d as j,X as E,w as A,x as F,v as O,o as _,y as ie}from"./index-tH8kGzNV.js";import{S as ne,a as oe,b as ce,c as de,d as N}from"./select-B8NiX_r6.js";import{A as xe}from"./AdvancedTable-BFnDxHqp.js";import{r as X}from"./real-api-client-o-2gE2Hp.js";import{D as me}from"./download-BGqk_jGh.js";import{F as q}from"./file-text-DbNNqFYp.js";import{T as H}from"./trending-down-HaRH2stY.js";import{R as b,A as he,C as D,X as L,Y as C,T as w,a as I,P as pe,b as je,c as ue,B}from"./AreaChart-D5HVI-Po.js";import{L as ge,a as Y,B as fe}from"./BarChart-DzxdONkP.js";import{C as ve}from"./clock-BiwlPOks.js";import{D as ye,T as Ne}from"./target-C5orY2ZX.js";import{A as be}from"./activity-DbHfuyK_.js";import"./index-BdQq_4o_.js";import"./Combination-Dzecd94B.js";import"./index-BuiImgyP.js";import"./check-DV_4N94Y.js";import"./table-DC3MYrD8.js";import"./search-8LTSveb2.js";import"./chevron-right-B97jr1RJ.js";function Ge(){const[t,K]=o.useState(null),[M,Ce]=o.useState("overview"),[U,J]=o.useState("all"),[d,$]=o.useState(!1),[Q,W]=o.useState("overview"),[n,P]=o.useState(!0),[T,u]=o.useState(!1);o.useEffect(()=>{V()},[]);const k=async()=>{u(!1),await V(),l.success("داده‌ها با موفقیت به‌روزرسانی شد")},V=async()=>{try{P(!0),u(!1);const s=await X.get("/admin/reports"),a={monthlyStats:s.monthlyStats||s.monthly_stats||[],companyTypes:s.companyTypes||s.company_types||[],transferTrends:s.transferTrends||s.transfer_trends||[],topCompanies:s.topCompanies||s.top_companies||[],kpis:{totalParts:s.kpis?.totalParts||s.kpis?.total_parts||s.totalParts||s.total_parts||0,totalTransfers:s.kpis?.totalTransfers||s.kpis?.total_transfers||s.totalTransfers||s.total_transfers||0,totalElevators:s.kpis?.totalElevators||s.kpis?.total_elevators||s.totalElevators||s.total_elevators||0,totalUsers:s.kpis?.totalUsers||s.kpis?.total_users||s.totalUsers||s.total_users||0,avgTransferTime:s.kpis?.avgTransferTime||s.kpis?.avg_transfer_time||s.avgTransferTime||s.avg_transfer_time||"0 روز",totalValue:s.kpis?.totalValue||s.kpis?.total_value||s.totalValue||s.total_value||"0 ریال",completionRate:s.kpis?.completionRate||s.kpis?.completion_rate||s.completionRate||s.completion_rate||"0%",todayActivity:s.kpis?.todayActivity||s.kpis?.today_activity||s.todayActivity||s.today_activity||0}};K(a),u(!1)}catch(s){if(console.error("Error fetching report data:",s),K({monthlyStats:[],companyTypes:[],transferTrends:[],topCompanies:[],kpis:{totalParts:0,totalTransfers:0,totalElevators:0,totalUsers:0,avgTransferTime:"0 روز",totalValue:"0 ریال",completionRate:"0%",todayActivity:0}}),u(!0),s&&typeof s=="object"&&"isNetworkError"in s){const a=s;a.isNetworkError?l.error("عدم دسترسی به سرور برای دریافت گزارش‌ها"):a.isAuthError?l.error("خطای احراز هویت در دریافت گزارش‌ها"):l.error("خطا در بارگذاری گزارش‌ها")}else l.error("خطا در بارگذاری گزارش‌ها")}finally{P(!1)}},x=async s=>{$(!0);try{const a=await X.post("/admin/reports/export",{format:s,reportType:M,companyFilter:U},{responseType:"blob"}),f=new Blob([a],{type:s==="pdf"?"application/pdf":"application/octet-stream"}),z=window.URL.createObjectURL(f),p=document.createElement("a");p.href=z,p.download=`report-${new Date().toISOString().split("T")[0]}.${s}`,document.body.appendChild(p),p.click(),document.body.removeChild(p),window.URL.revokeObjectURL(z),l.success(`گزارش ${s.toUpperCase()} با موفقیت تولید شد`)}catch(a){if(console.error("Error generating report:",a),a&&typeof a=="object"&&"isNetworkError"in a){const f=a;f.isNetworkError?l.error("عدم دسترسی به سرور برای تولید گزارش"):f.isAuthError?l.error("خطای احراز هویت در تولید گزارش"):l.error("خطا در تولید گزارش")}else l.error("خطا در تولید گزارش")}finally{$(!1)}},Z=[{key:"name",label:"شرکت",sortable:!0,render:s=>e.jsx("span",{className:"font-medium",children:s})},{key:"parts",label:"قطعات",sortable:!0,render:s=>e.jsx(_,{variant:"outline",className:"bg-blue-50 text-blue-700",children:s})},{key:"transfers",label:"انتقال‌ها",sortable:!0,render:s=>e.jsx(_,{variant:"outline",className:"bg-green-50 text-green-700",children:s})},{key:"elevators",label:"آسانسورها",sortable:!0,render:s=>e.jsx(_,{variant:"outline",className:"bg-purple-50 text-purple-700",children:s})},{key:"lastActivity",label:"آخرین فعالیت",sortable:!0,render:()=>new Date().toLocaleDateString("fa-IR")}],ee=()=>t?[{title:"کل قطعات ثبت‌شده",value:t.kpis.totalParts.toLocaleString("fa-IR"),change:"+12%",trend:"up",icon:O,color:"text-blue-600",bgColor:"bg-blue-50",description:"در ماه جاری"},{title:"کل انتقال‌ها",value:t.kpis.totalTransfers.toLocaleString("fa-IR"),change:"+8%",trend:"up",icon:A,color:"text-green-600",bgColor:"bg-green-50",description:"انتقال موفق"},{title:"کل آسانسورها",value:t.kpis.totalElevators.toLocaleString("fa-IR"),change:"+15%",trend:"up",icon:F,color:"text-purple-600",bgColor:"bg-purple-50",description:"آسانسور فعال"},{title:"کل کاربران",value:t.kpis.totalUsers.toLocaleString("fa-IR"),change:"+25%",trend:"up",icon:ie,color:"text-orange-600",bgColor:"bg-orange-50",description:"کاربر تایید شده"}]:[],se=()=>t?[{title:"میانگین زمان انتقال",value:t.kpis.avgTransferTime,change:"-15%",trend:"down",icon:ve,color:"text-cyan-600",bgColor:"bg-cyan-50",description:"بهبود عملکرد"},{title:"ارزش کل انتقال‌ها",value:t.kpis.totalValue,change:"+22%",trend:"up",icon:ye,color:"text-emerald-600",bgColor:"bg-emerald-50",description:"ریال"},{title:"نرخ تکمیل درخواست‌ها",value:t.kpis.completionRate,change:"+3%",trend:"up",icon:Ne,color:"text-rose-600",bgColor:"bg-rose-50",description:"درخواست‌های موفق"},{title:"فعالیت امروز",value:t.kpis.todayActivity.toLocaleString("fa-IR"),change:"+8%",trend:"up",icon:be,color:"text-indigo-600",bgColor:"bg-indigo-50",description:"عملیات انجام‌شده"}]:[],g=({icon:s,title:a})=>e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(s,{className:"w-16 h-16 mx-auto text-muted-foreground mb-4"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground font-medium",children:"داده‌ای برای نمایش وجود ندارد"}),T&&e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"ممکن است مشکلی در اتصال به سرور وجود داشته باشد"})]}),T&&e.jsx(i,{onClick:k,disabled:n,variant:"outline",size:"sm",children:n?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-4 h-4 animate-spin ml-2"}),"در حال تلاش مجدد..."]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 ml-2"}),"تلاش مجدد"]})})]})});if(n&&!t)return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",dir:"rtl",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(S,{className:"h-8 w-8 animate-spin mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"در حال بارگذاری گزارش‌ها..."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"اتصال به سرور..."})]})});const te=ee(),ae=se();return e.jsxs("div",{className:"space-y-6",dir:"rtl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("h1",{className:"text-3xl font-bold",children:"گزارش‌ها و تحلیل‌ها"}),e.jsx("p",{className:"text-muted-foreground",children:"آمارها و گزارش‌های تفصیلی سیستم"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:k,disabled:n,className:"gap-2",children:[e.jsx(R,{className:`h-4 w-4 ${n?"animate-spin":""}`}),n?"در حال بارگذاری...":"تازه‌سازی"]}),e.jsxs(i,{onClick:()=>x("csv"),disabled:d,variant:"outline",size:"sm",children:[e.jsx(me,{className:"w-4 h-4 ml-2"}),"CSV"]}),e.jsxs(i,{onClick:()=>x("excel"),disabled:d,variant:"outline",size:"sm",children:[e.jsx(q,{className:"w-4 h-4 ml-2"}),"Excel"]}),e.jsxs(i,{onClick:()=>x("pdf"),disabled:d,children:[e.jsx(q,{className:"w-4 h-4 ml-2"}),d?"در حال تولید...":"گزارش PDF"]})]})]}),e.jsxs(re,{value:Q,onValueChange:W,className:"w-full",dir:"rtl",children:[e.jsxs(le,{className:"flex w-full",dir:"rtl",children:[e.jsx(v,{value:"overview",className:"flex-1 text-center",children:"نمای کلی"}),e.jsx(v,{value:"analytics",className:"flex-1 text-center",children:"تحلیل‌ها"}),e.jsx(v,{value:"detailed",className:"flex-1 text-center",children:"گزارش تفصیلی"}),e.jsx(v,{value:"export",className:"flex-1 text-center",children:"صادرات"})]}),e.jsxs(y,{value:"overview",className:"space-y-6",dir:"rtl",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:te.map((s,a)=>e.jsx(r,{className:"hover:shadow-md transition-shadow",children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:s.title}),e.jsx("p",{className:"text-2xl font-bold mb-2",children:s.value}),e.jsxs("div",{className:"flex items-center gap-1",children:[s.trend==="up"?e.jsx(G,{className:"h-4 w-4 text-green-600"}):e.jsx(H,{className:"h-4 w-4 text-red-600"}),e.jsx("span",{className:`text-sm ${s.trend==="up"?"text-green-600":"text-red-600"}`,children:s.change}),e.jsx("span",{className:"text-xs text-muted-foreground mr-2",children:s.description})]})]}),e.jsx("div",{className:`p-3 rounded-lg ${s.bgColor}`,children:e.jsx(s.icon,{className:`h-6 w-6 ${s.color}`})})]})})},a))}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:ae.map((s,a)=>e.jsx(r,{className:"hover:shadow-md transition-shadow",children:e.jsx(c,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-muted-foreground mb-1",children:s.title}),e.jsx("p",{className:"text-2xl font-bold mb-2",children:s.value}),e.jsxs("div",{className:"flex items-center gap-1",children:[s.trend==="up"?e.jsx(G,{className:"h-4 w-4 text-green-600"}):e.jsx(H,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{className:"text-sm text-green-600",children:s.change}),e.jsx("span",{className:"text-xs text-muted-foreground mr-2",children:s.description})]})]}),e.jsx("div",{className:`p-3 rounded-lg ${s.bgColor}`,children:e.jsx(s.icon,{className:`h-6 w-6 ${s.color}`})})]})})},a))})]}),e.jsx(y,{value:"analytics",className:"space-y-6",dir:"rtl",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(r,{children:[e.jsxs(m,{children:[e.jsx(h,{children:"آمار ماهانه"}),e.jsx(j,{children:"روند فعالیت‌ها در ماه‌های اخیر"})]}),e.jsx(c,{children:e.jsx("div",{className:"h-80",children:t?.monthlyStats.length?e.jsx(b,{width:"100%",height:"100%",children:e.jsxs(he,{data:t.monthlyStats,children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(L,{dataKey:"month"}),e.jsx(C,{}),e.jsx(w,{}),e.jsx(I,{type:"monotone",dataKey:"parts",stackId:"1",stroke:"#0088FE",fill:"#0088FE",name:"قطعات"}),e.jsx(I,{type:"monotone",dataKey:"transfers",stackId:"1",stroke:"#00C49F",fill:"#00C49F",name:"انتقال‌ها"}),e.jsx(I,{type:"monotone",dataKey:"elevators",stackId:"1",stroke:"#FFBB28",fill:"#FFBB28",name:"آسانسورها"})]})}):e.jsx(g,{icon:E,title:"آمار ماهانه"})})})]}),e.jsxs(r,{children:[e.jsxs(m,{children:[e.jsx(h,{children:"توزیع انواع شرکت‌ها"}),e.jsx(j,{children:"درصد انواع مختلف شرکت‌های عضو"})]}),e.jsx(c,{children:e.jsx("div",{className:"h-80",children:t?.companyTypes.length?e.jsx(b,{width:"100%",height:"100%",children:e.jsxs(pe,{children:[e.jsx(je,{data:t.companyTypes,cx:"50%",cy:"50%",outerRadius:80,fill:"#8884d8",dataKey:"value",label:({name:s,percent:a})=>`${s} ${(a*100).toFixed(0)}%`,children:t.companyTypes.map((s,a)=>e.jsx(ue,{fill:s.color},`cell-${a}`))}),e.jsx(w,{})]})}):e.jsx(g,{icon:E,title:"توزیع شرکت‌ها"})})})]}),e.jsxs(r,{children:[e.jsxs(m,{children:[e.jsx(h,{children:"روند انتقال‌ها"}),e.jsx(j,{children:"تعداد و ارزش انتقال‌ها در هفته اخیر"})]}),e.jsx(c,{children:e.jsx("div",{className:"h-80",children:t?.transferTrends.length?e.jsx(b,{width:"100%",height:"100%",children:e.jsxs(ge,{data:t.transferTrends,children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(L,{dataKey:"date"}),e.jsx(C,{yAxisId:"left"}),e.jsx(C,{yAxisId:"right",orientation:"right"}),e.jsx(w,{}),e.jsx(Y,{yAxisId:"left",type:"monotone",dataKey:"transfers",stroke:"#8884d8",name:"تعداد انتقال"}),e.jsx(Y,{yAxisId:"right",type:"monotone",dataKey:"value",stroke:"#82ca9d",name:"ارزش (ریال)"})]})}):e.jsx(g,{icon:A,title:"روند انتقال‌ها"})})})]}),e.jsxs(r,{children:[e.jsxs(m,{children:[e.jsx(h,{children:"شرکت‌های برتر"}),e.jsx(j,{children:"فعال‌ترین شرکت‌ها بر اساس تعداد فعالیت"})]}),e.jsx(c,{children:e.jsx("div",{className:"h-80",children:t?.topCompanies.length?e.jsx(b,{width:"100%",height:"100%",children:e.jsxs(fe,{data:t.topCompanies,children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(L,{dataKey:"name"}),e.jsx(C,{}),e.jsx(w,{}),e.jsx(B,{dataKey:"parts",fill:"#0088FE",name:"قطعات"}),e.jsx(B,{dataKey:"transfers",fill:"#00C49F",name:"انتقال‌ها"}),e.jsx(B,{dataKey:"elevators",fill:"#FFBB28",name:"آسانسورها"})]})}):e.jsx(g,{icon:F,title:"شرکت‌های برتر"})})})]})]})}),e.jsx(y,{value:"detailed",className:"space-y-6",dir:"rtl",children:e.jsxs(r,{children:[e.jsx(m,{children:e.jsxs(h,{className:"flex items-center justify-between",children:["گزارش تفصیلی شرکت‌ها",e.jsx("div",{className:"flex gap-2",children:e.jsxs(ne,{value:U,onValueChange:J,children:[e.jsx(oe,{className:"w-48",children:e.jsx(ce,{placeholder:"فیلتر شرکت"})}),e.jsxs(de,{children:[e.jsx(N,{value:"all",children:"همه شرکت‌ها"}),e.jsx(N,{value:"1",children:"شرکت آسانسار تهران"}),e.jsx(N,{value:"2",children:"شرکت قطعات پارس"}),e.jsx(N,{value:"3",children:"شرکت نصب سریع"})]})]})})]})}),e.jsx(c,{children:t?.topCompanies&&t.topCompanies.length>0?e.jsx(xe,{data:t.topCompanies.map((s,a)=>({...s,id:a+1,lastActivity:new Date().toLocaleDateString("fa-IR")})),columns:Z,searchable:!0,exportable:!0,pagination:!1,emptyMessage:"هیچ داده‌ای یافت نشد"}):e.jsx("div",{className:"flex items-center justify-center min-h-[200px]",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(F,{className:"h-12 w-12 mx-auto text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-foreground",children:"هیچ داده‌ای یافت نشد"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"ممکن است مشکلی در اتصال به سرور وجود داشته باشد یا هنوز داده‌ای ثبت نشده باشد."})]}),T&&e.jsx(i,{onClick:k,disabled:n,variant:"outline",children:n?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"w-4 h-4 animate-spin ml-2"}),"در حال تلاش مجدد..."]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{className:"w-4 h-4 ml-2"}),"تلاش مجدد"]})})]})})})]})}),e.jsx(y,{value:"export",className:"space-y-6",dir:"rtl",children:e.jsxs(r,{children:[e.jsxs(m,{children:[e.jsx(h,{children:"صادرات گزارش‌ها"}),e.jsx(j,{children:"گزارش‌های مختلف را در فرمت‌های مختلف دانلود کنید"})]}),e.jsx(c,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsx(r,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(E,{className:"h-12 w-12 mx-auto text-blue-600"}),e.jsx("h3",{className:"font-semibold",children:"گزارش کلی سیستم"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"آمار کلی قطعات، انتقال‌ها و آسانسورها"}),e.jsx(i,{onClick:()=>x("pdf"),disabled:d,className:"w-full",children:"دانلود PDF"})]})}),e.jsx(r,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(O,{className:"h-12 w-12 mx-auto text-green-600"}),e.jsx("h3",{className:"font-semibold",children:"گزارش قطعات"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"لیست کامل قطعات و وضعیت آن‌ها"}),e.jsx(i,{onClick:()=>x("excel"),disabled:d,className:"w-full",variant:"outline",children:"دانلود Excel"})]})}),e.jsx(r,{className:"p-6",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx(A,{className:"h-12 w-12 mx-auto text-purple-600"}),e.jsx("h3",{className:"font-semibold",children:"گزارش انتقال‌ها"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"تاریخچه و جزئیات انتقال‌های انجام‌شده"}),e.jsx(i,{onClick:()=>x("csv"),disabled:d,className:"w-full",variant:"outline",children:"دانلود CSV"})]})})]})})]})})]})]})}export{Ge as default};
