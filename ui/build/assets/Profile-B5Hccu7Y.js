import{u as G,r as n,t,j as e,z as V,D as Z,E as S,F,C as g,b as p,c as N,d as w,B as v,e as b,o as J,S as R,U as y,L as o,p as d,P as K,G as O}from"./index-tH8kGzNV.js";import{T as Q,a as W,b as P,c as j,d as X,e as u}from"./table-DC3MYrD8.js";import{A as Y,a as _,b as ee}from"./avatar-MaNl8m6v.js";import{r as f}from"./real-api-client-o-2gE2Hp.js";import{M as se}from"./mail-B9fXdK0_.js";import{A as I}from"./activity-DbHfuyK_.js";function oe(){const{user:m}=G(),[c,C]=n.useState(!1),[A,T]=n.useState([]),[B,x]=n.useState(!1),[ae,k]=n.useState(!0),[E,D]=n.useState(null),[a,l]=n.useState({username:"",email:"",mobile:"",currentPassword:"",newPassword:"",confirmPassword:""});n.useEffect(()=>{L(),U()},[]);const L=async()=>{try{k(!0);const s=await f.get("/admin/profile");s.data&&(D(s.data),l(r=>({...r,username:s.data.username||"",email:s.data.email||"",mobile:s.data.mobile||""})))}catch(s){console.error("Error fetching profile:",s),t.error("خطا در بارگذاری اطلاعات پروفایل"),m&&l(r=>({...r,username:m.username||"",email:m.email||"",mobile:m.mobile||""}))}finally{k(!1)}},U=async()=>{try{x(!0);const s=await f.get("/admin/activity-logs");s.data&&T(s.data.logs||s.data||[])}catch(s){console.error("Error fetching activity logs:",s),T([])}finally{x(!1)}},H=async()=>{if(!a.username||!a.email||!a.mobile){t.error("لطفاً تمام فیلدهای ضروری را پر کنید");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.email)){t.error("لطفاً ایمیل معتبر وارد کنید");return}if(!/^09[0-9]{9}$/.test(a.mobile)){t.error("لطفاً شماره موبایل معتبر وارد کنید (09xxxxxxxxx)");return}try{x(!0);const i=await f.put("/admin/profile",{username:a.username,email:a.email,mobile:a.mobile});t.success("پروفایل با موفقیت به‌روزرسانی شد"),C(!1),await L()}catch(i){console.error("Error updating profile:",i),i.response?.data?.message?t.error(i.response.data.message):i.response?.status===400?t.error("اطلاعات ارسالی نامعتبر است"):i.response?.status===409?t.error("نام کاربری یا ایمیل قبلاً استفاده شده است"):t.error("خطا در به‌روزرسانی پروفایل")}finally{x(!1)}},M=async()=>{if(!a.currentPassword||!a.newPassword||!a.confirmPassword){t.error("لطفاً تمام فیلدهای رمز عبور را پر کنید");return}if(a.newPassword!==a.confirmPassword){t.error("رمز عبور جدید و تایید آن یکسان نیستند");return}if(a.newPassword.length<8){t.error("رمز عبور باید حداقل ۸ کاراکتر باشد");return}const s=/[A-Z]/.test(a.newPassword),r=/[a-z]/.test(a.newPassword),i=/\d/.test(a.newPassword);if(!s||!r||!i){t.error("رمز عبور باید شامل حروف بزرگ، کوچک و عدد باشد");return}try{x(!0);const h=await f.post("/admin/change-password",{currentPassword:a.currentPassword,newPassword:a.newPassword});t.success("رمز عبور با موفقیت تغییر کرد"),l(q=>({...q,currentPassword:"",newPassword:"",confirmPassword:""}))}catch(h){console.error("Error changing password:",h),h.response?.data?.message?t.error(h.response.data.message):h.response?.status===400?t.error("رمز عبور فعلی اشتباه است"):h.response?.status===422?t.error("رمز عبور جدید معتبر نیست"):t.error("خطا در تغییر رمز عبور")}finally{x(!1)}},$=s=>{switch(s){case"ورود به سیستم":case"خروج از سیستم":return e.jsx(y,{className:"w-4 h-4"});case"تایید درخواست":case"ایجاد کاربر":return e.jsx(R,{className:"w-4 h-4"});case"تغییر تنظیمات":return e.jsx(I,{className:"w-4 h-4"});default:return e.jsx(I,{className:"w-4 h-4"})}},z=s=>{switch(s){case"ورود به سیستم":return"text-green-600";case"خروج از سیستم":return"text-red-600";case"تایید درخواست":case"ایجاد کاربر":return"text-blue-600";case"تغییر تنظیمات":return"text-orange-600";default:return"text-gray-600"}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"پروفایل مدیر"}),e.jsx("p",{className:"text-muted-foreground",children:"مدیریت اطلاعات حساب کاربری"})]}),e.jsxs(V,{defaultValue:"profile",className:"space-y-6",children:[e.jsxs(Z,{className:"grid w-full grid-cols-2",children:[e.jsx(S,{value:"activity",children:"فعالیت‌های اخیر"}),e.jsx(S,{value:"profile",children:"اطلاعات حساب"})]}),e.jsxs(F,{value:"profile",className:"space-y-6",children:[e.jsxs(g,{children:[e.jsx(p,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-right order-2",children:[e.jsx(N,{children:"اطلاعات شخصی"}),e.jsx(w,{children:"مدیریت اطلاعات پایه حساب کاربری"})]}),e.jsx(v,{variant:c?"outline":"default",onClick:()=>C(!c),className:"order-1",children:c?"انصراف":"ویرایش"})]})}),e.jsxs(b,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-6 flex-row-reverse",children:[e.jsxs("div",{className:"text-right",children:[e.jsx("h3",{className:"text-lg font-semibold",children:m?.username}),e.jsx("p",{className:"text-muted-foreground",children:"مدیر سیستم"}),e.jsxs(J,{variant:"outline",className:"mt-1 flex-row-reverse",children:[E?.isActive?"فعال":"غیرفعال",e.jsx(R,{className:"w-3 h-3 ml-1"})]})]}),e.jsxs(Y,{className:"w-20 h-20",children:[e.jsx(_,{children:e.jsx(y,{className:"w-10 h-10"})}),e.jsx(ee,{className:"text-lg",children:(E?.username||m?.username)?.charAt(0).toUpperCase()||"M"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"username",className:"text-right block",children:"نام کاربری"}),e.jsxs("div",{className:"relative",children:[e.jsx(y,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(d,{id:"username",value:a.username,onChange:s=>l(r=>({...r,username:s.target.value})),disabled:!c,className:"pr-10 text-right"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"email",className:"text-right block",children:"ایمیل"}),e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(d,{id:"email",type:"email",value:a.email,onChange:s=>l(r=>({...r,email:s.target.value})),disabled:!c,className:"pr-10 text-left",dir:"ltr"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"mobile",className:"text-right block",children:"شماره موبایل"}),e.jsxs("div",{className:"relative",children:[e.jsx(K,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(d,{id:"mobile",type:"tel",value:a.mobile,onChange:s=>l(r=>({...r,mobile:s.target.value})),disabled:!c,className:"pr-10 text-left",dir:"ltr"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-right block",children:"تاریخ عضویت"}),e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(d,{value:"۱۴۰۲/۰۵/۱۵",disabled:!0,className:"pr-10 bg-muted text-right"})]})]})]}),c&&e.jsx("div",{className:"flex justify-end",children:e.jsx(v,{onClick:H,children:"ذخیره تغییرات"})})]})]}),e.jsxs(g,{children:[e.jsxs(p,{className:"text-right",children:[e.jsx(N,{children:"تغییر رمز عبور"}),e.jsx(w,{children:"برای امنیت بیشتر، رمز عبور خود را تغییر دهید"})]}),e.jsxs(b,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"currentPassword",className:"text-right block",children:"رمز عبور فعلی"}),e.jsx(d,{id:"currentPassword",type:"password",value:a.currentPassword,onChange:s=>l(r=>({...r,currentPassword:s.target.value})),className:"text-left",dir:"ltr"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"newPassword",className:"text-right block",children:"رمز عبور جدید"}),e.jsx(d,{id:"newPassword",type:"password",value:a.newPassword,onChange:s=>l(r=>({...r,newPassword:s.target.value})),className:"text-left",dir:"ltr"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"confirmPassword",className:"text-right block",children:"تایید رمز عبور جدید"}),e.jsx(d,{id:"confirmPassword",type:"password",value:a.confirmPassword,onChange:s=>l(r=>({...r,confirmPassword:s.target.value})),className:"text-left",dir:"ltr"})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(v,{onClick:M,children:"تغییر رمز عبور"})})]})]})]}),e.jsx(F,{value:"activity",children:e.jsxs(g,{children:[e.jsxs(p,{className:"text-right",children:[e.jsx(N,{children:"فعالیت‌های اخیر"}),e.jsx(w,{children:"لیست آخرین فعالیت‌های انجام شده در سیستم"})]}),e.jsx(b,{children:B?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"در حال بارگذاری فعالیت‌ها..."})]})}):e.jsx("div",{className:"rounded-lg border",children:e.jsxs(Q,{children:[e.jsx(W,{children:e.jsxs(P,{children:[e.jsx(j,{className:"text-right",children:"فعالیت"}),e.jsx(j,{className:"text-right",children:"جزئیات"}),e.jsx(j,{className:"text-right",children:"زمان"}),e.jsx(j,{className:"text-right",children:"IP"}),e.jsx(j,{className:"text-right",children:"مرورگر"})]})}),e.jsx(X,{children:A.length===0?e.jsx(P,{children:e.jsx(u,{colSpan:5,className:"text-center py-8",children:e.jsx("p",{className:"text-muted-foreground",children:"هیچ فعالیتی یافت نشد"})})}):A.map(s=>e.jsxs(P,{children:[e.jsx(u,{className:"text-right",children:e.jsxs("div",{className:"flex items-center gap-2 flex-row-reverse",children:[e.jsx("span",{className:"font-medium",children:s.action}),e.jsx("div",{className:`p-1 rounded ${z(s.action)}`,children:$(s.action)})]})}),e.jsx(u,{className:"max-w-md text-right",children:e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.details})}),e.jsx(u,{className:"text-sm text-right",children:s.timestamp}),e.jsx(u,{className:"text-sm font-mono text-left",dir:"ltr",children:s.ip}),e.jsx(u,{className:"text-sm text-right",children:s.userAgent})]},s.id))})]})})})]})})]})]})}export{oe as default};
