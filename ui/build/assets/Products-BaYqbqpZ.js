import{r as t,t as h,j as e,B as E,C as f,e as N,b as Q,p as x,V as ne,v as G,o as I,Q as de,R as oe,L as o,q as me,c as K}from"./index-tH8kGzNV.js";import{T as xe,a as he,b as U,c as y,d as ue,e as C}from"./table-DC3MYrD8.js";import{D as W,a as je,b as X,c as Y,d as Z,e as _}from"./dialog-DAjwwShP.js";import{S as ee}from"./scroll-area-VRfuIe_R.js";import{D as pe,a as ge,b as fe,c as P}from"./dropdown-menu-BKfQT_JD.js";import{S as V,a as $,b as A,c as H,d as S}from"./select-B8NiX_r6.js";import{S as Ne}from"./switch-DOMxWR7b.js";import{T as be,a as ve,b as ye,c as Ce}from"./tooltip-CkdpyXMD.js";import{a as Se,S as we}from"./SellModal-B1TPinsx.js";import{r as O}from"./real-api-client-o-2gE2Hp.js";import{P as Te}from"./plus-A2-5MgKF.js";import{S as De}from"./search-8LTSveb2.js";import{S as Pe}from"./ship-CTFlTIuv.js";import{E as Ie}from"./ellipsis-J_HkHiqq.js";import{S as Fe}from"./square-pen-BV4EFpYT.js";import{F as Re}from"./file-text-DbNNqFYp.js";import{T as ke}from"./trash-2-BwVZTJjK.js";import"./index-DGGMjIYi.js";import"./Combination-Dzecd94B.js";import"./x-B6dSK8zO.js";import"./index-BdQq_4o_.js";import"./chevron-right-B97jr1RJ.js";import"./check-DV_4N94Y.js";import"./index-BuiImgyP.js";import"./PersianDatePicker-1MwY2jFT.js";import"./popover-B3pW-y7H.js";import"./utils-BvTIn9cQ.js";const se={available:"bg-green-100 text-green-800",sold:"bg-blue-100 text-blue-800",reserved:"bg-yellow-100 text-yellow-800"},ae={available:"موجود",sold:"فروخته شده",reserved:"رزرو شده"};function ns(){const[c,u]=t.useState([]),[F,i]=t.useState([]),[m,j]=t.useState(!0),[w,L]=t.useState(""),[R,p]=t.useState("all"),[n,b]=t.useState(null),[z,k]=t.useState(!1),[q,T]=t.useState(!1),[v,B]=t.useState({total:0,available:0,sold:0,reserved:0,installing:0,delivered:0}),[M,a]=t.useState(!1);t.useEffect(()=>{r()},[]);const r=async()=>{try{j(!0);const l=(await O.get("/user/products")).data.products||[];u(l),B(g(l));const d=await O.get("/user/product-categories");i(d.data.categories||[])}catch(s){console.error("Error fetching products data:",s),h.error("خطا در بارگذاری اطلاعات محصولات"),u([]),B({total:0,available:0,sold:0,reserved:0,installing:0,delivered:0}),i([])}finally{j(!1)}},g=s=>({total:s.length,available:s.filter(l=>l.status==="available").length,sold:s.filter(l=>l.status==="sold").length,reserved:s.filter(l=>l.status==="reserved").length,installing:0,delivered:0}),D=s=>{const l=c.filter(d=>d.name===s.name&&d.model===s.model&&d.manufacturer===s.manufacturer&&JSON.stringify(d.specifications)===JSON.stringify(s.specifications));if(l.length>1){const d=l.findIndex(ce=>ce.id===s.id);return{isBatch:!0,batchSize:l.length,batchIndex:d+1}}return{isBatch:!1,batchSize:1,batchIndex:1}},J=c.filter(s=>{const l=s.name.toLowerCase().includes(w.toLowerCase())||s.model.toLowerCase().includes(w.toLowerCase())||s.serialNumber.toLowerCase().includes(w.toLowerCase()),d=R==="all"||s.status===R;return l&&d}),re=async s=>{if(confirm(`آیا از حذف ${s.name} اطمینان دارید؟`))try{await O.delete(`/user/products/${s.id}`),u(l=>l.filter(d=>d.id!==s.id)),B(g(c.filter(l=>l.id!==s.id))),h.success(`${s.name} حذف شد`)}catch(l){console.error("Error deleting product:",l),h.error("خطا در حذف محصول")}},le=s=>{b(s),a(!0)},te=async()=>{T(!0),await r(),T(!1),h.success("لیست محصولات به‌روزرسانی شد")},ie=async s=>{try{(await O.post("/user/products",s)).data&&(await r(),h.success("محصول جدید با موفقیت ثبت شد"))}catch(l){console.error("Error creating product:",l),h.error("خطا در ثبت محصول جدید")}};return m?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"در حال بارگذاری محصولات..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"مدیریت محصولات"}),e.jsx("p",{className:"text-muted-foreground",children:"قطعات و محصولات در مالکیت شما"})]}),e.jsxs(W,{open:z,onOpenChange:k,children:[e.jsx(je,{asChild:!0,children:e.jsxs(E,{children:[e.jsx(Te,{className:"w-4 h-4 ml-2"}),"ثبت محصول جدید"]})}),e.jsxs(X,{className:"max-w-4xl max-h-[90vh]",children:[e.jsxs(Y,{className:"text-right",dir:"rtl",children:[e.jsx(Z,{className:"text-right",children:"ثبت محصول جدید"}),e.jsx(_,{className:"text-right",children:"اطلاعات محصول جدید را وارد کنید. برای ثبت چندین محصول با مشخصات یکسان، حالت دسته‌ای را فعال کنید."})]}),e.jsx(ee,{className:"max-h-[calc(90vh-8rem)] overflow-auto",children:e.jsx(qe,{onClose:()=>k(!1),categories:F,onSubmit:ie})})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[e.jsx(f,{className:"border-l-4 border-l-blue-500",children:e.jsx(N,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-blue-600",children:v.total}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"کل محصولات"})]})})}),e.jsx(f,{className:"border-l-4 border-l-green-500",children:e.jsx(N,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-green-600",children:v.available}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"در دسترس"})]})})}),e.jsx(f,{className:"border-l-4 border-l-orange-500",children:e.jsx(N,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-orange-600",children:v.sold}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"فروخته شده"})]})})}),e.jsx(f,{className:"border-l-4 border-l-yellow-500",children:e.jsx(N,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-yellow-600",children:v.reserved}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"رزرو شده"})]})})}),e.jsx(f,{className:"border-l-4 border-l-purple-500",children:e.jsx(N,{className:"p-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold text-purple-600",children:v.installing||0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"در حال نصب"})]})})})]}),e.jsxs(f,{children:[e.jsx(Q,{children:e.jsx("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(De,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(x,{placeholder:"جستجو بر اساس نام، مدل یا سریال...",value:w,onChange:s=>L(s.target.value),className:"pr-10"})]}),e.jsxs(V,{value:R,onValueChange:p,children:[e.jsx($,{className:"w-32",children:e.jsx(A,{placeholder:"وضعیت"})}),e.jsxs(H,{children:[e.jsx(S,{value:"all",children:"همه"}),e.jsx(S,{value:"available",children:"موجود"}),e.jsx(S,{value:"sold",children:"فروخته شده"}),e.jsx(S,{value:"reserved",children:"رزرو شده"})]})]}),e.jsx(be,{children:e.jsxs(ve,{children:[e.jsx(ye,{asChild:!0,children:e.jsx(E,{variant:"outline",size:"icon",onClick:te,disabled:q,className:"shrink-0",children:e.jsx(ne,{className:`w-4 h-4 ${q?"animate-spin":""}`})})}),e.jsx(Ce,{children:e.jsx("p",{children:"تازه‌سازی لیست محصولات"})})]})})]})})}),e.jsxs(N,{children:[e.jsx("div",{className:"rounded-lg border",children:e.jsxs(xe,{children:[e.jsx(he,{children:e.jsxs(U,{children:[e.jsx(y,{children:"نام محصول"}),e.jsx(y,{children:"مدل/سریال"}),e.jsx(y,{children:"دسته‌بندی"}),e.jsx(y,{children:"قیمت"}),e.jsx(y,{children:"وضعیت"}),e.jsx(y,{children:"تاریخ ثبت"}),e.jsx(y,{children:"عملیات"})]})}),e.jsx(ue,{children:J.map(s=>{const l=D(s);return e.jsxs(U,{children:[e.jsx(C,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.productType==="imported"?e.jsx(Pe,{className:"w-4 h-4 text-purple-600"}):e.jsx(G,{className:"w-4 h-4 text-blue-600"}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.name}),s.productType==="imported"&&e.jsx(I,{variant:"secondary",className:"bg-purple-100 text-purple-800 text-xs",children:"🚢 وارداتی"})]}),l.isBatch&&e.jsxs(I,{variant:"secondary",className:"bg-indigo-100 text-indigo-800 text-xs w-fit",children:["📊 دسته‌ای ",l.batchIndex,"/",l.batchSize]})]})]})}),e.jsx(C,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.model}),e.jsx("div",{className:"text-sm text-muted-foreground",children:s.serialNumber})]})}),e.jsx(C,{children:e.jsx(I,{variant:"outline",children:s.categoryName})}),e.jsx(C,{children:s.price?e.jsxs("span",{className:"font-medium",children:[s.price.toLocaleString()," ریال"]}):e.jsx("span",{className:"text-muted-foreground",children:"تعیین نشده"})}),e.jsx(C,{children:e.jsx(I,{variant:"secondary",className:se[s.status],children:ae[s.status]})}),e.jsx(C,{children:s.createdAt}),e.jsx(C,{children:e.jsxs(pe,{children:[e.jsx(ge,{asChild:!0,children:e.jsx(E,{variant:"ghost",size:"sm",children:e.jsx(Ie,{className:"w-4 h-4"})})}),e.jsxs(fe,{align:"end",children:[e.jsxs(P,{onClick:()=>b(s),children:[e.jsx(de,{className:"w-4 h-4 ml-2"}),"مشاهده جزئیات"]}),e.jsxs(P,{children:[e.jsx(Fe,{className:"w-4 h-4 ml-2"}),"ویرایش"]}),s.status==="available"&&e.jsxs(P,{onClick:()=>le(s),children:[e.jsx(Se,{className:"w-4 h-4 ml-2"}),"فروش"]}),e.jsxs(P,{children:[e.jsx(oe,{className:"w-4 h-4 ml-2"}),"QR Code"]}),e.jsxs(P,{children:[e.jsx(Re,{className:"w-4 h-4 ml-2"}),"دانلود شناسنامه"]}),e.jsxs(P,{onClick:()=>re(s),className:"text-destructive focus:text-destructive",children:[e.jsx(ke,{className:"w-4 h-4 ml-2"}),"حذف"]})]})]})})]},s.id)})})]})}),J.length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(G,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"محصولی یافت نشد"})]})]})]}),n&&!M&&e.jsx(W,{open:!!n,onOpenChange:()=>b(null),children:e.jsxs(X,{className:"max-w-6xl max-h-[95vh]",children:[e.jsxs(Y,{className:"text-right",dir:"rtl",children:[e.jsxs(Z,{className:"text-right",children:["جزئیات محصول: ",n.name]}),e.jsx(_,{className:"text-right",children:"مشاهده اطلاعات کامل، مشخصات فنی و تاریخچه محصول"})]}),e.jsx(ee,{className:"max-h-[calc(95vh-8rem)] overflow-auto",children:e.jsx(Be,{product:n})})]})}),M&&n&&e.jsx(we,{isOpen:M,onClose:()=>{a(!1),b(null)},preSelectedPart:{id:n.id,name:n.name,code:n.model,serial:n.serialNumber,category:n.categoryName},title:"فروش محصول",description:"انجام فرآیند فروش محصول"})]})}function qe({onClose:c,categories:u,onSubmit:F}){const[i,m]=t.useState({name:"",model:"",serialNumber:"",categoryId:"",manufacturer:"",brand:"",price:"",productType:"manufactured",manufacturerCountry:"ایران",originCountry:"",productionDate:"",specifications:{}}),[j,w]=t.useState(!1),[L,R]=t.useState(1),[p,n]=t.useState([""]),[b,z]=t.useState(null),[k,q]=t.useState(!1),T=u.find(a=>a.id===i.categoryId),v=async a=>{if(a.preventDefault(),i.productType==="imported"&&!b){h.error("برای محصولات وارداتی، بارگذاری برگه سبز ترخیص کالا الزامی است");return}if(j){if(p.filter(D=>!D.trim()).length>0){h.error("لطفاً تمام شماره‌های سریال را وارد کنید");return}if(new Set(p).size!==p.length){h.error("شماره‌های سریال نمی‌توانند تکراری باشند");return}}try{q(!0);const r={...i,isBatchMode:j,batchQuantity:j?L:1,serialNumbers:j?p:[i.serialNumber],customsClearanceFile:b};await F(r),c()}catch(r){console.error("Error submitting product:",r)}finally{q(!1)}},B=a=>{m(r=>({...r,categoryId:a,specifications:{}}))},M=(a,r)=>{m(g=>({...g,specifications:{...g.specifications,[a]:r}}))};return e.jsx("div",{className:"space-y-6",dir:"rtl",children:e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsx("h3",{className:"font-medium text-blue-800 flex items-center gap-2 mb-4",children:"📦 اطلاعات پایه محصول"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"name",className:"text-blue-700",children:"نام محصول *"}),e.jsx(x,{id:"name",value:i.name,onChange:a=>m(r=>({...r,name:a.target.value})),placeholder:"نام محصول را وارد کنید",required:!0,className:"text-right"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"model",className:"text-blue-700",children:"مدل *"}),e.jsx(x,{id:"model",value:i.model,onChange:a=>m(r=>({...r,model:a.target.value})),placeholder:"مدل محصول",required:!0,className:"text-right"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"categoryId",className:"text-blue-700",children:"دسته‌بندی *"}),e.jsxs(V,{value:i.categoryId,onValueChange:B,children:[e.jsx($,{children:e.jsx(A,{placeholder:"انتخاب دسته‌بندی"})}),e.jsx(H,{children:u.map(a=>e.jsx(S,{value:a.id,children:a.name},a.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"manufacturer",className:"text-blue-700",children:"سازنده *"}),e.jsx(x,{id:"manufacturer",value:i.manufacturer,onChange:a=>m(r=>({...r,manufacturer:a.target.value})),placeholder:"نام شرکت سازنده",required:!0,className:"text-right"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"price",className:"text-blue-700",children:"قیمت (ریال)"}),e.jsx(x,{id:"price",type:"number",value:i.price,onChange:a=>m(r=>({...r,price:a.target.value})),placeholder:"قیمت محصول",className:"text-left",dir:"ltr"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-blue-700",children:"نوع محصول *"}),e.jsxs(V,{value:i.productType,onValueChange:a=>m(r=>({...r,productType:a})),children:[e.jsx($,{children:e.jsx(A,{})}),e.jsxs(H,{children:[e.jsx(S,{value:"manufactured",children:"تولیدی"}),e.jsx(S,{value:"imported",children:"وارداتی"})]})]})]})]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-medium text-green-800",children:"🏷️ شماره سریال"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{checked:j,onCheckedChange:w}),e.jsx(o,{className:"text-green-700",children:"ثبت دسته‌ای"})]})]}),j?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"تعداد محصولات"}),e.jsx(x,{type:"number",min:"1",max:"100",value:L,onChange:a=>{const r=parseInt(a.target.value)||1;R(r),n(Array(r).fill(""))},className:"w-32 text-left",dir:"ltr"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{children:"شماره‌های سریال *"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2 max-h-40 overflow-y-auto",children:p.map((a,r)=>e.jsx(x,{value:a,onChange:g=>{const D=[...p];D[r]=g.target.value,n(D)},placeholder:`سریال ${r+1}`,className:"text-left",dir:"ltr",required:!0},r))})]})]}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"serialNumber",children:"شماره سریال *"}),e.jsx(x,{id:"serialNumber",value:i.serialNumber,onChange:a=>m(r=>({...r,serialNumber:a.target.value})),placeholder:"شماره سریال محصول",required:!0,className:"text-left",dir:"ltr"})]})]}),T&&T.specifications.length>0&&e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:[e.jsx("h3",{className:"font-medium text-purple-800 mb-4",children:"⚙️ مشخصات فنی"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:T.specifications.map(a=>e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-purple-700",children:a.label}),e.jsx(x,{value:i.specifications[a.key]||"",onChange:r=>M(a.key,r.target.value),placeholder:a.label,className:"text-right"})]},a.key))})]}),i.productType==="imported"&&e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg border border-orange-200",children:[e.jsx("h3",{className:"font-medium text-orange-800 mb-4",children:"📋 مدارک وارداتی"}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{className:"text-orange-700",children:"برگه سبز ترخیص کالا *"}),e.jsx(x,{type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:a=>{const r=a.target.files?.[0];r&&(z(r),h.success("فایل بارگذاری شد"))},className:"text-right"}),e.jsx("p",{className:"text-xs text-orange-600",children:"فقط فایل‌های PDF، JPG و PNG با حداکثر حجم ۵ مگابایت"})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(E,{type:"button",variant:"outline",onClick:c,children:"انصراف"}),e.jsx(E,{type:"submit",disabled:k,children:k?e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"w-4 h-4 ml-2 animate-spin"}),"در حال ثبت..."]}):"ثبت محصول"})]})]})})}function Be({product:c}){return e.jsx("div",{className:"space-y-6",dir:"rtl",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(f,{children:[e.jsx(Q,{children:e.jsx(K,{children:"اطلاعات پایه"})}),e.jsxs(N,{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"نام:"}),e.jsx("span",{className:"font-medium",children:c.name})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"مدل:"}),e.jsx("span",{className:"font-medium",children:c.model})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"سریال:"}),e.jsx("span",{className:"font-medium",children:c.serialNumber})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"سازنده:"}),e.jsx("span",{className:"font-medium",children:c.manufacturer})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"دسته‌بندی:"}),e.jsx(I,{variant:"outline",children:c.categoryName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"وضعیت:"}),e.jsx(I,{className:se[c.status],children:ae[c.status]})]})]})]}),e.jsxs(f,{children:[e.jsx(Q,{children:e.jsx(K,{children:"مشخصات فنی"})}),e.jsx(N,{className:"space-y-3",children:Object.entries(c.specifications).map(([u,F])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-muted-foreground",children:[u,":"]}),e.jsx("span",{className:"font-medium",children:F})]},u))})]})]})})}export{ns as default};
